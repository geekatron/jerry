# TOOL_REGISTRY.yaml - Centralized Tool Registry
# Jerry Framework v2.1.0
# Single Source of Truth for tool definitions and agent permissions
#
# Document ID: JERRY-TOOL-REG-001
# Last Updated: 2026-01-12
# Created By: WI-SAO-017 (Centralize Tool Registry)

---

# ============================================================================
# TOOL DEFINITIONS
# ============================================================================
# All tools available within the Jerry framework with metadata

tools:
  # --------------------------------------------------------------------------
  # CORE TOOLS - Filesystem Operations
  # --------------------------------------------------------------------------
  core:
    Read:
      description: "Read file contents from the local filesystem"
      category: "filesystem"
      risk_level: "low"
      constraints:
        - "File path must be absolute"
        - "Cannot read directories (use Bash ls instead)"
        - "Maximum 2000 lines by default"
        - "Lines longer than 2000 chars truncated"
      use_cases:
        - "Reading source code for analysis"
        - "Examining configuration files"
        - "Reviewing existing artifacts"
      output_format: "cat -n format with line numbers"

    Write:
      description: "Write content to a file, creating or overwriting"
      category: "filesystem"
      risk_level: "medium"
      constraints:
        - "File path must be absolute"
        - "Overwrites existing files without confirmation"
        - "Should Read file first if editing existing"
        - "Prefer Edit for modifications to existing files"
      use_cases:
        - "Creating new artifacts (P-002 compliance)"
        - "Persisting reports and documentation"
        - "Creating test files"
      mandatory_for:
        - "P-002: File Persistence principle"

    Edit:
      description: "Perform exact string replacements in files"
      category: "filesystem"
      risk_level: "medium"
      constraints:
        - "Must Read file first before editing"
        - "old_string must be unique in file (or use replace_all)"
        - "Preserves indentation and formatting"
        - "Prefer over Write for modifications"
      use_cases:
        - "Updating existing artifacts"
        - "Modifying configuration"
        - "Incremental document updates"

    Glob:
      description: "Fast file pattern matching across codebase"
      category: "filesystem"
      risk_level: "low"
      constraints:
        - "Returns files sorted by modification time"
        - "Supports ** for recursive matching"
        - "Does not read file contents"
      use_cases:
        - "Finding files by name pattern"
        - "Discovering project structure"
        - "Locating test files"
      patterns:
        - "**/*.py - All Python files"
        - "**/*.md - All Markdown files"
        - "**/test_*.py - All test files"

    Grep:
      description: "Search file contents using regex patterns"
      category: "filesystem"
      risk_level: "low"
      constraints:
        - "Uses ripgrep syntax (not grep)"
        - "Escape literal braces with \\"
        - "Default mode: files_with_matches"
        - "Use -C for context lines"
      use_cases:
        - "Finding code patterns"
        - "Searching for vulnerabilities"
        - "Locating function definitions"
      output_modes:
        - "content - Show matching lines"
        - "files_with_matches - Show file paths only"
        - "count - Show match counts"

  # --------------------------------------------------------------------------
  # EXECUTION TOOLS - Command Execution
  # --------------------------------------------------------------------------
  execution:
    Bash:
      description: "Execute shell commands in persistent session"
      category: "execution"
      risk_level: "high"
      constraints:
        - "Use absolute paths (cwd resets between calls)"
        - "Quote paths with spaces"
        - "Max timeout 600000ms (10 minutes)"
        - "Default timeout 120000ms (2 minutes)"
        - "Prefer specialized tools over find/grep/cat/sed/awk"
      use_cases:
        - "Running tests (pytest, npm test)"
        - "Git operations"
        - "Package management (pip, npm)"
        - "Dependency audits"
      forbidden_patterns:
        - "Interactive commands (git rebase -i)"
        - "Force push to main/master"
        - "Hard reset without user confirmation"
      git_safety:
        - "Never update git config"
        - "Never use --no-verify unless requested"
        - "Only amend if commit was created in conversation"

  # --------------------------------------------------------------------------
  # WEB TOOLS - External Data Access
  # --------------------------------------------------------------------------
  web:
    WebSearch:
      description: "Search the web for up-to-date information"
      category: "external"
      risk_level: "low"
      constraints:
        - "Must include Sources section in response"
        - "Use current year (2026) in queries"
        - "Available in US only"
        - "Can filter by allowed/blocked domains"
      use_cases:
        - "Researching CVEs and vulnerabilities"
        - "Finding current documentation"
        - "Accessing information beyond knowledge cutoff"
      output_requirement: "Must cite sources as markdown hyperlinks"

    WebFetch:
      description: "Fetch and process content from URLs"
      category: "external"
      risk_level: "low"
      constraints:
        - "HTTP upgraded to HTTPS automatically"
        - "Results may be summarized for large content"
        - "15-minute cache for repeated requests"
        - "Prefer MCP web fetch if available"
      use_cases:
        - "Retrieving documentation pages"
        - "Fetching API references"
        - "Reading external resources"

  # --------------------------------------------------------------------------
  # ORCHESTRATION TOOLS - Workflow Management
  # --------------------------------------------------------------------------
  orchestration:
    Task:
      description: "Delegate tasks to subagents"
      category: "orchestration"
      risk_level: "high"
      constraints:
        - "P-003: Maximum ONE level of nesting"
        - "Subagents MUST NOT spawn further subagents"
        - "Only orchestrator-level agents may use this"
        - "Must provide complete context in prompt"
      use_cases:
        - "Delegating specialized work to domain agents"
        - "Parallel execution of independent tasks"
        - "Multi-agent workflows"
      constitutional_principle: "P-003: No Recursive Subagents (Hard)"

    TodoWrite:
      description: "Create and manage structured task lists"
      category: "orchestration"
      risk_level: "low"
      constraints:
        - "Use for 3+ step tasks"
        - "One in_progress task at a time"
        - "Provide both content and activeForm"
        - "Update status in real-time"
      use_cases:
        - "Tracking multi-step implementations"
        - "Managing complex workflows"
        - "Showing progress to user"
      task_states:
        - "pending - Not yet started"
        - "in_progress - Currently working"
        - "completed - Finished successfully"

    AskUserQuestion:
      description: "Ask user for clarification or decisions"
      category: "orchestration"
      risk_level: "low"
      constraints:
        - "Use sparingly - prefer autonomous action"
        - "Only for critical decisions or blockers"
        - "Provide context and options"
      use_cases:
        - "Clarifying ambiguous requirements"
        - "Requesting user decision on trade-offs"
        - "Confirming destructive operations"

  # --------------------------------------------------------------------------
  # MCP TOOLS - Model Context Protocol Extensions
  # --------------------------------------------------------------------------
  mcp:
    mcp__context7__resolve-library-id:
      description: "Resolve package name to Context7 library ID"
      category: "mcp"
      risk_level: "low"
      constraints:
        - "Must call before query-docs"
        - "Maximum 3 calls per question"
        - "Returns library ID for query-docs"
      use_cases:
        - "Finding correct library ID for documentation queries"
        - "Disambiguating library names"

    mcp__context7__query-docs:
      description: "Query Context7 for library documentation"
      category: "mcp"
      risk_level: "low"
      constraints:
        - "Requires resolved library ID from resolve-library-id"
        - "Maximum 3 calls per question"
        - "Do not include sensitive data in queries"
      use_cases:
        - "Retrieving current library documentation"
        - "Finding code examples"
        - "Researching API usage"

    mcp__memory-keeper__context_*:
      description: "Memory Keeper context management tools"
      category: "mcp"
      risk_level: "low"
      constraints:
        - "Session-based context management"
        - "Supports channels for organization"
        - "Various operations: save, get, search, etc."
      use_cases:
        - "Persisting session context"
        - "Cross-session knowledge sharing"
        - "Checkpoint creation and recovery"

# ============================================================================
# AGENT PERMISSIONS
# ============================================================================
# Maps each agent to its allowed tools

agent_permissions:
  # --------------------------------------------------------------------------
  # CORE AGENTS (.claude/agents/)
  # --------------------------------------------------------------------------
  core_agents:
    orchestrator:
      file: ".claude/agents/orchestrator.md"
      model: "opus"
      tools:
        - Task          # Can delegate to subagents
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - TodoWrite
        - Bash
        - AskUserQuestion
      special_permissions:
        - "Task delegation (P-003 root level)"
        - "User interaction via AskUserQuestion"

    qa-engineer:
      file: ".claude/agents/qa-engineer.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
      focus: "Test design, execution, quality validation"

    security-auditor:
      file: ".claude/agents/security-auditor.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch     # For CVE research
      focus: "Vulnerability assessment, threat modeling, secure design review"

  # --------------------------------------------------------------------------
  # PROBLEM-SOLVING AGENTS (skills/problem-solving/agents/)
  # --------------------------------------------------------------------------
  problem_solving_agents:
    ps-researcher:
      file: "skills/problem-solving/agents/ps-researcher.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - WebSearch
        - WebFetch
        - Task          # Can delegate sub-research
        - Bash
        - mcp__context7__resolve-library-id
        - mcp__context7__query-docs
      focus: "Deep research with Context7 MCP integration"

    ps-analyst:
      file: "skills/problem-solving/agents/ps-analyst.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch
        - WebFetch
        - mcp__context7__resolve-library-id
        - mcp__context7__query-docs
      focus: "Root cause analysis, 5 Whys, Ishikawa"

    ps-architect:
      file: "skills/problem-solving/agents/ps-architect.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch
        - WebFetch
        - mcp__context7__resolve-library-id
        - mcp__context7__query-docs
      focus: "ADR creation, architecture decisions"

    ps-critic:
      file: "skills/problem-solving/agents/ps-critic.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
      focus: "Quality evaluation for generator-critic loops (minimal toolset)"

    ps-synthesizer:
      file: "skills/problem-solving/agents/ps-synthesizer.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch
        - WebFetch
        - mcp__context7__resolve-library-id
        - mcp__context7__query-docs
      focus: "Meta-analysis across documents"

    ps-validator:
      file: "skills/problem-solving/agents/ps-validator.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
      focus: "Constraint verification, acceptance testing"

    ps-reviewer:
      file: "skills/problem-solving/agents/ps-reviewer.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
      focus: "Code/design quality review"

    ps-investigator:
      file: "skills/problem-solving/agents/ps-investigator.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch
        - WebFetch
        - mcp__context7__resolve-library-id
        - mcp__context7__query-docs
      focus: "Failure analysis with 5 Whys methodology"

    ps-reporter:
      file: "skills/problem-solving/agents/ps-reporter.md"
      model: "haiku"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
      focus: "Status reporting and documentation"

  # --------------------------------------------------------------------------
  # NASA-SE AGENTS (skills/nasa-se/agents/)
  # --------------------------------------------------------------------------
  nasa_se_agents:
    nse-architecture:
      file: "skills/nasa-se/agents/nse-architecture.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch
        - WebFetch
      focus: "NPR 7123.1D Processes 3,4,17 - Architecture development"

    nse-configuration:
      file: "skills/nasa-se/agents/nse-configuration.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch
        - WebFetch
      focus: "Configuration management per NASA standards"

    nse-explorer:
      file: "skills/nasa-se/agents/nse-explorer.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch
        - WebFetch
      focus: "Divergent thinking, trade studies, options analysis"

    nse-integration:
      file: "skills/nasa-se/agents/nse-integration.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch
        - WebFetch
      focus: "Interface management, ICDs"

    nse-qa:
      file: "skills/nasa-se/agents/nse-qa.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
      focus: "Artifact validation, quality assurance"

    nse-reporter:
      file: "skills/nasa-se/agents/nse-reporter.md"
      model: "haiku"
      tools:
        - Read
        - Write
        - Glob
        - Grep
        - Task          # For delegating report generation
        - WebFetch
      focus: "SE status reporting"
      note: "Does not have Edit tool"

    nse-requirements:
      file: "skills/nasa-se/agents/nse-requirements.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch
        - WebFetch
      focus: "Requirements engineering per NPR 7123.1D"

    nse-reviewer:
      file: "skills/nasa-se/agents/nse-reviewer.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch
        - WebFetch
      focus: "Technical review gates (SRR/PDR/CDR)"

    nse-risk:
      file: "skills/nasa-se/agents/nse-risk.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch
        - WebFetch
      focus: "Risk management per NPR 8000.4C"

    nse-verification:
      file: "skills/nasa-se/agents/nse-verification.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
        - WebSearch
        - WebFetch
      focus: "Verification & Validation, VCRM"

  # --------------------------------------------------------------------------
  # ORCHESTRATION AGENTS (skills/orchestration/agents/)
  # --------------------------------------------------------------------------
  orchestration_agents:
    orch-planner:
      file: "skills/orchestration/agents/orch-planner.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
      focus: "Workflow design, pipeline architecture, state schema definition"

    orch-tracker:
      file: "skills/orchestration/agents/orch-tracker.md"
      model: "haiku"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
      focus: "State tracking, checkpoint creation, metrics calculation"

    orch-synthesizer:
      file: "skills/orchestration/agents/orch-synthesizer.md"
      model: "sonnet"
      tools:
        - Read
        - Write
        - Edit
        - Glob
        - Grep
        - Bash
      focus: "Cross-document synthesis, pattern extraction, recommendations"

# ============================================================================
# VALIDATION RULES
# ============================================================================
# Rules for validating tool usage and agent compliance

validation_rules:
  # Tool usage validation
  tool_usage:
    - rule: "Read before Write"
      description: "Write tool should only be used after Read for existing files"
      severity: "warning"
      applies_to: ["Write"]

    - rule: "Read before Edit"
      description: "Edit tool MUST be preceded by Read for the same file"
      severity: "error"
      applies_to: ["Edit"]

    - rule: "Absolute paths required"
      description: "All file paths must be absolute, not relative"
      severity: "error"
      applies_to: ["Read", "Write", "Edit"]

    - rule: "Context7 sequence"
      description: "mcp__context7__query-docs requires prior resolve-library-id"
      severity: "error"
      applies_to: ["mcp__context7__query-docs"]

    - rule: "Task depth limit"
      description: "Task tool cannot be used by subagents (P-003)"
      severity: "critical"
      applies_to: ["Task"]

  # Constitutional compliance
  constitutional:
    - principle: "P-002"
      name: "File Persistence"
      enforcement: "medium"
      rule: "All significant outputs MUST use Write tool for persistence"
      mandatory_tools: ["Write"]

    - principle: "P-003"
      name: "No Recursive Subagents"
      enforcement: "hard"
      rule: "Maximum ONE level of Task nesting allowed"
      restricted_tools: ["Task"]

    - principle: "P-020"
      name: "User Authority"
      enforcement: "hard"
      rule: "Never override explicit user decisions"

    - principle: "P-022"
      name: "No Deception"
      enforcement: "hard"
      rule: "Never misrepresent capabilities, findings, or status"

    - principle: "P-043"
      name: "Disclaimer"
      enforcement: "medium"
      rule: "All outputs include mandatory disclaimer"

  # Agent-specific rules
  agent_restrictions:
    - agent_pattern: "ps-critic"
      restriction: "Minimal toolset for focused evaluation"
      allowed_tools: ["Read", "Write", "Edit", "Glob", "Grep"]
      rationale: "Critic role requires objective review without execution capabilities"

    - agent_pattern: "nse-reporter"
      restriction: "No Edit tool - write-only for reports"
      forbidden_tools: ["Edit"]
      rationale: "Reporter should create new artifacts, not modify existing"

    - agent_pattern: "*-reporter"
      restriction: "Fast model (haiku) for status updates"
      model_constraint: "haiku"

    - agent_pattern: "orch-*"
      restriction: "No web tools for orchestration agents"
      forbidden_tools: ["WebSearch", "WebFetch"]
      rationale: "Orchestration should work with local artifacts only"

# ============================================================================
# TOOL CATEGORIES SUMMARY
# ============================================================================
# Quick reference for tool categories

categories:
  filesystem:
    tools: ["Read", "Write", "Edit", "Glob", "Grep"]
    risk: "low-medium"
    description: "Local file operations"

  execution:
    tools: ["Bash"]
    risk: "high"
    description: "Shell command execution"

  external:
    tools: ["WebSearch", "WebFetch"]
    risk: "low"
    description: "External web access"

  orchestration:
    tools: ["Task", "TodoWrite", "AskUserQuestion"]
    risk: "low-high"
    description: "Workflow and task management"

  mcp:
    tools: ["mcp__context7__*", "mcp__memory-keeper__*"]
    risk: "low"
    description: "Model Context Protocol extensions"

# ============================================================================
# METRICS
# ============================================================================

metrics:
  total_tools: 14
  total_agents: 25
  agents_by_family:
    core: 3
    problem_solving: 9
    nasa_se: 10
    orchestration: 3
  agents_with_task_tool: 3
  agents_with_web_tools: 14
  agents_with_mcp_tools: 5

---

# Disclaimer
# This tool registry was generated by WI-SAO-017 for the Jerry Framework.
# It serves as the single source of truth for tool definitions and agent permissions.
# Human review recommended before enforcement changes.
