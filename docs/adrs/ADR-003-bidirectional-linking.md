# ADR-003: Bidirectional Deep Linking

> **PS:** en004-adr-20260126-001
> **Exploration:** draft-003
> **Created:** 2026-01-26
> **Status:** ACCEPTED
> **Agent:** ps-architect
> **Supersedes:** N/A
> **Superseded By:** N/A

---

## Context

The Transcript Skill produces multiple output artifacts (summaries, speaker profiles, topics, action items, etc.) that reference each other and the source transcript. These cross-references must:

1. Enable navigation between related artifacts (forward links)
2. Allow discovery of all references to an entity (backlinks)
3. Maintain traceability to source transcript spans (FR-014, NFR-010)
4. Work with standard Markdown renderers (GitHub, VS Code, IDE previews)

### Background

Industry research on knowledge management systems shows two dominant linking approaches:

**Wiki-Style (Obsidian/Roam):**
- Uses `[[Page Name]]` syntax
- Auto-generates backlinks at runtime
- Requires custom parser or database index
- Not compatible with standard Markdown

**Standard Markdown (GitHub/GitLab):**
- Uses `[text](path#anchor)` syntax
- Anchors auto-generated from headings (slugified)
- Universal rendering support
- Manual backlinks required

**Research conducted** (see `research/adr-003-research.md`):
- Obsidian/Roam backlinks patterns
- Zettelkasten methodology for bidirectional linking
- GitHub/GitLab anchor generation rules
- EN-003 requirements (FR-014, NFR-010, PAT-004)

### Constraints

| ID | Constraint | Source |
|----|------------|--------|
| C-001 | All extracted entities must include source transcript citations | FR-014 Requirements |
| C-002 | LLM extractions must include source span citations | NFR-010 Requirements |
| C-003 | Output must render correctly in standard Markdown viewers | GitHub/VS Code compatibility |
| C-004 | Links must work across files in the output packet | ADR-002 hierarchical structure |
| C-005 | No external tooling required for link navigation | Static Markdown requirement |
| C-006 | Anchors must be predictable and stable | Prevents broken links |

### Forces

1. **Standard vs. Familiar:** Standard Markdown is universal but verbose. Wiki-style is concise but non-standard.

2. **Manual vs. Automatic:** Manual backlinks give control but require maintenance. Auto backlinks need tooling.

3. **Headings vs. Custom Anchors:** Heading anchors are auto-generated but content-dependent. Custom anchors are stable but require explicit markup.

4. **Context vs. Brevity:** Including context in backlinks aids understanding but increases file size.

---

## Options Considered

### Option 1: Wiki-Style Links

Use Obsidian/Roam-style double-bracket syntax for all links.

**Syntax:**
```markdown
See [[02-speakers/speakers.md|John Smith]] for profile.
Topic discussed: [[03-topics/topics.md#topic-001|Project Planning]]
```

**Backlinks:** Auto-generated by hypothetical parser.

**Pros:**
- Shorter, cleaner syntax
- Familiar to Obsidian/Roam users
- Could auto-generate backlinks with custom tooling

**Cons:**
- Not standard Markdown (CommonMark)
- Doesn't render on GitHub/GitLab
- Requires custom parser
- VS Code won't navigate links
- Adds parser complexity to output-formatter

**Fit with Constraints:**
- C-001: PASS - Can include citations
- C-002: PASS - Can include spans
- C-003: FAIL - Doesn't render in standard viewers
- C-004: PASS - Cross-file links work
- C-005: FAIL - Requires custom tooling
- C-006: PASS - Explicit anchors

### Option 2: Standard Markdown with Heading Anchors

Use standard Markdown links with auto-generated heading anchors.

**Syntax:**
```markdown
See [John Smith](./02-speakers/speakers.md#speaker-john-smith) for profile.
Topic discussed: [Project Planning](./03-topics/topics.md#topic-001-project-planning)
```

**Anchor Generation:** Slugified headings (lowercase, spaces→hyphens, remove special chars)

**Backlinks:** Manual section at end of each file.

**Pros:**
- Standard Markdown (CommonMark compliant)
- Renders on GitHub/GitLab/VS Code
- IDE navigation support (Ctrl+Click)
- No custom parser needed

**Cons:**
- Longer syntax
- Anchor names depend on heading text (content-coupled)
- Heading changes break links
- Manual backlinks maintenance

**Fit with Constraints:**
- C-001: PASS - Citations in link text
- C-002: PASS - Spans linkable
- C-003: PASS - Standard rendering
- C-004: PASS - Cross-file relative paths
- C-005: PASS - No external tooling
- C-006: PARTIAL - Anchors change with headings

### Option 3: Standard Markdown with Custom Anchors (Recommended)

Use standard Markdown links with explicit custom anchors using HTML `<a id="">` syntax.

**Syntax:**
```markdown
<!-- In speakers.md -->
<a id="speaker-001"></a>
### John Smith

<!-- Link from another file -->
See [John Smith](./02-speakers/speakers.md#speaker-001) for profile.
```

**Anchor Pattern:** `{entity-type}-{nnn}` (numbered, stable)

**Backlinks:** Auto-generated section by output-formatter agent.

**Pros:**
- Standard Markdown with HTML (universally supported)
- Stable anchors (number-based, not content-based)
- IDE navigation works
- Renders on all platforms
- Heading text can change without breaking links
- Output-formatter can generate backlinks during processing

**Cons:**
- Slightly more markup required
- Two elements per anchor (HTML tag + heading)
- Anchor IDs less descriptive than slugified headings

**Fit with Constraints:**
- C-001: PASS - Citations in link context
- C-002: PASS - Spans as anchors
- C-003: PASS - HTML + Markdown renders everywhere
- C-004: PASS - Relative paths work
- C-005: PASS - No external tooling needed
- C-006: PASS - Numbered anchors are stable

---

## Decision

**We will use Option 3: Standard Markdown with Custom Anchors.**

### Rationale

1. **Stability (C-006):** Numbered anchors (e.g., `#speaker-001`) don't change when heading text is edited, preventing broken links across the output packet.

2. **Universal Compatibility (C-003):** HTML `<a id="">` is supported by all Markdown parsers. Links render correctly on GitHub, GitLab, VS Code, and in Claude's context window.

3. **Traceability (C-001, C-002):** Anchors can be placed at any granularity—from entire sections to individual transcript spans. This enables FR-014 source citations and NFR-010 span links.

4. **Automated Backlinks:** The output-formatter agent can track all forward links during generation and produce a `## Backlinks` section for each file, satisfying DEC-004.

5. **IDE Integration (C-005):** Standard Markdown links with relative paths enable Ctrl+Click navigation in VS Code and other IDEs without additional plugins.

### Alignment

| Criterion | Score | Notes |
|-----------|-------|-------|
| Constraint Satisfaction | HIGH | All 6 constraints met |
| Risk Level | LOW | Standard patterns, no custom tooling |
| Implementation Effort | MEDIUM | Anchor generation + backlink tracking |
| Reversibility | HIGH | Can switch to heading anchors later |

---

## Consequences

### Positive Consequences

1. **Stable Links:** Refactoring heading text doesn't break cross-file links.

2. **Rich Traceability:** Every extracted entity links to its source transcript span, fulfilling FR-014 and PAT-004.

3. **Discoverable References:** Backlinks section shows all places an entity is mentioned, enabling bi-directional navigation per DEC-004.

4. **IDE Integration:** Users can navigate the output packet using standard IDE features.

5. **No Lock-In:** Standard Markdown + HTML works without proprietary tooling.

### Negative Consequences

1. **Markup Overhead:** Each linkable element needs `<a id="">` tag before heading.

2. **Anchor Registry Required:** Output-formatter must track assigned IDs to prevent collisions.

### Neutral Consequences

1. **Backlinks Section Size:** Adds ~200-500 characters per file for backlinks; within token budget.

### Risks

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Anchor ID collision | LOW | MEDIUM | Sequential numbering per entity type |
| Backlinks stale after regeneration | LOW | LOW | Regenerate backlinks with each run |
| HTML rendering quirks | LOW | LOW | Test on GitHub, VS Code, IDE |
| Anchor orphans (no references) | LOW | LOW | Validation in output-formatter |

---

## Implementation

### Anchor Naming Convention

| Entity Type | Pattern | Example |
|-------------|---------|---------|
| Speaker | `speaker-{nnn}` | `#speaker-001` |
| Topic | `topic-{nnn}` | `#topic-001` |
| Action Item | `action-{nnn}` | `#action-001` |
| Question | `question-{nnn}` | `#question-001` |
| Decision | `decision-{nnn}` | `#decision-001` |
| Idea | `idea-{nnn}` | `#idea-001` |
| Timeline Segment | `segment-{nnn}` | `#segment-001` |
| Transcript Span | `span-{mmss}` | `#span-1230` (12:30 timestamp) |

### Link Format Specification

**Forward Link (same directory):**
```markdown
See [Action Item 3](./action-items.md#action-003) for details.
```

**Forward Link (different directory):**
```markdown
[John Smith](../02-speakers/speakers.md#speaker-001) presented this topic.
```

**Transcript Citation Link:**
```markdown
> "We need to finalize the API by Friday" — [Transcript 00:12:30](../transcript.vtt#span-1230)
```

### Backlinks Section Template

```markdown
---

## Backlinks

> References to this file from other artifacts.

| Source | Context | Link |
|--------|---------|------|
| topics.md | "Presented by John Smith" | [→ Topic 001](../03-topics/topics.md#topic-001) |
| action-items.md | "Assigned to John Smith" | [→ Action 003](../04-entities/action-items.md#action-003) |
| timeline.md | "00:05:00 - Speaker change" | [→ Segment 5](../05-timeline/timeline.md#segment-005) |

---
*Generated by output-formatter agent*
```

### Anchor Element Pattern

```markdown
<a id="speaker-001"></a>
### John Smith

**Role:** Project Manager
**Speaking Time:** 15 minutes (25% of meeting)

[View timeline segments →](../05-timeline/timeline.md)

#### Mentioned Topics
- [Project Planning](../03-topics/topics.md#topic-001)
- [Budget Review](../03-topics/topics.md#topic-003)
```

### Action Items

| # | Action | Owner | Status |
|---|--------|-------|--------|
| 1 | Implement anchor ID registry in output-formatter | ps-architect | Pending |
| 2 | Add forward link tracking during file generation | ps-architect | Pending |
| 3 | Create backlinks generator for output-formatter | ps-architect | Pending |
| 4 | Define transcript span anchor format | ps-architect | Pending |
| 5 | Add link validation step before file write | ps-architect | Pending |

### Validation Criteria

1. **Anchor Uniqueness:** No duplicate anchor IDs within output packet
2. **Link Validity:** All links resolve to existing anchors
3. **Backlinks Completeness:** All forward links have corresponding backlinks
4. **Rendering Test:** Files render correctly on GitHub preview
5. **IDE Navigation:** Ctrl+Click works in VS Code

---

## Related Decisions

| ADR | Relationship | Notes |
|-----|--------------|-------|
| ADR-001 | DEPENDS_ON | Output-formatter agent generates links |
| ADR-002 | DEPENDS_ON | Artifact structure defines link targets |
| ADR-004 | RELATED_TO | File splitting affects anchor scope |
| ADR-005 | RELATED_TO | Agent implementation handles link generation |

---

## References

| # | Reference | Type | Relevance |
|---|-----------|------|-----------|
| 1 | research/adr-003-research.md | Research | Primary research input |
| 2 | EN-003 REQUIREMENTS-SPECIFICATION.md | Requirements | FR-014, NFR-010, PAT-004 |
| 3 | Obsidian Backlinks Documentation | Industry | Backlinks pattern |
| 4 | GitHub Markdown Heading Anchors | Industry | Anchor generation |
| 5 | Zettelkasten Forum | Community | Bidirectional linking philosophy |
| 6 | DEC-004 | Decision | Bidirectional linking requirement |
| 7 | ADR-002 Artifact Structure | Decision | Packet structure for links |

---

## Appendix A: Link Examples by Scenario

### Scenario 1: Speaker Profile to Timeline

```markdown
<!-- In 02-speakers/speakers.md -->
<a id="speaker-001"></a>
### John Smith

**Timeline Appearances:**
- [00:05:00 - Introduction](../05-timeline/timeline.md#segment-001)
- [00:12:30 - Project Update](../05-timeline/timeline.md#segment-003)
- [00:28:00 - Q&A Session](../05-timeline/timeline.md#segment-007)
```

### Scenario 2: Action Item to Transcript

```markdown
<!-- In 04-entities/action-items.md -->
<a id="action-003"></a>
### Action 003: Finalize API Documentation

**Assigned to:** [John Smith](../02-speakers/speakers.md#speaker-001)
**Due:** 2026-02-01
**Source:** [Transcript 00:23:45](../transcript.vtt#span-2345)

> "John, can you finalize the API documentation by next Friday?" — Sarah Chen
```

### Scenario 3: Topic to Multiple Entities

```markdown
<!-- In 03-topics/topics.md -->
<a id="topic-002"></a>
### Topic 002: Q1 Budget Review

**Presenter:** [Sarah Chen](../02-speakers/speakers.md#speaker-002)
**Duration:** 8 minutes (00:15:00 - 00:23:00)

**Related Entities:**
- [Decision 001: Approve Q1 budget](../04-entities/decisions.md#decision-001)
- [Action 005: Submit expense reports](../04-entities/action-items.md#action-005)
- [Question 003: What's the contingency allocation?](../04-entities/questions.md#question-003)
```

---

**Generated by:** ps-architect agent
**Template Version:** 1.0 (Nygard ADR Format)
**Quality Review:** PASSED (0.93) - ps-critic review 2026-01-26
