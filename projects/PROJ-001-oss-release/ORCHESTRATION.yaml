# ORCHESTRATION.yaml
# Machine-readable orchestration state for FEAT-015 License Migration (MIT -> Apache 2.0)
# Document ID: PROJ-001-ORCH-STATE
# Version: 2.0
# Last Updated: 2026-02-17
# Generated by: orch-planner agent v2.2.0
# Schema Evolution: See docs/schemas/SCHEMA_VERSIONING.md

# Schema version for evolution support (semver format)
# Increment MAJOR for breaking changes, MINOR for additions, PATCH for fixes
schema_version: "2.0.0"

# =============================================================================
# WORKFLOW METADATA
# =============================================================================
workflow:
  id: "feat015-licmig-20260217-001"
  name: "FEAT-015 License Migration: MIT to Apache 2.0"
  project_id: "PROJ-001"
  version: "2.0"
  created_at: "2026-02-17T00:00:00Z"
  updated_at: "2026-02-17T00:00:00Z"
  status: "ACTIVE"  # ACTIVE | PAUSED | COMPLETE | FAILED | CANCELLED

  # Workflow ID configuration (WI-SAO-021)
  id_source: "auto"               # "user" | "auto" - how the workflow ID was determined
  id_format: "semantic-date-seq"  # Format specification
  # Format: {purpose}-{YYYYMMDD}-{NNN}
  # Generated: feat015-licmig-20260217-001

  # Feature entity reference
  feature_entity: "projects/PROJ-001-oss-release/work/EPIC-001-oss-release/FEAT-015-license-migration/FEAT-015-license-migration.md"

  # Criticality classification
  criticality: "C2"               # C1 Routine | C2 Standard | C3 Significant | C4 Critical
  criticality_rationale: "Public-facing license change affecting >10 files. Technically reversible via git within 1 day."

  # Orchestration pattern classification
  patterns:
    - SEQUENTIAL      # Phases 1-4 execute in order
    - HIERARCHICAL    # Orchestrator delegates to execution agents
    # Note: Phase 2 uses internal parallel execution (3 enablers), but pipeline is single/sequential

  # Constraints from Jerry Constitution
  constraints:
    max_agent_nesting: 1          # P-003: Single nesting only
    file_persistence: true        # P-002: All state to filesystem
    user_authority: true          # P-020: User approves when max iterations hit
    max_concurrent_agents: 3      # Phase 2 peak: 3 parallel agents
    max_gate_retries: 3           # H-14: Max 3 iterations per gate (circuit breaker)
    checkpoint_frequency: "PHASE" # AGENT | PHASE | BARRIER

# =============================================================================
# PATH CONFIGURATION (WI-SAO-021)
# =============================================================================
# All paths are dynamically constructed using workflow and pipeline identifiers.
# No hardcoded pipeline names — all derived from configuration below.
paths:
  # Base path for all orchestration artifacts (relative to project root)
  base: "projects/PROJ-001-oss-release/orchestration/feat015-licmig-20260217-001/"

  # Pipeline artifact path pattern
  # {pipeline_alias} = "lic"
  # {phase_id} = "phase-1-audit", "phase-2-core", "phase-3-headers", "phase-4-ci"
  # {agent_id} = agent subdirectory for isolation (AC-012-004)
  pipeline: "{base}lic/{phase_id}/{agent_id}/"

  # Quality gate artifact path pattern
  gates: "{base}lic/quality-gates/{gate_id}/"

  # Examples (with workflow.id = "feat015-licmig-20260217-001"):
  # - Audit:    projects/PROJ-001-oss-release/orchestration/feat015-licmig-20260217-001/lic/phase-1-audit/audit-executor/audit-executor-dep-audit.md
  # - Gate 1:   projects/PROJ-001-oss-release/orchestration/feat015-licmig-20260217-001/lic/quality-gates/qg-1/gate-result.md

# =============================================================================
# PIPELINE DEFINITIONS
# =============================================================================
pipelines:
  lic:
    id: "lic"
    name: "License Migration Pipeline"
    description: "Single sequential pipeline implementing all 6 enablers for FEAT-015 MIT-to-Apache-2.0 migration"
    short_alias: "lic"
    skill_source: "orchestration"

    status: "QG_FINAL_PENDING"
    current_phase: 4
    total_phases: 4
    progress_percent: 100

    phases:

      # -----------------------------------------------------------------------
      # PHASE 1: DEPENDENCY AUDIT (EN-934)
      # -----------------------------------------------------------------------
      - id: 1
        name: "Dependency License Compatibility Audit"
        path_id: "phase-1-audit"
        status: "COMPLETE"
        enablers: ["EN-934"]
        execution_mode: "SEQUENTIAL"
        effort_points: 3
        started_at: "2026-02-17T00:00:00Z"
        completed_at: "2026-02-17T00:00:00Z"
        gate_after: "qg-1"

        agents:
          - id: "audit-executor"
            name: "Dependency Audit Executor"
            status: "COMPLETE"
            enabler: "EN-934"
            artifact: "orchestration/feat015-licmig-20260217-001/lic/phase-1-audit/audit-executor/audit-executor-dep-audit.md"
            inputs:
              - "pyproject.toml"
              - "uv.lock"  # if present
            description: >
              Audit all direct and transitive dependencies for Apache 2.0 compatibility.
              Render explicit PASS or BLOCK verdict. Document any incompatible deps with
              resolution options.

        artifacts:
          - path: "orchestration/feat015-licmig-20260217-001/lic/phase-1-audit/audit-executor/audit-executor-dep-audit.md"
            status: "COMPLETE"
            agent: "audit-executor"

      # -----------------------------------------------------------------------
      # PHASE 2: CORE LICENSE CHANGES (EN-930, EN-931, EN-933)
      # -----------------------------------------------------------------------
      - id: 2
        name: "Core License Changes"
        path_id: "phase-2-core"
        status: "COMPLETE"
        blocked_by: null  # Unblocked by QG-1 PASS
        enablers: ["EN-930", "EN-931", "EN-933"]
        execution_mode: "PARALLEL"
        effort_points: 3
        started_at: "2026-02-17T00:00:00Z"
        completed_at: "2026-02-17T00:00:00Z"
        gate_after: "qg-2"

        agents:
          - id: "license-replacer"
            name: "License File Replacer"
            status: "COMPLETE"
            enabler: "EN-930"
            artifact: "orchestration/feat015-licmig-20260217-001/lic/phase-2-core/license-replacer/license-replacer-output.md"
            inputs:
              - "LICENSE"
            outputs:
              - "LICENSE"  # Updated in-place
            description: >
              Replace current MIT LICENSE file with canonical Apache 2.0 text.
              Source from https://www.apache.org/licenses/LICENSE-2.0.txt.
              Text must be unmodified (byte-for-byte canonical).

          - id: "notice-creator"
            name: "NOTICE File Creator"
            status: "COMPLETE"
            enabler: "EN-931"
            artifact: "orchestration/feat015-licmig-20260217-001/lic/phase-2-core/notice-creator/notice-creator-output.md"
            inputs: []
            outputs:
              - "NOTICE"  # New file
            description: >
              Create NOTICE file per Apache 2.0 Section 4(d). Must include project name,
              copyright year, and contributor attribution. Format: plain text.

          - id: "metadata-updater"
            name: "Packaging Metadata Updater"
            status: "COMPLETE"
            enabler: "EN-933"
            artifact: "orchestration/feat015-licmig-20260217-001/lic/phase-2-core/metadata-updater/metadata-updater-output.md"
            inputs:
              - "pyproject.toml"
            outputs:
              - "pyproject.toml"  # Updated in-place
            description: >
              Update pyproject.toml license field to "Apache-2.0" (SPDX identifier).
              Verify no other license references remain in the file.

        artifacts:
          - path: "orchestration/feat015-licmig-20260217-001/lic/phase-2-core/license-replacer/license-replacer-output.md"
            status: "COMPLETE"
            agent: "license-replacer"
          - path: "orchestration/feat015-licmig-20260217-001/lic/phase-2-core/notice-creator/notice-creator-output.md"
            status: "COMPLETE"
            agent: "notice-creator"
          - path: "orchestration/feat015-licmig-20260217-001/lic/phase-2-core/metadata-updater/metadata-updater-output.md"
            status: "COMPLETE"
            agent: "metadata-updater"

      # -----------------------------------------------------------------------
      # PHASE 3: SOURCE FILE HEADER NOTICES (EN-932)
      # -----------------------------------------------------------------------
      - id: 3
        name: "Source File SPDX Header Notices"
        path_id: "phase-3-headers"
        status: "COMPLETE"
        blocked_by: null  # Unblocked by QG-2 PASS
        enablers: ["EN-932"]
        execution_mode: "SEQUENTIAL"
        effort_points: 5
        started_at: "2026-02-17T00:00:00Z"
        completed_at: "2026-02-17T00:00:00Z"
        gate_after: "qg-3"

        header_template: |
          # SPDX-License-Identifier: Apache-2.0
          # Copyright (c) 2026 Adam Nowak

        header_scope:
          - "src/**/*.py"
          - "scripts/**/*.py"
          - "hooks/**/*.py"
          - "tests/**/*.py"

        shebang_rule: "Insert header AFTER shebang line (if present), not before"

        agents:
          - id: "header-applicator"
            name: "SPDX Header Applicator"
            status: "COMPLETE"
            enabler: "EN-932"
            artifact: "orchestration/feat015-licmig-20260217-001/lic/phase-3-headers/header-applicator/header-applicator-output.md"
            description: >
              Apply SPDX-License-Identifier: Apache-2.0 header to ALL .py files in
              src/, scripts/, hooks/, tests/. Handle shebangs correctly (header after
              shebang). Document every file modified.

          - id: "header-verifier"
            name: "SPDX Header Verifier"
            status: "COMPLETE"
            enabler: "EN-932"
            artifact: "orchestration/feat015-licmig-20260217-001/lic/phase-3-headers/header-verifier/header-verifier-output.md"
            depends_on: "header-applicator"
            description: >
              Independent scan of all .py files to verify 100% SPDX header coverage.
              Report any files missing header. Run uv run pytest to confirm no regressions.

        artifacts:
          - path: "orchestration/feat015-licmig-20260217-001/lic/phase-3-headers/header-applicator/header-applicator-output.md"
            status: "COMPLETE"
            agent: "header-applicator"
          - path: "orchestration/feat015-licmig-20260217-001/lic/phase-3-headers/header-verifier/header-verifier-output.md"
            status: "COMPLETE"
            agent: "header-verifier"

      # -----------------------------------------------------------------------
      # PHASE 4: CI LICENSE HEADER VALIDATION (EN-935)
      # -----------------------------------------------------------------------
      - id: 4
        name: "CI License Header Validation"
        path_id: "phase-4-ci"
        status: "COMPLETE"
        blocked_by: null  # Unblocked by QG-3 PASS
        enablers: ["EN-935"]
        execution_mode: "SEQUENTIAL"
        effort_points: 3
        started_at: "2026-02-17T00:00:00Z"
        completed_at: "2026-02-17T00:00:00Z"
        gate_after: "qg-final"

        agents:
          - id: "ci-validator-implementer"
            name: "CI Validator Implementer"
            status: "COMPLETE"
            enabler: "EN-935"
            artifact: "orchestration/feat015-licmig-20260217-001/lic/phase-4-ci/ci-validator-implementer/ci-validator-implementer-output.md"
            description: >
              Implement pre-commit hook and CI workflow step to enforce SPDX header
              presence on all .py files. Update .pre-commit-config.yaml and CI workflow.

          - id: "ci-validator-tester"
            name: "CI Validator Tester"
            status: "COMPLETE"
            enabler: "EN-935"
            artifact: "orchestration/feat015-licmig-20260217-001/lic/phase-4-ci/ci-validator-tester/ci-validator-tester-output.md"
            depends_on: "ci-validator-implementer"
            description: >
              Validate the implementation: run positive test (existing files pass) and
              negative test (a file missing header is caught). Document test results.

        artifacts:
          - path: "orchestration/feat015-licmig-20260217-001/lic/phase-4-ci/ci-validator-implementer/ci-validator-implementer-output.md"
            status: "COMPLETE"
            agent: "ci-validator-implementer"
          - path: "orchestration/feat015-licmig-20260217-001/lic/phase-4-ci/ci-validator-tester/ci-validator-tester-output.md"
            status: "COMPLETE"
            agent: "ci-validator-tester"

# =============================================================================
# QUALITY GATES
# =============================================================================
# C2 Required Strategies: S-014 (LLM-as-Judge), S-007 (Constitutional AI Critique), S-002 (Devil's Advocate)
# H-16 Ordering: S-003 (Steelman) MUST precede S-002 (Devil's Advocate) if applied
# Threshold: >= 0.92 (H-13)
# Max iterations: 3 (H-14)
quality_gates:

  qg-1:
    id: "qg-1"
    name: "Audit Quality Gate"
    after_phase: 1
    status: "PASS"  # PENDING | IN_PROGRESS | PASS | FAIL | ESCALATED
    deliverables_scored:
      - "orchestration/feat015-licmig-20260217-001/lic/phase-1-audit/audit-executor/audit-executor-dep-audit.md"
    threshold: 0.92
    max_iterations: 3
    current_iteration: 3
    required_strategies: ["S-014", "S-007", "S-002"]
    optional_strategies: ["S-003", "S-010"]
    agents_invoked: ["adv-scorer", "adv-executor"]
    iteration_history:
      - iteration: 1
        score: 0.825
        verdict: "REJECTED"
        strategies:
          S-014: { score: 0.825, verdict: "REJECTED" }
          S-007: { score: 0.89, verdict: "NON-COMPLIANT (REVISE)" }
          S-002: { verdict: "PASS-PROVISIONAL", major_findings: 6, minor_findings: 4 }
        primary_defect: "Count inconsistency (Summary 8 dev vs Verdict 6 dev), MPL-2.0 legal reasoning, absent deps unverified"
      - iteration: 2
        score: 0.916
        verdict: "REVISE"
        strategies:
          S-014: { score: 0.916, verdict: "REVISE" }
          S-007: { score: 0.98, verdict: "COMPLIANT (PASS)" }
          S-002: { estimated_score: 0.892, verdict: "REVISE", major_findings: 3, minor_findings: 4 }
        primary_defect: "Evidence Quality 0.87 (MPL-2.0 text URL absent, pip-licenses JSON not attached). DA-011 pip-licenses double-counting."
      - iteration: 3
        score: 0.941
        verdict: "PASS"
        strategies:
          S-014: { score: 0.941, verdict: "PASS" }
          S-007: { score: 0.98, verdict: "COMPLIANT (PASS)" }
          S-002: { estimated_score: 0.942, verdict: "PASS", major_findings: 0, minor_findings: 2 }
        primary_defect: null
    score: 0.941
    score_dimensions:
      completeness: 0.94      # weight: 0.20 — All dependency categories covered, pip-licenses self-exclusion documented
      internal_consistency: 0.94  # weight: 0.20 — Count reconciliation complete, dual-PASS verdict coherent
      methodological_rigor: 0.95  # weight: 0.20 — pip-licenses JSON artifact, uv.lock-resolved version verification
      evidence_quality: 0.93  # weight: 0.15 — MPL-2.0 text URL, certifi Exhibit B citation, PyPI JSON API
      actionability: 0.94     # weight: 0.15 — SC-001, re-audit conditions, scope limitations documented
      traceability: 0.94      # weight: 0.10 — Git commit anchoring (1c108b4, 1fea04c), revision history
    artifact: "orchestration/feat015-licmig-20260217-001/lic/quality-gates/qg-1/gate-result.md"
    completed_at: "2026-02-17T00:00:00Z"

  qg-2:
    id: "qg-2"
    name: "Core License Changes Quality Gate"
    after_phase: 2
    status: "PASS"
    deliverables_scored:
      - "orchestration/feat015-licmig-20260217-001/lic/phase-2-core/license-replacer/license-replacer-output.md"
      - "orchestration/feat015-licmig-20260217-001/lic/phase-2-core/notice-creator/notice-creator-output.md"
      - "orchestration/feat015-licmig-20260217-001/lic/phase-2-core/metadata-updater/metadata-updater-output.md"
    threshold: 0.92
    max_iterations: 3
    current_iteration: 2
    required_strategies: ["S-014", "S-007", "S-002"]
    optional_strategies: ["S-003", "S-010"]
    agents_invoked: ["adv-scorer", "adv-executor"]
    iteration_history:
      - iteration: 1
        score: 0.9595
        verdict: "REVISE"
        strategies:
          S-014: { score: 0.9595, verdict: "PASS" }
          S-007: { score: 0.91, verdict: "REVISE", major_findings: 1, minor_findings: 2 }
          S-002: { estimated_score: 0.909, verdict: "REVISE", critical_findings: 1, major_findings: 3, minor_findings: 3 }
        primary_defect: "DA-001 copyright holder inconsistency (NOTICE vs header_template). CC-001 H-23 nav table missing. DA-002 README MIT split-license state."
        revisions_applied:
          - "CC-001: Added nav table to metadata-updater-output.md"
          - "DA-001: Aligned Phase 3 header_template to 'Adam Nowak' (matches NOTICE)"
          - "DA-001: Updated ORCHESTRATION_PLAN.md header template to match"
      - iteration: 2
        score: 0.9505
        verdict: "PASS"
        strategies:
          S-014: { score: 0.9505, verdict: "PASS" }
          S-007: { score: 0.96, verdict: "PASS", major_findings: 0, minor_findings: 2 }
          S-002: { estimated_score: 0.937, verdict: "PASS", critical_findings: 0, major_findings: 0, minor_findings: 0, adequately_justified: 6 }
        primary_defect: null
    score: 0.9505
    score_dimensions:
      completeness: 0.95      # weight: 0.20 — All 3 enablers complete. DA-002 README refs acknowledged (branch isolation).
      internal_consistency: 0.96  # weight: 0.20 — DA-001 resolved. Copyright chain consistent across NOTICE/YAML/PLAN.
      methodological_rigor: 0.95  # weight: 0.20 — DA-003 PEP 639 justified (hatchling compat). DA-004 NOTICE minimal format per ASF convention.
      evidence_quality: 0.96  # weight: 0.15 — DA-001 3-location cross-check. DA-005 post-push verification acknowledged.
      actionability: 0.95     # weight: 0.15 — Phase 3 unblocked. EN-933 handoff table enables downstream.
      traceability: 0.92      # weight: 0.10 — Copyright identity traceable. QG-2 audit trail complete.
    artifact: "orchestration/feat015-licmig-20260217-001/lic/quality-gates/qg-2/gate-result.md"
    completed_at: "2026-02-17T00:00:00Z"

  qg-3:
    id: "qg-3"
    name: "Source File Headers Quality Gate"
    after_phase: 3
    status: "PASS"
    deliverables_scored:
      - "orchestration/feat015-licmig-20260217-001/lic/phase-3-headers/header-applicator/header-applicator-output.md"
      - "orchestration/feat015-licmig-20260217-001/lic/phase-3-headers/header-verifier/header-verifier-output.md"
    threshold: 0.92
    max_iterations: 3
    current_iteration: 2
    required_strategies: ["S-014", "S-007", "S-002"]
    optional_strategies: ["S-003", "S-010"]
    agents_invoked: ["adv-scorer", "adv-executor"]
    iteration_history:
      - iteration: 1
        score: 0.873
        verdict: "REVISE"
        strategies:
          S-014: { score: 0.873, verdict: "REVISE" }
          S-007: { score: 0.81, verdict: "REJECTED", major_findings: 3, minor_findings: 3 }
          S-002: { verdict: "REVISE", major_findings: 3, minor_findings: 3 }
        primary_defect: "Shebang roster mismatch between applicator and verifier (bootstrap_context.py vs validate_schemas.py). Missing version metadata. No criteria cross-reference."
      - iteration: 2
        score: 0.935
        verdict: "PASS"
        strategies:
          S-014: { score: 0.935, verdict: "PASS" }
          S-007: { score: 0.96, verdict: "PASS", major_findings: 0, minor_findings: 2 }
          S-002: { estimated_score: 0.935, verdict: "ACCEPT", major_findings: 0, minor_findings: 2 }
        primary_defect: null
    score: 0.935
    score_dimensions:
      completeness: 0.95      # weight: 0.20 — 403/403 files covered, 9 out-of-scope documented
      internal_consistency: 0.93  # weight: 0.20 — Shebang roster aligned, criteria cross-referenced
      methodological_rigor: 0.94  # weight: 0.20 — Independent applicator+verifier pattern, 5-criterion check
      evidence_quality: 0.91  # weight: 0.15 — Verifier confirms applicator, test suite 3196 passed
      actionability: 0.95     # weight: 0.15 — Scope clarification, out-of-scope rationale documented
      traceability: 0.95      # weight: 0.10 — EN-932 AC traceable, version metadata present
    artifact: "orchestration/feat015-licmig-20260217-001/lic/quality-gates/qg-3/gate-result.md"
    completed_at: "2026-02-17T00:00:00Z"

  qg-final:
    id: "qg-final"
    name: "FEAT-015 Final Quality Gate"
    after_phase: 4
    status: "PENDING"
    deliverables_scored:
      - "orchestration/feat015-licmig-20260217-001/lic/phase-1-audit/audit-executor/audit-executor-dep-audit.md"
      - "orchestration/feat015-licmig-20260217-001/lic/phase-2-core/license-replacer/license-replacer-output.md"
      - "orchestration/feat015-licmig-20260217-001/lic/phase-2-core/notice-creator/notice-creator-output.md"
      - "orchestration/feat015-licmig-20260217-001/lic/phase-2-core/metadata-updater/metadata-updater-output.md"
      - "orchestration/feat015-licmig-20260217-001/lic/phase-3-headers/header-verifier/header-verifier-output.md"
      - "orchestration/feat015-licmig-20260217-001/lic/phase-4-ci/ci-validator-tester/ci-validator-tester-output.md"
    threshold: 0.92
    max_iterations: 3
    current_iteration: 0
    required_strategies: ["S-014", "S-007", "S-002"]
    optional_strategies: ["S-003", "S-010"]
    agents_invoked: ["adv-scorer", "adv-executor"]
    score: null
    score_dimensions:
      completeness: null      # weight: 0.20 — All 6 enablers fully complete?
      internal_consistency: null  # weight: 0.20 — All artifacts consistent with each other?
      methodological_rigor: null  # weight: 0.20 — Full workflow followed correctly?
      evidence_quality: null  # weight: 0.15 — All evidence authoritative and verifiable?
      actionability: null     # weight: 0.15 — Migration is immediately deployable?
      traceability: null      # weight: 0.10 — All changes traceable to FEAT-015?
    artifact: "orchestration/feat015-licmig-20260217-001/lic/quality-gates/qg-final/gate-result.md"
    completed_at: null

# =============================================================================
# EXECUTION QUEUE
# =============================================================================
execution_queue:
  current_group: 8
  groups:

    - id: 1
      name: "Phase 1 — Dependency Audit"
      execution_mode: "SEQUENTIAL"
      status: "COMPLETE"
      agents: ["audit-executor"]

    - id: 2
      name: "Quality Gate 1"
      execution_mode: "SEQUENTIAL"
      status: "COMPLETE"
      blocked_by: "group-1"
      tasks: ["run-adv-scorer-qg1", "run-adv-executor-s007-qg1", "run-adv-executor-s002-qg1"]

    - id: 3
      name: "Phase 2 — Core License Changes"
      execution_mode: "PARALLEL"
      status: "COMPLETE"
      blocked_by: "group-2"
      agents: ["license-replacer", "notice-creator", "metadata-updater"]

    - id: 4
      name: "Quality Gate 2"
      execution_mode: "SEQUENTIAL"
      status: "COMPLETE"
      blocked_by: "group-3"
      tasks: ["run-adv-scorer-qg2", "run-adv-executor-s007-qg2", "run-adv-executor-s002-qg2"]

    - id: 5
      name: "Phase 3 — Source File Headers"
      execution_mode: "SEQUENTIAL"
      status: "COMPLETE"
      blocked_by: "group-4"
      agents: ["header-applicator", "header-verifier"]

    - id: 6
      name: "Quality Gate 3"
      execution_mode: "SEQUENTIAL"
      status: "COMPLETE"
      blocked_by: "group-5"
      tasks: ["run-adv-scorer-qg3", "run-adv-executor-s007-qg3", "run-adv-executor-s002-qg3"]

    - id: 7
      name: "Phase 4 — CI Validation"
      execution_mode: "SEQUENTIAL"
      status: "COMPLETE"
      blocked_by: "group-6"
      agents: ["ci-validator-implementer", "ci-validator-tester"]

    - id: 8
      name: "Quality Gate Final"
      execution_mode: "SEQUENTIAL"
      status: "READY"
      blocked_by: "group-7"
      tasks: ["run-adv-scorer-qg-final", "run-adv-executor-s007-qg-final", "run-adv-executor-s002-qg-final"]

# =============================================================================
# CHECKPOINTS
# =============================================================================
checkpoints:
  latest_id: "CP-003"
  entries:
    - id: "CP-001"
      timestamp: "2026-02-17T00:00:00Z"
      trigger: "GATE_PASS"
      description: "QG-1 PASS (0.941) — Phase 1 dependency audit complete, Phase 2 unblocked"
      recovery_point: "phase-2-start"
    - id: "CP-002"
      timestamp: "2026-02-17T00:00:00Z"
      trigger: "GATE_PASS"
      description: "QG-2 PASS (0.9505) — Phase 2 core license changes complete, Phase 3 unblocked"
      recovery_point: "phase-3-start"
    - id: "CP-003"
      timestamp: "2026-02-17T00:00:00Z"
      trigger: "GATE_PASS"
      description: "QG-3 PASS (0.935) — Phase 3 source file headers complete, Phase 4 unblocked"
      recovery_point: "phase-4-start"

# =============================================================================
# METRICS
# =============================================================================
metrics:
  execution:
    phases_complete: 4
    phases_total: 4
    phases_percent: 100
    gates_passed: 3
    gates_total: 4
    gates_percent: 75
    agents_executed: 8  # audit-executor + license-replacer + notice-creator + metadata-updater + header-applicator + header-verifier + ci-validator-implementer + ci-validator-tester
    agents_total: 8
    agents_percent: 100
    artifacts_created: 9  # audit report + pip-licenses JSON + 3 phase-2 outputs + 2 phase-3 outputs + 2 phase-4 outputs
    artifacts_total: 12  # 8 phase artifacts + 4 gate result artifacts
    artifacts_percent: 75
    enablers_complete: 6  # EN-934, EN-930, EN-931, EN-933, EN-932, EN-935
    enablers_total: 6
    enablers_percent: 100
    effort_complete: 14  # 3 (EN-934) + 1+1+1 (EN-930/931/933) + 5 (EN-932) + 3 (EN-935)
    effort_total: 14

  quality:
    qg_1_score: 0.941  # Iteration 3: PASS (0.825 -> 0.916 -> 0.941)
    qg_2_score: 0.9505  # Iteration 2: PASS (0.9595 REVISE -> 0.9505 PASS)
    qg_3_score: 0.935  # Iteration 2: PASS (0.873 REVISE -> 0.935 PASS)
    qg_final_score: null
    gates_passed_first_attempt: 0
    gates_requiring_revision: 3  # QG-1 required 3 iterations, QG-2 required 2 iterations, QG-3 required 2 iterations
    gates_escalated_to_user: 0
    overall_quality_status: "QG3_PASS"

  timing:
    workflow_started: "2026-02-17T00:00:00Z"
    last_activity: "2026-02-17T00:00:00Z"
    estimated_completion: null

# =============================================================================
# BLOCKERS AND ISSUES
# =============================================================================
blockers:
  active: []
  # Critical blocker pattern: EN-934 audit finds incompatible dependency
  # - id: "BLK-001"
  #   description: "Incompatible dependency found: <dep-name> (<license>)"
  #   blocking: ["license-replacer", "notice-creator", "metadata-updater", "header-applicator"]
  #   severity: "HIGH"
  #   created_at: "<timestamp>"
  #   resolution_required: "Upgrade, replace, or document exception"

issues:
  resolved: []

# =============================================================================
# NEXT ACTIONS
# =============================================================================
next_actions:
  immediate:
    - action: "Run Quality Gate Final via /adversary skill"
      agents: ["adv-scorer", "adv-executor"]
      execution_mode: "SEQUENTIAL"
      instructions: >
        Score all FEAT-015 deliverables. C2 required strategies: S-014, S-007, S-002.
        Threshold >= 0.92. Score the full deliverable set across all 4 phases.

  subsequent:
    - action: "Close FEAT-015 and update WORKTRACKER.md"
      depends_on: "QG-FINAL PASS"

# =============================================================================
# RESUMPTION CONTEXT
# =============================================================================
resumption:
  last_checkpoint: "CP-003"
  current_state: "All 4 phases COMPLETE. All 6 enablers DONE (EN-930-935). 3/4 quality gates PASSED (QG-1: 0.941, QG-2: 0.9505, QG-3: 0.935). QG-Final pending."
  next_step: "Run QG-Final adversarial review on full FEAT-015 deliverable set. If PASS: close FEAT-015 and update WORKTRACKER.md."

  files_to_read:
    - "projects/PROJ-001-oss-release/ORCHESTRATION_PLAN.md"   # Strategic context
    - "projects/PROJ-001-oss-release/ORCHESTRATION.yaml"       # This file — machine-readable state (SSOT)
    - "projects/PROJ-001-oss-release/WORKTRACKER.md"           # Tactical documentation

  cross_session_portable: true
  ephemeral_references: false
