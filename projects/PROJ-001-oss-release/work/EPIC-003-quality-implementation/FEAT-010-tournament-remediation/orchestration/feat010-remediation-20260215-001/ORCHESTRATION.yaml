# ORCHESTRATION.yaml
# Machine-readable orchestration state for FEAT-010 Tournament Remediation
# Document ID: PROJ-001-ORCH-STATE-FEAT010
# Version: 2.0
# Last Updated: 2026-02-15

schema_version: "2.0.0"

# =============================================================================
# WORKFLOW METADATA
# =============================================================================
workflow:
  id: "feat010-remediation-20260215-001"
  name: "FEAT-010 Tournament Remediation"
  project_id: "PROJ-001-oss-release"
  version: "2.0"
  created_at: "2026-02-15T00:00:00Z"
  updated_at: "2026-02-15T00:00:00Z"
  status: "ACTIVE"

  id_source: "auto"
  id_format: "semantic-date-seq"

  patterns:
    - SEQUENTIAL
    - CONCURRENT  # Enablers within phases run in parallel

  constraints:
    max_agent_nesting: 1          # P-003: Single nesting
    file_persistence: true        # P-002: All state to filesystem
    user_authority: true          # P-020: User approves gates
    max_concurrent_agents: 3      # Max parallel enablers per phase
    max_iterations_per_enabler: 4 # User directive (override of default 3)
    checkpoint_frequency: "PHASE"

# =============================================================================
# QUALITY CONFIGURATION (C4)
# =============================================================================
quality:
  criticality: "C4"
  threshold: 0.92
  scoring_mechanism: "S-014"
  max_iterations: 4
  human_escalation_after: 4

  strategies_required:
    - "S-001"  # Red Team
    - "S-002"  # Devil's Advocate
    - "S-003"  # Steelman
    - "S-004"  # Pre-Mortem
    - "S-007"  # Constitutional AI
    - "S-010"  # Self-Refine
    - "S-011"  # CoVe
    - "S-012"  # FMEA
    - "S-013"  # Inversion
    - "S-014"  # LLM-as-Judge

  scoring_dimensions:
    completeness: { weight: 0.20, min: 0.88 }
    internal_consistency: { weight: 0.20, min: 0.88 }
    methodological_rigor: { weight: 0.20, min: 0.88 }
    evidence_quality: { weight: 0.15, min: 0.85 }
    actionability: { weight: 0.15, min: 0.85 }
    traceability: { weight: 0.10, min: 0.85 }

  enabler_scores:
    EN-813: { score: 0.906, iterations: 3, status: "REVISE" }
    EN-814: { score: 0.950, iterations: 3, status: "PASS" }
    EN-815: { score: 0.922, iterations: 2, status: "PASS" }
    EN-816: { score: null, iterations: 0, status: "PENDING" }
    EN-817: { score: null, iterations: 0, status: "PENDING" }
    EN-818: { score: null, iterations: 0, status: "PENDING" }
    EN-819: { score: null, iterations: 0, status: "PENDING" }

  workflow_quality:
    average_score: null
    lowest_score: null
    total_iterations: 8
    gates_passed: 2
    gates_failed: 0
    feat009_rescore: null

# =============================================================================
# PATH CONFIGURATION
# =============================================================================
paths:
  base: "FEAT-010-tournament-remediation/orchestration/feat010-remediation-20260215-001/"
  impl: "{base}impl/"
  synthesis: "{base}synthesis/"
  checkpoints: "{base}checkpoints/"

# =============================================================================
# PIPELINE DEFINITION (Single Pipeline)
# =============================================================================
pipeline:
  id: "remediation"
  name: "FEAT-010 Tournament Remediation Pipeline"
  short_alias: "impl"
  status: "PHASE_1_IN_PROGRESS"
  current_phase: 1
  total_phases: 4
  progress_percent: 0

  phases:
    - id: 1
      name: "P0 Critical Fixes"
      path_id: "phase-1-p0-critical"
      status: "IN_PROGRESS"
      started_at: "2026-02-15T20:00:00Z"
      completed_at: null
      enablers:
        - id: "EN-813"
          name: "Template Context Optimization"
          status: "REVISE"
          effort: 5
          tasks: 4
          findings: ["T-001"]
          iterations: 3
          score: 0.906
          creator_agent: "sonnet"
          critic_agent: "opus"
          critic_findings_iter1: ["CR-001: Section heading format mismatch (Critical)", "CR-002: Token count claims ~4x off (Critical)", "CR-003: No parsing validation (Major)"]
          critic_findings_iter2: ["CR-004: 2/10 templates use ## Section N: format (Critical)", "CR-005: 10K token target infeasible ~20K (Major)", "CR-006: No heading mismatch fallback (Major)", "CR-007: Section order incomplete (Minor)", "CR-008: PLAYBOOK numbered section refs (Minor)"]
          critic_findings_iter3: ["CR-009: PLAYBOOK line 530 stale 10K token ref (Minor)", "CR-010: PLAYBOOK line 535 numbered section refs (Minor)"]

        - id: "EN-814"
          name: "Finding ID Scoping & Uniqueness"
          status: "PASS"
          effort: 3
          tasks: 3
          findings: ["T-002"]
          iterations: 3
          score: 0.950
          creator_agent: "sonnet"
          critic_agent: "opus"
          critic_findings_iter1: ["CR-001: Body text old PREFIX-NNN format in all 10 templates (Critical)", "CR-002: TEMPLATE-FORMAT catalog table inconsistent (Major)", "CR-005: S-010 Output Format placeholders (Major)"]
          critic_findings_iter2: ["CR-006: S-010 Identity table double {execution_id} (Major)", "CR-007: S-010 Examples section bare SR-NNN IDs (Major)"]
          critic_findings_iter3: []

        - id: "EN-815"
          name: "Documentation & Navigation Fixes"
          status: "PASS"
          effort: 2
          tasks: 5
          findings: ["T-007", "T-023", "T-026", "T-027", "T-028"]
          iterations: 2
          score: 0.922
          creator_agent: "sonnet"
          critic_agent: "opus"
          critic_findings_iter1: ["LJ-001: S-007 nav anchor targets HTML comment (Major)", "LJ-002: S-014 Step 6 redundant 0.95 items (Major)", "LJ-003: EN-815 metadata stale (Minor)"]
          critic_findings_iter2: ["LJ-001-iter2: S-010 Finding Prefix duplication (Minor, FIXED)", "LJ-002-iter2: EN-815 metadata deferred (Minor)"]

    - id: 2
      name: "P1 Documentation & Runtime"
      path_id: "phase-2-p1-docs-runtime"
      status: "BLOCKED"
      blocked_by: "phase-1"
      started_at: null
      completed_at: null
      enablers:
        - id: "EN-816"
          name: "Skill Documentation Completeness"
          status: "PENDING"
          effort: 3
          tasks: 4
          findings: ["T-008", "T-014", "T-022"]
          iterations: 0
          score: null
          creator_agent: null
          critic_agent: null

        - id: "EN-817"
          name: "Runtime Enforcement"
          status: "PENDING"
          effort: 5
          tasks: 5
          findings: ["T-004", "T-006", "T-009"]
          iterations: 0
          score: null
          creator_agent: null
          critic_agent: null

    - id: 3
      name: "P1 CI & SSOT"
      path_id: "phase-3-p1-ci-ssot"
      status: "BLOCKED"
      blocked_by: "phase-2"
      started_at: null
      completed_at: null
      enablers:
        - id: "EN-818"
          name: "Template Validation CI Gate"
          status: "PENDING"
          effort: 5
          tasks: 4
          findings: ["T-005", "T-003"]
          iterations: 0
          score: null
          creator_agent: null
          critic_agent: null

        - id: "EN-819"
          name: "SSOT Consistency & Template Resilience"
          status: "PENDING"
          effort: 3
          tasks: 4
          findings: ["T-017", "T-016"]
          iterations: 0
          score: null
          creator_agent: null
          critic_agent: null

    - id: 4
      name: "Integration Validation & Synthesis"
      path_id: "phase-4-integration"
      status: "BLOCKED"
      blocked_by: "phase-3"
      started_at: null
      completed_at: null
      steps:
        - id: "4.1"
          name: "Full E2E test suite"
          status: "PENDING"
          command: "uv run pytest tests/e2e/ -v"

        - id: "4.2"
          name: "Ruff + type checks"
          status: "PENDING"
          command: "uv run ruff check src/"

        - id: "4.3"
          name: "Re-score FEAT-009 with S-014"
          status: "PENDING"
          agent: "feat009-rescorer"

        - id: "4.4"
          name: "Create Final Synthesis"
          status: "PENDING"
          agent: "feat010-synthesizer"

        - id: "4.5"
          name: "Update FEAT-010 worktracker"
          status: "PENDING"

# =============================================================================
# EXECUTION QUEUE
# =============================================================================
execution_queue:
  current_group: 3
  groups:
    - id: 1
      name: "Phase 1: EN-813 + EN-814 + EN-815 (parallel creators)"
      execution_mode: "PARALLEL"
      status: "COMPLETE"
      agents:
        - "en813-creator"
        - "en814-creator"
        - "en815-creator"

    - id: 2
      name: "Phase 1: Critic cycles (parallel per enabler)"
      execution_mode: "PARALLEL"
      status: "COMPLETE"
      agents:
        - "en813-critic"
        - "en814-critic"
        - "en815-critic"

    - id: 3
      name: "Phase 1: Revision + Critic iteration 2 (all 3 enablers)"
      execution_mode: "PARALLEL"
      status: "COMPLETE"
      note: "Iter 2 scores: EN-813: 0.840 (REVISE), EN-814: 0.917 (REVISE), EN-815: 0.922 (PASS conditional)"

    - id: "3b"
      name: "Phase 1: Revision iteration 2 + Critic iteration 3 (EN-813 + EN-814)"
      execution_mode: "PARALLEL"
      status: "COMPLETE"
      note: "EN-814: PASS 0.950. EN-813: 0.906 REVISE (CR-009/CR-010 Minor). EN-815: PASS 0.922."

    - id: "3c"
      name: "Phase 1: EN-813 final revision + critic iteration 4"
      execution_mode: "SEQUENTIAL"
      status: "IN_PROGRESS"
      note: "EN-813 CR-009/CR-010 fixes applied to PLAYBOOK.md. Awaiting critic iteration 4."

    - id: 4
      name: "Phase 2: EN-816 + EN-817 (parallel creators)"
      execution_mode: "PARALLEL"
      status: "BLOCKED"
      blocked_by: "phase-1-complete"
      agents:
        - "en816-creator"
        - "en817-creator"

    - id: 5
      name: "Phase 2: Critic + revision cycles"
      execution_mode: "PARALLEL"
      status: "BLOCKED"
      blocked_by: "group-4"

    - id: 6
      name: "Phase 3: EN-818 + EN-819 (parallel creators)"
      execution_mode: "PARALLEL"
      status: "BLOCKED"
      blocked_by: "phase-2-complete"
      agents:
        - "en818-creator"
        - "en819-creator"

    - id: 7
      name: "Phase 3: Critic + revision cycles"
      execution_mode: "PARALLEL"
      status: "BLOCKED"
      blocked_by: "group-6"

    - id: 8
      name: "Phase 4: Integration validation"
      execution_mode: "SEQUENTIAL"
      status: "BLOCKED"
      blocked_by: "phase-3-complete"

# =============================================================================
# CHECKPOINTS
# =============================================================================
checkpoints:
  latest_id: null
  entries: []

# =============================================================================
# METRICS
# =============================================================================
metrics:
  execution:
    phases_complete: 0
    phases_total: 4
    phases_percent: 0
    enablers_complete: 0
    enablers_total: 7
    enablers_percent: 0
    tasks_complete: 0
    tasks_total: 29
    tasks_percent: 0

  quality:
    average_enabler_score: null
    lowest_enabler_score: null
    total_iterations: 0
    human_escalations: 0

  timing:
    workflow_started: "2026-02-15T20:00:00Z"
    last_activity: "2026-02-15T22:40:00Z"
    estimated_completion: null

# =============================================================================
# BLOCKERS AND ISSUES
# =============================================================================
blockers:
  active: []

issues:
  resolved: []

# =============================================================================
# NEXT ACTIONS
# =============================================================================
next_actions:
  immediate:
    - action: "EN-813 critic iteration 4 (final attempt — CR-009/CR-010 fixes applied)"
      execution_mode: "SEQUENTIAL"

  subsequent:
    - action: "Phase 1 checkpoint CP-001 upon EN-813 PASS"
      depends_on: "EN-813 >= 0.92"
    - action: "Execute Phase 2 (EN-816 + EN-817 parallel creators)"
      depends_on: "Phase 1 all enablers >= 0.92"

# =============================================================================
# RESUMPTION CONTEXT
# =============================================================================
resumption:
  last_checkpoint: null
  current_state: "Phase 1 — EN-814 PASS (0.950), EN-815 PASS (0.922), EN-813 REVISE (0.906) — CR-009/CR-010 fixes applied"
  next_step: "Run critic iteration 4 for EN-813 (final attempt). If PASS, create CP-001 and proceed to Phase 2."

  files_to_read:
    - "ORCHESTRATION_PLAN.md"
    - "ORCHESTRATION_WORKTRACKER.md"
    - "ORCHESTRATION.yaml"

  cross_session_portable: true
  ephemeral_references: false
