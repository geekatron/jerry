# WI-04-002: Add PreToolUse Hook for Write/Edit Validation

| Metadata | Value |
|----------|-------|
| **ID** | wi-04-002 |
| **Phase** | 4 - Hook System |
| **Status** | DONE |
| **Completed** | 2026-01-12 |
| **Priority** | MEDIUM |
| **Created** | 2026-01-12 |

---

## Summary

Add PreToolUse hook configuration for Write/Edit operations to enable quality assurance and security validation before file modifications.

---

## Tasks

- [x] Add PreToolUse hook section to hooks.json
- [x] Configure matcher for "Write|Edit" operations
- [x] Point command to pre_tool_use.py script
- [x] Set appropriate timeout (5000ms)
- [x] Create stub pre_tool_use.py script if needed (already exists in scripts/)
- [x] Test hook fires on Write/Edit operations

---

## Acceptance Criteria

- [x] hooks.json contains PreToolUse section
- [x] Matcher correctly identifies Write and Edit operations
- [x] Hook script path uses `${CLAUDE_PLUGIN_ROOT}`
- [x] Timeout configured appropriately
- [x] Hook fires on Write operations
- [x] Hook fires on Edit operations

---

## Verification Evidence

### Actual hooks.json Content (hooks/hooks.json:16-27)
```json
"PreToolUse": [
  {
    "matcher": "Write|Edit",
    "hooks": [
      {
        "type": "command",
        "command": "python3 ${CLAUDE_PLUGIN_ROOT}/scripts/pre_tool_use.py",
        "timeout": 5000
      }
    ]
  }
]
```

### Also Added Stop Hook (hooks/hooks.json:28-39)
```json
"Stop": [
  {
    "matcher": "subagent:*",
    "hooks": [
      {
        "type": "command",
        "command": "python3 ${CLAUDE_PLUGIN_ROOT}/scripts/subagent_stop.py",
        "timeout": 5000
      }
    ]
  }
]
```

### Validation Results (2026-01-12)
```bash
$ python3 -c "import json; json.load(open('hooks/hooks.json'))"
# (exits 0 - JSON valid)

$ grep -q '"PreToolUse"' hooks/hooks.json && echo "PreToolUse: OK"
PreToolUse: OK

$ grep -q '"Write|Edit"' hooks/hooks.json && echo "Matcher: OK"
Matcher: OK
```

### Output Artifacts
- **File**: `hooks/hooks.json` (modified - added PreToolUse and Stop hooks)
- **File**: `scripts/pre_tool_use.py` (already existed)
- **File**: `scripts/subagent_stop.py` (already existed)

### Source Reference
- proj-003-e-001: Hook lifecycle patterns
- ADR-PROJ003-001: PreToolUse validation requirement

---

## Relationships

| Type | ID | Description |
|------|----|-------------|
| depends_on | wi-04-001 | Portable paths must be configured |
| parallel | wi-04-003 | Can proceed in parallel |
| blocks | wi-04-004 | Cleanup requires hooks configured |

---

## Notes

PreToolUse hooks can approve, reject, or modify tool invocations. The pre_tool_use.py script already
existed in scripts/ (migrated in wi-04-003). Also added the Stop hook for subagent cleanup using
subagent_stop.py which was also already migrated.
