# WI-07-002: Research venv best practices for Python portability

> **Status:** DONE
> **Phase:** 7 - Python Environment Standardization
> **Created:** 2026-01-12
> **Assignee:** Claude

---

## Objective

Research Python virtual environment best practices to ensure Jerry framework is portable across:
1. Local development (macOS, Linux, Windows)
2. CI/CD pipelines (GitHub Actions)
3. Claude Code plugin/skill execution environments

---

## Research Questions

1. What are the official Python venv standards (PEPs)?
2. How does `uv` compare to standard `venv` + `pip`?
3. What Python versions are available on macOS by default?
4. What environment does Claude Code run plugins/skills in?
5. What are best practices for lockfile management?
6. How should the project support both `uv` and standard pip workflows?

---

## Tasks

- [x] Research PEP 405 (venv) and PEP 517/518 (build system)
- [x] Research uv documentation and compatibility
- [x] Research Claude Code environment constraints
- [x] Research macOS system Python versions
- [x] Document findings with citations

---

## Research Findings

### Section 1: Python Virtual Environment Standards

**PEP 405 - Python Virtual Environments** (Python 3.3+)

Per [PEP 405](https://peps.python.org/pep-0405/):
> "A Python virtual environment in its simplest form consists of nothing more than a copy or symlink of the Python binary accompanied by a site-packages directory and a pyvenv.cfg file with a home key."

**Key Standards:**
| PEP | Purpose | Status |
|-----|---------|--------|
| PEP 405 | Virtual environment specification | Active (Python 3.3+) |
| PEP 517 | Build system interface | Active |
| PEP 518 | Build requirements (pyproject.toml) | Active |
| PEP 660 | Editable installs via PEP 517 | Active |

**Best Practices (2025-2026):**
- Use `python -m venv` or `uv venv` for environment creation
- Prefer symlinks over copies for Python binaries
- Use `pyproject.toml` for project configuration
- Editable installs (`pip install -e .`) for development

**Sources:**
- [PEP 405](https://peps.python.org/pep-0405/)
- [Python venv docs](https://docs.python.org/3/library/venv.html)
- [Python Packaging User Guide](https://packaging.python.org/en/latest/specifications/virtual-environments/)

---

### Section 2: uv vs Standard venv+pip

**Performance Comparison:**

| Metric | uv | pip + venv |
|--------|----|-----------|
| Install speed | 10-100x faster | Baseline |
| Env creation | ~200x faster | Baseline |
| JupyterLab cold install | 2.6s | 21.4s |

**Feature Comparison:**

| Feature | uv | pip + venv |
|---------|----|-----------|
| PEP 405 compliant | Yes | Yes |
| Single binary | Yes | No (requires Python) |
| Lockfile support | Yes (uv.lock) | No (requirements.txt) |
| Global cache | Yes | No (per-venv copies) |
| Python version management | Yes | No (needs pyenv) |
| Drop-in replacement | Yes | N/A |

**uv Key Advantages:**
1. Single static binary, no Python dependency
2. Global package cache (saves disk space)
3. Built-in Python version management
4. Deterministic lockfiles
5. Fully compatible with pip ecosystem

**uv Limitations:**
1. Young project (less battle-tested than pip)
2. Doesn't manage non-Python packages (unlike Conda)
3. Requires uv to be installed

**Sources:**
- [uv docs - environments](https://docs.astral.sh/uv/pip/environments/)
- [Real Python - uv vs pip](https://realpython.com/uv-vs-pip/)
- [DataCamp - Python UV](https://www.datacamp.com/tutorial/python-uv)
- [AppSignal - Switching from pip to uv](https://blog.appsignal.com/2025/09/24/switching-from-pip-to-uv-in-python-a-comprehensive-guide.html)

---

### Section 3: Claude Code Environment

**Sandboxing Architecture:**

Claude Code uses OS-level sandboxing:
- **Linux:** bubblewrap
- **macOS:** Seatbelt

Per [Claude Code Sandboxing Docs](https://code.claude.com/docs/en/sandboxing):
> "The sandboxed bash tool uses OS-level primitives to enforce both filesystem and network isolation."

**Skills Execution:**
Per [Claude Skills Documentation](https://www.siddharthbharath.com/claude-skills/):
> "Skills run in a sandboxed code execution environment for safety, meaning they operate within clearly defined boundaries."

**Key Findings for Plugin/Skill Development:**
1. Skills are folder structures with `SKILL.md` as entry point
2. Python scripts can be included and executed via sandboxed code tool
3. The sandbox runtime is [open source](https://github.com/anthropic-experimental/sandbox-runtime)
4. No specific Python version constraints documented
5. Tools like `docker` and `watchman` are incompatible with sandbox

**Implications for Jerry:**
- Jerry skills/plugins should assume sandboxed execution
- Avoid dependencies on incompatible tools
- Standard Python features are available
- File system access is restricted to project scope

**Sources:**
- [Claude Code Sandboxing](https://code.claude.com/docs/en/sandboxing)
- [Claude Code Execution Tool](https://platform.claude.com/docs/en/agents-and-tools/tool-use/code-execution-tool)
- [InfoQ - Claude Code Sandbox](https://www.infoq.com/news/2025/11/anthropic-claude-code-sandbox/)

---

### Section 4: macOS Python Versions

**Local Environment Snapshot (2026-01-12):**

| Source | Version | Path |
|--------|---------|------|
| System Python | 3.9.6 | `/usr/bin/python3` |
| Homebrew Python | 3.14.0 | `/opt/homebrew/bin/python3` |
| uv-managed | 3.14.0 | `~/.local/share/uv/python/` |
| macOS Version | 26.2 | Sequoia |

**macOS Python History:**
- macOS no longer ships Python 2 (removed in Catalina)
- System Python 3.9.6 is for Apple's internal tools
- Users should install Python via Homebrew, pyenv, or uv

**Compatibility Matrix:**

| macOS Version | System Python | Recommended |
|---------------|---------------|-------------|
| Sequoia (15+) | 3.9.6 | 3.11-3.14 |
| Sonoma (14) | 3.9.6 | 3.11-3.13 |
| Ventura (13) | 3.9.6 | 3.11-3.12 |

**Sources:**
- [Mac Install Guide - System Python](https://mac.install.guide/python/system-default)
- [Python.org macOS Downloads](https://www.python.org/downloads/macos/)
- [Data Engineer Blog - Set Python default](https://thedataengineerblog.com/how-to-install-and-set-the-latest-python-version-as-default-on-macos-sequoia-and-sonoma)

---

## Summary & Recommendations

### Key Findings

1. **uv is PEP 405 compliant** - Creates standard virtual environments
2. **uv is a drop-in replacement** - Works with pip commands and requirements.txt
3. **Dual support is feasible** - Both uv and pip can work on the same venv
4. **Claude Code sandboxing is Python-friendly** - Standard Python works, no version constraints
5. **macOS has system Python 3.9.6** - Users should use modern Python (3.11+)

### Recommendations for Jerry

1. **Keep uv as primary** - Performance benefits are significant
2. **Ensure pip fallback** - Include requirements.txt for environments without uv
3. **Target Python 3.11+** - Broad compatibility, stable features
4. **Document installation options** - uv (preferred) and pip (fallback)
5. **Test in CI with both** - Ensure pip compatibility

---

## Progress Log

| Time | Action | Result |
|------|--------|--------|
| 2026-01-12 | Created work item | Research starting |
| 2026-01-12 | Researched PEP standards | PEP 405, 517, 518, 660 documented |
| 2026-01-12 | Researched uv vs pip | Comprehensive comparison documented |
| 2026-01-12 | Researched Claude Code env | Sandboxing architecture understood |
| 2026-01-12 | Researched macOS Python | Versions documented, 3.11+ recommended |
| 2026-01-12 | Compiled recommendations | Ready for action plan |
