# ORCHESTRATION_PLAN.md

> **Document ID:** PROJ-004-ORCH-PLAN
> **Project:** PROJ-004
> **Workflow:** SPIKE-001 Context Measurement, Detection Thresholds & Resumption Protocols Research
> **Workflow ID:** `spike001-ctxres-20260219-001`
> **Status:** ACTIVE
> **Criticality:** C2 (Standard)
> **Version:** 2.0
> **Created:** 2026-02-19
> **Last Updated:** 2026-02-19

> **Disclaimer:** This document was generated by the orch-planner agent (v2.2.0). All paths use dynamic identifiers derived from workflow ID `spike001-ctxres-20260219-001`. Machine-readable state is in `ORCHESTRATION.yaml` (SSOT).

---

## Document Sections

| Section | Purpose |
|---------|---------|
| [Executive Summary](#1-executive-summary) | Workflow overview, identification, and current state |
| [Workflow Architecture](#2-workflow-architecture) | Pipeline diagram and pattern classification |
| [Phase Definitions](#3-phase-definitions) | All 7 research phases with agents and artifacts |
| [Quality Gates](#4-quality-gates) | C2 quality gate definitions and strategy requirements |
| [Agent Registry](#5-agent-registry) | Complete agent listing with inputs/outputs |
| [State Management](#6-state-management) | Files, paths, and checkpoint strategy |
| [Execution Constraints](#7-execution-constraints) | Hard and soft constraints |
| [Success Criteria](#8-success-criteria) | Phase and workflow exit criteria |
| [Risk Mitigations](#9-risk-mitigations) | Risk register |
| [Resumption Context](#10-resumption-context) | Current state and next actions |

---

## 1. Executive Summary

This orchestration plan governs **SPIKE-001**: a timeboxed (8-hour) research spike investigating how to reliably detect context exhaustion during multi-orchestration runs, determine optimal detection thresholds, and design a resumption protocol enabling Claude to self-orient from `ORCHESTRATION.yaml` + `WORKTRACKER.md` in a new session.

The spike directly addresses the core problem of **context rot** -- LLM performance degradation as context fills -- which is the foundational concern of PROJ-004 (Context Resilience). The 7-phase research pipeline progresses from inventory through analysis, evaluation, design, and synthesis, producing a findings document with actionable recommendations for FEAT-001 implementation.

**Current State:** Workflow initialized, Phase 1 ready for execution.

**Orchestration Pattern:** Sequential Pipeline (Pattern 2) with checkpoints.

### 1.1 Workflow Identification

| Field | Value | Source |
|-------|-------|--------|
| Workflow ID | `spike001-ctxres-20260219-001` | auto |
| ID Format | `{purpose}-{YYYYMMDD}-{NNN}` | semantic-date-seq |
| Base Path | `projects/PROJ-004-context-resilience/orchestration/spike001-ctxres-20260219-001/` | Dynamic |

**Artifact Output Locations:**
- Research Pipeline: `orchestration/spike001-ctxres-20260219-001/res/`
- Quality Gates: `orchestration/spike001-ctxres-20260219-001/res/quality-gates/`

### 1.2 Output Levels

| Level | Audience | Content |
|-------|----------|---------|
| **L0** | Stakeholders | SPIKE-001 Findings and Recommendation sections (populated in spike entity) |
| **L1** | Developers | Per-phase research artifacts with evidence, analysis, and scored deliverables |
| **L2** | Operators | ORCHESTRATION.yaml state, checkpoint logs, quality gate iteration history |

---

## 2. Workflow Architecture

### 2.1 Pipeline Diagram

```
SPIKE-001: Context Measurement, Detection Thresholds & Resumption Protocols
Workflow ID: spike001-ctxres-20260219-001
Pipeline: res (research) — Sequential, 7 phases, 2 quality gates
Criticality: C2 (Standard)

┌─────────────────────────────────────────┐
│ PHASE 1: Inventory Existing Mechanisms  │
│ ─────────────────────────────────────── │
│ • research-inventory                    │
│ Audit Claude Code APIs, hooks, AE-006  │
│ STATUS: PENDING                         │
└──────────────────┬──────────────────────┘
                   │
                   ▼ [Checkpoint CP-001]
┌─────────────────────────────────────────┐
│ PHASE 2: Analyze Real Orchestration Runs│
│ ─────────────────────────────────────── │
│ • run-analyzer                          │
│ Examine PROJ-001 for exhaustion data   │
│ STATUS: BLOCKED (Phase 1)               │
└──────────────────┬──────────────────────┘
                   │
                   ▼ [Checkpoint CP-002]
┌─────────────────────────────────────────┐
│ PHASE 3: Evaluate Detection Methods     │
│ ─────────────────────────────────────── │
│ • detection-evaluator                   │
│ Compare 4 detection approaches          │
│ STATUS: BLOCKED (Phase 2)               │
└──────────────────┬──────────────────────┘
                   │
    ╔══════════════╧══════════════════════╗
    ║     QUALITY GATE QG-1              ║
    ║  Detection Method Selection Gate   ║
    ║  Threshold: >= 0.92 (H-13)        ║
    ║  Strategies: S-014, S-007, S-002  ║
    ║  Max iterations: 3 (H-14)         ║
    ║  STATUS: PENDING                   ║
    ╚══════════════╤══════════════════════╝
                   │
                   ▼
┌─────────────────────────────────────────┐
│ PHASE 4: Assess Resumption Completeness │
│ ─────────────────────────────────────── │
│ • resumption-assessor                   │
│ Gap analysis on ORCHESTRATION.yaml      │
│ STATUS: BLOCKED (QG-1)                  │
└──────────────────┬──────────────────────┘
                   │
                   ▼ [Checkpoint CP-004]
┌─────────────────────────────────────────┐
│ PHASE 5: Design Resumption Prompt       │
│ ─────────────────────────────────────── │
│ • prompt-designer                       │
│ Draft structured prompt template        │
│ STATUS: BLOCKED (Phase 4)               │
└──────────────────┬──────────────────────┘
                   │
                   ▼ [Checkpoint CP-005]
┌─────────────────────────────────────────┐
│ PHASE 6: Propose Thresholds             │
│ ─────────────────────────────────────── │
│ • threshold-analyst                     │
│ Warning/critical threshold proposal     │
│ STATUS: BLOCKED (Phase 5)               │
└──────────────────┬──────────────────────┘
                   │
    ╔══════════════╧══════════════════════╗
    ║     QUALITY GATE QG-2              ║
    ║  Threshold Proposal Validation     ║
    ║  Threshold: >= 0.92 (H-13)        ║
    ║  Strategies: S-014, S-007, S-002  ║
    ║  Max iterations: 3 (H-14)         ║
    ║  STATUS: PENDING                   ║
    ╚══════════════╤══════════════════════╝
                   │
                   ▼
┌─────────────────────────────────────────┐
│ PHASE 7: Synthesize Findings            │
│ ─────────────────────────────────────── │
│ • spike-synthesizer                     │
│ Document findings, populate SPIKE-001   │
│ STATUS: BLOCKED (QG-2)                  │
└─────────────────────────────────────────┘
                   │
                   ▼
    ╔═════════════════════════════════════╗
    ║        WORKFLOW COMPLETE            ║
    ║   SPIKE-001 Findings Populated     ║
    ╚═════════════════════════════════════╝
```

### 2.2 Orchestration Pattern Classification

| Pattern | Applied | Description |
|---------|---------|-------------|
| Sequential | Yes | All 7 phases execute in strict order |
| Concurrent | No | Single pipeline, no parallel pipelines |
| Barrier Sync | No | No cross-pollination barriers (single pipeline) |
| Hierarchical | Yes | Orchestrator delegates to execution agents |

---

## 3. Phase Definitions

### 3.1 Research Pipeline Phases

| Phase | Name | Purpose | Agent | Gate After | Status |
|-------|------|---------|-------|------------|--------|
| 1 | Inventory Existing Mechanisms | Audit Claude Code session APIs, hooks, system-reminder for context fill indicators; review AE-006 | research-inventory | Checkpoint | PENDING |
| 2 | Analyze Real Orchestration Runs | Examine PROJ-001 runs for context exhaustion patterns, state loss, resumption handling | run-analyzer | Checkpoint | BLOCKED |
| 3 | Evaluate Detection Methods | Compare 4 detection approaches; score by reliability, overhead, complexity | detection-evaluator | QG-1 | BLOCKED |
| 4 | Assess Resumption Completeness | Review existing ORCHESTRATION.yaml resumption sections; identify gaps | resumption-assessor | Checkpoint | BLOCKED |
| 5 | Design Resumption Prompt | Draft structured prompt template reading ORCHESTRATION.yaml + WORKTRACKER.md | prompt-designer | Checkpoint | BLOCKED |
| 6 | Propose Thresholds | Based on real data, propose warning and critical thresholds | threshold-analyst | QG-2 | BLOCKED |
| 7 | Synthesize Findings | Document findings, recommendation, and follow-up work items; populate SPIKE-001 | spike-synthesizer | -- | BLOCKED |

### 3.2 Phase Details

#### Phase 1: Inventory Existing Mechanisms

**Agent:** `research-inventory` (ps-researcher type)

**Objective:** Produce a comprehensive inventory of all existing mechanisms Claude Code provides for context awareness.

**Inputs:**
- Claude Code session APIs documentation
- Hook system documentation (`$TRANSCRIPT_PATH`, prompt hooks)
- System-reminder message format
- AE-006 rule from `quality-enforcement.md`
- Context7 research findings (token counting API, context_management.edits, usage objects)

**Outputs:**
- `orchestration/spike001-ctxres-20260219-001/res/phase-1-inventory/research-inventory/mechanism-inventory.md`

**Key Questions:**
1. What APIs expose token counts? (`POST /v1/messages/count_tokens`, usage objects)
2. What hook access exists? (`$TRANSCRIPT_PATH`, prompt hooks reviewing transcript)
3. What system-level signals exist for context compaction?
4. How does AE-006 currently handle token exhaustion?
5. What does `context_management.edits` provide?

#### Phase 2: Analyze Real Orchestration Runs

**Agent:** `run-analyzer`

**Objective:** Extract empirical data from real orchestration workflows to understand context exhaustion patterns.

**Inputs:**
- `projects/PROJ-001-oss-release/ORCHESTRATION.yaml` (completed, 4 phases, 4 quality gates)
- PROJ-001 orchestration artifacts and gate results
- Session transcripts (if available)

**Outputs:**
- `orchestration/spike001-ctxres-20260219-001/res/phase-2-analysis/run-analyzer/run-analysis.md`

**Key Questions:**
1. At what point in PROJ-001 did context pressure become visible?
2. What state was lost when sessions were cleared?
3. How was resumption handled? What manual intervention was needed?
4. How many quality gate iterations contributed to context fill?

#### Phase 3: Evaluate Detection Methods

**Agent:** `detection-evaluator`

**Objective:** Compare four detection approaches and recommend the most viable option(s).

**Inputs:**
- Phase 1 mechanism inventory
- Phase 2 empirical analysis
- Context7 API findings

**Outputs:**
- `orchestration/spike001-ctxres-20260219-001/res/phase-3-detection/detection-evaluator/detection-evaluation.md`

**Detection Methods to Evaluate:**

| Method | ID | Description |
|--------|----|-------------|
| Token counting heuristics | DM-A | Estimate token usage via tiktoken or API `count_tokens` endpoint |
| Context compaction detection | DM-B | Detect Claude Code automatic compression events via usage object `compaction` entries |
| Hook-based monitoring | DM-C | Use prompt hooks with `$TRANSCRIPT_PATH` to analyze transcript size/content |
| Quality degradation signals | DM-D | Monitor response quality metrics as context fills |

**Scoring Dimensions:**

| Dimension | Weight | Description |
|-----------|--------|-------------|
| Reliability | 0.35 | Accuracy and consistency of detection |
| Overhead | 0.25 | Token/compute cost of the detection mechanism |
| Implementation Complexity | 0.25 | Effort to integrate with Jerry framework |
| Fail-Safe Behavior | 0.15 | What happens if detection fails |

**Quality Gate QG-1 follows this phase** — detection method selection is a key decision point.

#### Phase 4: Assess Resumption Completeness

**Agent:** `resumption-assessor`

**Objective:** Determine whether current ORCHESTRATION.yaml + WORKTRACKER.md contain sufficient state for automated resumption.

**Inputs:**
- Phase 2 run analysis (what was lost, what was needed)
- PROJ-001 `ORCHESTRATION.yaml` resumption section (real example)
- ORCHESTRATION.yaml template schema

**Outputs:**
- `orchestration/spike001-ctxres-20260219-001/res/phase-4-resumption/resumption-assessor/resumption-assessment.md`

**Key Questions:**
1. Is the `resumption` section complete for self-orientation?
2. What ephemeral state is NOT captured in persistent files?
3. What does an operator currently supply manually that could be automated?
4. Are agent-level execution contexts recoverable?

#### Phase 5: Design Resumption Prompt

**Agent:** `prompt-designer`

**Objective:** Draft a structured resumption prompt template.

**Inputs:**
- Phase 4 gap analysis
- ORCHESTRATION.yaml schema
- WORKTRACKER.md format
- Real workflow snapshots from PROJ-001

**Outputs:**
- `orchestration/spike001-ctxres-20260219-001/res/phase-5-prompt/prompt-designer/resumption-prompt-template.md`

**Template Requirements:**
1. Reads ORCHESTRATION.yaml and WORKTRACKER.md
2. Outputs a resumption plan with: current phase, completed phases, next actions, blockers
3. Handles partially-complete phases and failed quality gates
4. Validates against real workflow snapshots (mental test)

#### Phase 6: Propose Thresholds

**Agent:** `threshold-analyst`

**Objective:** Based on empirical data and mechanism capabilities, propose warning and critical thresholds.

**Inputs:**
- Phase 2 empirical data (when exhaustion occurred)
- Phase 3 detection method capabilities
- Phase 5 resumption prompt token cost (estimated)

**Outputs:**
- `orchestration/spike001-ctxres-20260219-001/res/phase-6-thresholds/threshold-analyst/threshold-proposal.md`

**Key Considerations:**
1. Warning threshold: enough headroom for graceful checkpoint
2. Critical threshold: last chance before forced termination
3. Token budget needed for checkpoint operations (ORCHESTRATION.yaml update, WORKTRACKER.md update)
4. Variation by orchestration pattern and criticality level

**Quality Gate QG-2 follows this phase** — threshold proposal needs validation before synthesis.

#### Phase 7: Synthesize Findings

**Agent:** `spike-synthesizer`

**Objective:** Consolidate all research into SPIKE-001 Findings and Recommendation sections.

**Inputs:**
- All phase artifacts (Phases 1-6)
- QG-1 and QG-2 gate results
- SPIKE-001 entity template

**Outputs:**
- `orchestration/spike001-ctxres-20260219-001/res/phase-7-synthesis/spike-synthesizer/spike-synthesis.md`
- Updated SPIKE-001 entity with Findings and Recommendation sections populated

**Deliverables:**
1. Summary findings (L0 stakeholder view)
2. Detailed findings per research step
3. Evidence/references section
4. Recommendation with decision and recommended actions
5. Follow-up work items table for FEAT-001 implementation

---

## 4. Quality Gates

### 4.1 Gate Configuration (C2 Standard)

| Setting | Value | Source |
|---------|-------|--------|
| Threshold | >= 0.92 weighted composite | H-13 |
| Max iterations | 3 per gate | H-14 |
| Required strategies | S-014 (LLM-as-Judge), S-007 (Constitutional AI Critique), S-002 (Devil's Advocate) | C2 level |
| Optional strategies | S-003 (Steelman), S-010 (Self-Refine) | C2 level |
| H-16 ordering | S-003 MUST precede S-002 if both applied | quality-enforcement.md |

### 4.2 Scoring Dimensions (S-014)

| Dimension | Weight | Description |
|-----------|--------|-------------|
| Completeness | 0.20 | All required elements present |
| Internal Consistency | 0.20 | No contradictions across sections |
| Methodological Rigor | 0.20 | Sound research methodology |
| Evidence Quality | 0.15 | Verifiable, traceable evidence |
| Actionability | 0.15 | Clear next steps derivable |
| Traceability | 0.10 | Provenance to source documents |

### 4.3 Gate Definitions

#### QG-1: Detection Method Selection Gate (after Phase 3)

**Rationale:** The detection method selection is the key architectural decision of this spike. Getting this wrong would invalidate Phases 4-7 work. A full C2 quality gate ensures the evaluation is rigorous and the recommendation is defensible.

**Deliverables Scored:**
- `orchestration/spike001-ctxres-20260219-001/res/phase-3-detection/detection-evaluator/detection-evaluation.md`

**Exit Criteria:**
- All 4 detection methods evaluated with evidence
- Scoring dimensions applied consistently
- Clear recommendation with justification
- Failure modes documented for each method

#### QG-2: Threshold Proposal Validation Gate (after Phase 6)

**Rationale:** Threshold values directly determine whether the detection mechanism provides sufficient lead time for graceful checkpoint. Incorrect thresholds could cause premature or late triggering — both high-impact failure modes for orchestration resilience.

**Deliverables Scored:**
- `orchestration/spike001-ctxres-20260219-001/res/phase-6-thresholds/threshold-analyst/threshold-proposal.md`

**Exit Criteria:**
- Thresholds grounded in empirical data from Phase 2
- Token budget analysis for checkpoint operations
- Variation analysis by orchestration pattern/criticality
- Clear warning and critical threshold values with rationale

### 4.4 Lightweight Checkpoints (non-gate phases)

Between non-gated phases, a lightweight checkpoint is taken:
- ORCHESTRATION.yaml updated with phase status
- Phase artifact exists and is non-empty
- No blocking errors
- No full S-014 scoring or adversarial strategy application

---

## 5. Agent Registry

| Agent ID | Phase | Role | Input Artifacts | Output Artifact | Status |
|----------|-------|------|-----------------|-----------------|--------|
| research-inventory | 1 | Mechanism Auditor | Claude Code docs, AE-006, Context7 findings | `res/phase-1-inventory/research-inventory/mechanism-inventory.md` | PENDING |
| run-analyzer | 2 | Empirical Analyst | PROJ-001 ORCHESTRATION.yaml, workflow artifacts | `res/phase-2-analysis/run-analyzer/run-analysis.md` | PENDING |
| detection-evaluator | 3 | Detection Method Evaluator | Phase 1+2 outputs, Context7 API findings | `res/phase-3-detection/detection-evaluator/detection-evaluation.md` | PENDING |
| resumption-assessor | 4 | Resumption Gap Analyst | Phase 2 output, PROJ-001 resumption section, YAML schema | `res/phase-4-resumption/resumption-assessor/resumption-assessment.md` | PENDING |
| prompt-designer | 5 | Resumption Prompt Architect | Phase 4 output, YAML schema, WORKTRACKER format | `res/phase-5-prompt/prompt-designer/resumption-prompt-template.md` | PENDING |
| threshold-analyst | 6 | Threshold Researcher | Phase 2+3+5 outputs | `res/phase-6-thresholds/threshold-analyst/threshold-proposal.md` | PENDING |
| spike-synthesizer | 7 | Research Synthesizer | All phase outputs, QG-1+QG-2 results | `res/phase-7-synthesis/spike-synthesizer/spike-synthesis.md` | PENDING |

**Note:** All artifact paths are relative to `projects/PROJ-004-context-resilience/orchestration/spike001-ctxres-20260219-001/`.

---

## 6. State Management

### 6.1 State Files

| File | Purpose | Location |
|------|---------|----------|
| `ORCHESTRATION.yaml` | Machine-readable state (SSOT) | `projects/PROJ-004-context-resilience/ORCHESTRATION.yaml` |
| `ORCHESTRATION_PLAN.md` | This file — strategic context | `projects/PROJ-004-context-resilience/ORCHESTRATION_PLAN.md` |
| `WORKTRACKER.md` | Tactical work item tracking | `projects/PROJ-004-context-resilience/WORKTRACKER.md` |

### 6.2 Artifact Path Structure (WI-SAO-021)

All artifacts are stored under the workflow's base path using dynamic identifiers. No hardcoded pipeline names.

```
projects/PROJ-004-context-resilience/orchestration/spike001-ctxres-20260219-001/
└── res/                                          # Pipeline alias: "res" (research)
    ├── phase-1-inventory/
    │   └── research-inventory/
    │       └── mechanism-inventory.md
    ├── phase-2-analysis/
    │   └── run-analyzer/
    │       └── run-analysis.md
    ├── phase-3-detection/
    │   └── detection-evaluator/
    │       └── detection-evaluation.md
    ├── phase-4-resumption/
    │   └── resumption-assessor/
    │       └── resumption-assessment.md
    ├── phase-5-prompt/
    │   └── prompt-designer/
    │       └── resumption-prompt-template.md
    ├── phase-6-thresholds/
    │   └── threshold-analyst/
    │       └── threshold-proposal.md
    ├── phase-7-synthesis/
    │   └── spike-synthesizer/
    │       └── spike-synthesis.md
    └── quality-gates/
        ├── qg-1/
        │   └── gate-result.md
        └── qg-2/
            └── gate-result.md
```

### 6.3 Checkpoint Strategy

| Trigger | When | Purpose |
|---------|------|---------|
| PHASE_COMPLETE | After each phase | Phase-level rollback point |
| GATE_PASS | After QG-1, QG-2 | Quality-validated recovery point |
| MANUAL | User-triggered | Debug and inspection |

---

## 7. Execution Constraints

### 7.1 Hard Constraints (Jerry Constitution)

| Constraint | ID | Enforcement |
|------------|----|----|
| Single agent nesting | P-003 | Orchestrator -> Worker only. No recursive subagents. |
| File persistence | P-002 | All state to filesystem |
| No deception | P-022 | Transparent reasoning |
| User authority | P-020 | User approves when max iterations hit |
| Quality threshold | H-13 | >= 0.92 for C2+ deliverables |
| Creator-critic cycle | H-14 | Minimum 3 iterations max per gate |
| Self-review first | H-15 | S-010 before presenting |
| Steelman before critique | H-16 | S-003 before S-002 |

### 7.1.1 Worktracker Entity Templates

> **WTI-007:** Entity files (EPIC, FEATURE, ENABLER, TASK, etc.) created during orchestration MUST use canonical templates from `.context/templates/worktracker/`. Read the appropriate template first, then populate. Do not create entity files from memory or by copying other instance files.

### 7.2 Soft Constraints

| Constraint | Value | Rationale |
|------------|-------|-----------|
| Max concurrent agents | 1 | Sequential pipeline, no parallel execution |
| Max gate retries | 3 | H-14 circuit breaker |
| Checkpoint frequency | PHASE | After every phase completion |
| Timebox | 8 hours | Spike boundary per SPIKE-001 spec |

---

## 8. Success Criteria

### 8.1 Per-Phase Exit Criteria

| Phase | Exit Criteria |
|-------|---------------|
| 1 | Mechanism inventory covers APIs, hooks, system messages, AE-006. At least 3 mechanisms documented with capabilities and limitations. |
| 2 | At least 1 real orchestration run analyzed. Specific context exhaustion events identified with timestamps/phases. Resumption gaps documented. |
| 3 | All 4 detection methods evaluated. Scoring matrix completed. Recommendation with justification. QG-1 PASS (>= 0.92). |
| 4 | Gap analysis complete. Enumeration of missing state elements. Comparison of current vs required resumption data. |
| 5 | Resumption prompt template drafted. Tested mentally against PROJ-001 workflow snapshot. Handles partial and failed states. |
| 6 | Warning and critical thresholds proposed with rationale. Token budget analysis included. QG-2 PASS (>= 0.92). |
| 7 | SPIKE-001 Findings and Recommendation sections populated. Follow-up work items defined. Synthesis artifact complete. |

### 8.2 Workflow Completion Criteria

| Criterion | Validation |
|-----------|------------|
| All 7 phases complete | All phase status = COMPLETE in ORCHESTRATION.yaml |
| QG-1 PASS | Score >= 0.92 |
| QG-2 PASS | Score >= 0.92 |
| SPIKE-001 populated | Findings and Recommendation sections non-empty |
| Follow-up items defined | At least 1 follow-up work item for FEAT-001 |
| Within timebox | Total effort <= 8 hours |

---

## 9. Risk Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Context measurement APIs do not exist or are unreliable | Medium | High | Phase 1 inventories multiple approaches; Phase 3 evaluates alternatives. Fallback to heuristic methods. |
| Threshold values vary significantly by pattern/criticality | Medium | Medium | Phase 6 proposes ranges not fixed values; recommends configurable thresholds. |
| ORCHESTRATION.yaml resumption section is insufficient | Medium | High | Phase 4 explicitly identifies gaps; Phase 5 designs prompt that compensates for missing data. |
| Quality gate enforcement across session boundaries untested | Low | Medium | Phase 5 prompt template includes quality gate state reconstruction. |
| Timebox exceeded before synthesis | Low | High | Phases are independent research artifacts; partial findings still valuable. Phase 7 synthesizes whatever is available. |
| Context exhaustion during this spike execution | Low | Medium | Lightweight checkpoints between phases; ORCHESTRATION.yaml fully portable for cross-session resumption. |

---

## 10. Resumption Context

### 10.1 Current Execution State

```
WORKFLOW STATUS AS OF 2026-02-19
============================

Research Pipeline (res):
  Phase 1 (Inventory):    PENDING
  Phase 2 (Analysis):     BLOCKED (Phase 1)
  Phase 3 (Detection):    BLOCKED (Phase 2)
  -- QG-1 --              PENDING
  Phase 4 (Resumption):   BLOCKED (QG-1)
  Phase 5 (Prompt):       BLOCKED (Phase 4)
  Phase 6 (Thresholds):   BLOCKED (Phase 5)
  -- QG-2 --              PENDING
  Phase 7 (Synthesis):    BLOCKED (QG-2)

Quality Gates:
  QG-1 (after Phase 3):   PENDING
  QG-2 (after Phase 6):   PENDING

Checkpoints:
  None yet.
```

### 10.2 Next Actions

1. Execute Phase 1 agent `research-inventory` — audit Claude Code session APIs, hooks, system-reminder messages, AE-006 handling.
2. Use Context7 research findings as input (token counting API, context_management.edits, usage objects, hooks with $TRANSCRIPT_PATH).
3. Persist mechanism inventory artifact and update ORCHESTRATION.yaml.

### 10.3 Context7 Research Inputs (Pre-loaded)

The following technical findings from Context7 documentation research are available as inputs for Phase 1:

1. **Anthropic API `POST /v1/messages/count_tokens`** -- Token counting before sending, supports context_management edits preview
2. **`context_management.edits`** -- API supports trigger-based context clearing (e.g., clear_tool_uses when input_tokens exceeds threshold)
3. **Usage objects** -- Report `input_tokens`, `output_tokens`, with `iterations` breakdown including separate `compaction` entries
4. **Claude Code hooks** -- Can access `$TRANSCRIPT_PATH` for full session transcript analysis
5. **Prompt hooks** -- Can review full transcript and make context-aware decisions

---

*Document ID: PROJ-004-ORCH-PLAN*
*Workflow ID: spike001-ctxres-20260219-001*
*Version: 2.0*
*Criticality: C2 (Standard)*
*Cross-Session Portable: All paths are repository-relative*
*Generated by: orch-planner agent v2.2.0*
