# ORCHESTRATION.yaml
# Machine-readable orchestration state for SPIKE-002 CLI Integration Research
# Document ID: PROJ-004-SPIKE002-ORCH-STATE
# Version: 1.1
# Last Updated: 2026-02-19
# Generated by: main context (orchestrator)

schema_version: "2.0.0"

# =============================================================================
# WORKFLOW METADATA
# =============================================================================
workflow:
  id: "spike002-cli-integration-20260219-001"
  name: "SPIKE-002 Jerry CLI Integration Architecture for Context Resilience"
  project_id: "PROJ-004"
  version: "1.1"
  created_at: "2026-02-19T00:00:00Z"
  updated_at: "2026-02-19T00:00:00Z"
  status: "COMPLETE"

  id_source: "auto"
  id_format: "semantic-date-seq"

  spike_entity: "projects/PROJ-004-context-resilience/work/EPIC-001-context-resilience/FEAT-001-context-detection/SPIKE-002-cli-integration.md"
  predecessor: "spike001-ctxres-20260219-001"
  predecessor_gap: "SPIKE-001 focused entirely on hook scripts; did not audit or factor in Jerry CLI infrastructure (TokenCounter, session lifecycle, config system, enforcement engines)"

  criticality: "C2"
  criticality_rationale: "Supplementary research spike. 5-8 artifact files. Reversible within 1 day. No code changes."

  timebox_hours: 4

  patterns:
    - SEQUENTIAL

  constraints:
    max_agent_nesting: 1
    file_persistence: true

# =============================================================================
# PIPELINE CONFIGURATION
# =============================================================================
pipelines:
  research:
    short_alias: "res"
    skill_source: "problem-solving"
    current_phase: 4

    phases:
      - id: 1
        name: "CLI Capability Audit"
        status: "COMPLETE"
        agents:
          - id: "cli-auditor"
            role: "ps-researcher"
            status: "COMPLETE"
            artifact: "orchestration/spike002-cli-integration-20260219-001/res/phase-1-audit/cli-auditor/cli-capability-audit.md"

      - id: 2
        name: "Gap Analysis"
        status: "COMPLETE"
        agents:
          - id: "gap-analyst"
            role: "ps-analyst"
            status: "COMPLETE"
            artifact: "orchestration/spike002-cli-integration-20260219-001/res/phase-2-gap-analysis/gap-analyst/gap-analysis.md"

      - id: 3
        name: "Revised Architecture"
        status: "COMPLETE"
        agents:
          - id: "architecture-designer"
            role: "ps-architect"
            status: "COMPLETE"
            artifact: "orchestration/spike002-cli-integration-20260219-001/res/phase-3-architecture/architecture-designer/adr-cli-integration.md"

      - id: 4
        name: "Synthesis & Revised Work Items"
        status: "COMPLETE"
        agents:
          - id: "work-item-synthesizer"
            role: "ps-synthesizer"
            status: "COMPLETE"
            artifact: "orchestration/spike002-cli-integration-20260219-001/res/phase-4-synthesis/work-item-synthesizer/revised-work-items.md"

# =============================================================================
# QUALITY GATES
# =============================================================================
quality_gates:
  qg-1:
    name: "Architecture Review"
    after_phase: 3
    before_phase: 4
    status: "PASS"
    threshold: 0.92
    strategies: ["S-003", "S-007", "S-002", "S-014"]
    iteration_count: 1
    iteration_history:
      - iteration: 1
        score: 0.94
        verdict: "PASS"
        defects: 1_P2_4_P3
        note: "P2: Missing rollback strategy. User feedback: InMemorySessionRepository should not be treated as hard constraint â€” FileSystemSessionRepository should be created using existing EventSourcedWorkItemRepository + FileSystemEventStore pattern."

# =============================================================================
# EXECUTION QUEUE
# =============================================================================
execution_queue:
  current_group: 5
  groups:
    - id: 1
      execution_mode: "SEQUENTIAL"
      agents: ["cli-auditor"]
    - id: 2
      execution_mode: "SEQUENTIAL"
      agents: ["gap-analyst"]
    - id: 3
      execution_mode: "SEQUENTIAL"
      agents: ["architecture-designer"]
    - id: 4
      execution_mode: "SEQUENTIAL"
      agents: ["qg-1-scorer"]
    - id: 5
      execution_mode: "SEQUENTIAL"
      agents: ["work-item-synthesizer"]

# =============================================================================
# CHECKPOINTS
# =============================================================================
checkpoints:
  latest_id: "cp-001"
  entries:
    - id: "cp-001"
      timestamp: "2026-02-19T00:00:00Z"
      trigger: "PHASE_COMPLETE"
      recovery_point: "Phase 2 start"

# =============================================================================
# METRICS
# =============================================================================
metrics:
  phases_complete: 4
  phases_total: 4
  agents_executed: 4
  agents_total: 4
  quality_gates_passed: 1
  quality_gates_total: 1
  progress_percent: 100

# =============================================================================
# RESUMPTION
# =============================================================================
resumption:
  last_completed_phase: 4
  next_action: "WORKFLOW COMPLETE. All phases and quality gates passed. Proceed to FEAT-001 implementation using revised work items CWI-00 through CWI-09."
  files_to_read:
    - "projects/PROJ-004-context-resilience/orchestration/spike002-cli-integration-20260219-001/res/phase-4-synthesis/work-item-synthesizer/revised-work-items.md"
    - "projects/PROJ-004-context-resilience/work/EPIC-001-context-resilience/FEAT-001-context-detection/SPIKE-002-cli-integration.md"
  context_summary: "All 4 phases + QG-1 complete. ADR scored 0.94 PASS. 10 revised CWIs (CWI-00 through CWI-09) produced, superseding SPIKE-001's 14 items. CWI-00 (FileSystemSessionRepository) added per user feedback as P0 Foundation enabler. Estimated effort: 19.5-28.5 hours (22-23% reduction from SPIKE-001). All 6 hypotheses validated (4 CONFIRMED, 2 PARTIALLY CONFIRMED)."
