# EN-004: Automated Tests for session_start.py

> **Enabler ID:** EN-004
> **Name:** Automated tests for session_start.py
> **Type:** Enabler (Technical)
> **Status:** PENDING
> **Parent:** [FT-003](./FEATURE-WORKTRACKER.md)
> **Created:** 2026-01-13
> **Last Updated:** 2026-01-13

---

## Overview

Create comprehensive unit tests for `src/interface/cli/session_start.py` to ensure all output scenarios are covered and the script executes standalone without pip dependencies.

### Problem Addressed

- **TD-001:** No automated tests for plugin hooks
- **Origin:** BUG-007 post-mortem - script failed silently due to untested dependency

### Success Criteria

- [ ] Tests cover `<project-context>` output (valid project)
- [ ] Tests cover `<project-required>` output (no project set)
- [ ] Tests cover `<project-error>` output (invalid project)
- [ ] Tests verify exit code is always 0
- [ ] Tests run without `pip install -e .`
- [ ] Tests validate PEP 723 inline metadata presence
- [ ] Coverage >= 100% for session_start.py

---

## Tasks

| # | Task | Status | Evidence |
|---|------|--------|----------|
| 1 | Create test file `tests/unit/interface/test_session_start.py` | PENDING | |
| 2 | Implement test for `<project-context>` scenario | PENDING | |
| 3 | Implement test for `<project-required>` scenario | PENDING | |
| 4 | Implement test for `<project-error>` scenario | PENDING | |
| 5 | Implement test for exit code validation | PENDING | |
| 6 | Implement test for standalone execution (no pip) | PENDING | |
| 7 | Implement test for PEP 723 metadata presence | PENDING | |
| 8 | Verify coverage meets target | PENDING | |
| 9 | Document test patterns in ADR | PENDING | |

---

## Technical Approach

### Test Structure

```python
# tests/unit/interface/test_session_start.py

class TestSessionStartOutput:
    """Test session_start.py output scenarios."""

    def test_project_context_when_valid_project(self):
        """Valid JERRY_PROJECT produces <project-context> tag."""

    def test_project_required_when_no_project(self):
        """Missing JERRY_PROJECT produces <project-required> tag."""

    def test_project_error_when_invalid_project(self):
        """Invalid JERRY_PROJECT produces <project-error> tag."""


class TestSessionStartExecution:
    """Test session_start.py execution characteristics."""

    def test_exit_code_always_zero(self):
        """Script always exits with code 0."""

    def test_standalone_execution_without_pip(self):
        """Script runs without pip install."""


class TestSessionStartMetadata:
    """Test PEP 723 inline metadata."""

    def test_pep723_metadata_present(self):
        """Script contains valid PEP 723 inline metadata."""
```

### Execution Method

Tests will use `subprocess.run()` to execute the script in isolation, mimicking how Claude Code invokes hooks.

---

## Acceptance Criteria

1. All 9 tasks completed with evidence
2. Tests pass in CI without `pip install -e .`
3. Coverage report shows 100% for session_start.py
4. Test patterns documented for future hooks

---

## Related Artifacts

| Type | Location | Description |
|------|----------|-------------|
| Script Under Test | `src/interface/cli/session_start.py` | Target script |
| BUG-007 | [../SE-001/FT-002/bug-007.md](../../SE-001/FT-002/bug-007.md) | Root cause |

---

## Change Log

| Date | Change | Author |
|------|--------|--------|
| 2026-01-13 | Created EN-004 for session_start.py testing | Claude |
