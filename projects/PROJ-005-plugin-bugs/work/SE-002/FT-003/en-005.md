# EN-005: Pre-commit/CI Hooks for Plugin Validation

> **Enabler ID:** EN-005
> **Name:** Pre-commit/CI hooks for plugin validation
> **Type:** Enabler (Technical)
> **Status:** PENDING
> **Parent:** [FT-003](./FEATURE-WORKTRACKER.md)
> **Created:** 2026-01-13
> **Last Updated:** 2026-01-13

---

## Overview

Implement pre-commit hooks and CI pipeline checks to validate plugin artifacts (manifests, hooks, scripts) before merge, preventing regressions like BUG-007.

### Problem Addressed

- **TD-002:** No CI validation of standalone script execution
- **Origin:** BUG-007 - broken hook shipped because no CI validation existed

### Success Criteria

- [ ] Schemas are downloaded, versioned and captured in repo
- [ ] Pre-commit hook validates `plugin.json` schema
- [ ] Pre-commit hook validates `marketplace.json` schema
- [ ] Pre-commit hook validates `hooks/hooks.json`
- [ ] CI job executes all hook scripts standalone
- [ ] CI fails if any hook script returns non-zero
- [ ] CI fails if hook script has import errors
- [ ] Documentation for hook configuration

---

## Tasks

| # | Task | Status | Evidence |
|---|------|--------|----------|
| 1 | Research pre-commit hook patterns for JSON validation | PENDING | |
| 2 | Create `.pre-commit-config.yaml` entry for plugin validation | PENDING | |
| 3 | Implement `scripts/validate_plugin_manifests.py` | PENDING | |
| 4 | Create CI workflow `plugin-integration.yml` | PENDING | |
| 5 | Add job to execute session_start.py standalone | PENDING | |
| 6 | Add job to execute other hook scripts standalone | PENDING | |
| 7 | Configure CI to fail on non-zero exit or import errors | PENDING | |
| 8 | Test pre-commit hook locally | PENDING | |
| 9 | Document hook configuration in README | PENDING | |

---

## Technical Approach

### Pre-commit Configuration

```yaml
# .pre-commit-config.yaml (addition)
repos:
  - repo: local
    hooks:
      - id: validate-plugin-manifests
        name: Validate plugin manifests
        entry: python scripts/validate_plugin_manifests.py
        language: python
        files: (plugin\.json|marketplace\.json|hooks\.json)$
        pass_filenames: false
```

### CI Workflow

```yaml
# .github/workflows/plugin-integration.yml
name: Plugin Integration
on: [push, pull_request]

jobs:
  validate-hooks:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v4

      - name: Validate session_start.py standalone
        run: |
          cd .claude-plugin
          uv run src/interface/cli/session_start.py

      - name: Validate other hooks
        run: |
          for script in hooks/*.py; do
            python "$script" --help || true
          done
```

### Validation Script

```python
# scripts/validate_plugin_manifests.py
"""Validate plugin manifest files against expected schema."""

def validate_plugin_json() -> bool: ...
def validate_marketplace_json() -> bool: ...
def validate_hooks_json() -> bool: ...
```

---

## Acceptance Criteria

1. All 9 tasks completed with evidence
2. Pre-commit hook catches manifest errors locally
3. CI workflow runs on all PRs
4. CI fails if hook scripts have import errors
5. Documentation updated

---

## Related Artifacts

| Type | Location | Description |
|------|----------|-------------|
| Plugin Manifest | `.claude-plugin/plugin.json` | Target validation |
| Marketplace Manifest | `.claude-plugin/marketplace.json` | Target validation |
| Hooks Config | `.claude-plugin/hooks/hooks.json` | Target validation |

---

## Change Log

| Date | Change | Author |
|------|--------|--------|
| 2026-01-13 | Created EN-005 for pre-commit/CI hooks | Claude |
