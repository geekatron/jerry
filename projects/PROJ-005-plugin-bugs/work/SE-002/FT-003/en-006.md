# EN-006: Integration Test Suite for CLI Commands

> **Enabler ID:** EN-006
> **Name:** Integration test suite for CLI commands
> **Type:** Enabler (Technical)
> **Status:** PENDING
> **Parent:** [FT-003](./FEATURE-WORKTRACKER.md)
> **Created:** 2026-01-13
> **Last Updated:** 2026-01-13

---

## Overview

Create integration tests that verify Jerry CLI commands work correctly in plugin mode (without `pip install -e .`), ensuring the CLI integration remains functional.

### Problem Addressed

- **TD-001:** No automated tests for plugin functionality
- **Origin:** BUG-007 - CLI functionality was untested in plugin context

### Success Criteria

- [ ] Integration tests for `jerry session` commands
- [ ] Integration tests for `jerry items` commands
- [ ] Integration tests for `jerry projects` commands
- [ ] Tests execute via `uv run` (plugin mode)
- [ ] Tests validate JSON output format
- [ ] Tests validate exit codes
- [ ] Coverage >= 80% for CLI adapter

---

## Tasks

| # | Task | Status | Evidence |
|---|------|--------|----------|
| 1 | Create test directory `tests/integration/cli/` | PENDING | |
| 2 | Implement tests for `jerry session start/end/status` | PENDING | |
| 3 | Implement tests for `jerry items list/show` | PENDING | |
| 4 | Implement tests for `jerry projects context/list/validate` | PENDING | |
| 5 | Implement tests for `--json` output format | PENDING | |
| 6 | Implement tests for exit code validation | PENDING | |
| 7 | Configure pytest to run integration tests via uv | PENDING | |
| 8 | Add integration test job to CI | PENDING | |
| 9 | Document integration test patterns | PENDING | |

---

## Technical Approach

### Test Structure

```python
# tests/integration/cli/test_jerry_cli.py

class TestSessionCommands:
    """Integration tests for jerry session commands."""

    def test_session_start_creates_session(self):
        """jerry session start creates a new session."""

    def test_session_status_shows_current(self):
        """jerry session status shows current session."""


class TestProjectsCommands:
    """Integration tests for jerry projects commands."""

    def test_projects_context_shows_active(self):
        """jerry projects context shows active project."""

    def test_projects_list_returns_json(self):
        """jerry projects list --json returns valid JSON."""


class TestItemsCommands:
    """Integration tests for jerry items commands."""

    def test_items_list_shows_work_items(self):
        """jerry items list shows work items."""
```

### Execution via uv

```python
def run_jerry_command(args: list[str]) -> subprocess.CompletedProcess:
    """Execute jerry CLI via uv run."""
    return subprocess.run(
        ["uv", "run", "jerry"] + args,
        capture_output=True,
        text=True,
        cwd=PLUGIN_ROOT,
    )
```

---

## Acceptance Criteria

1. All 9 tasks completed with evidence
2. Integration tests pass via `uv run`
3. Tests run in CI without `pip install -e .`
4. Coverage meets 80% target for CLI adapter
5. Test patterns documented

---

## Related Artifacts

| Type | Location | Description |
|------|----------|-------------|
| CLI Adapter | `src/interface/cli/` | Target under test |
| CLI Entry Point | `src/interface/cli/main.py` | Jerry CLI main |

---

## Change Log

| Date | Change | Author |
|------|--------|--------|
| 2026-01-13 | Created EN-006 for CLI integration tests | Claude |
