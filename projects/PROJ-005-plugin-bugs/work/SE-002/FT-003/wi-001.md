# WI-001: Detection/Prevention/Mitigation Playbook

> **Work Item ID:** WI-001
> **Name:** Detection/prevention/mitigation playbook
> **Type:** Unit of Work
> **Status:** IN PROGRESS
> **Parent:** [FT-003](./FEATURE-WORKTRACKER.md)
> **Created:** 2026-01-13
> **Last Updated:** 2026-01-13

---

## Overview

Create a comprehensive operational playbook documenting how to detect, prevent, and mitigate plugin integration regressions. This playbook will serve as the go-to reference for future incidents.

### Problem Addressed

- **TD-003:** No documented regression prevention strategy
- **Origin:** BUG-007 - no documented process for handling similar issues

### Success Criteria

- [x] Playbook documents detection strategies (how to find issues)
- [x] Playbook documents prevention strategies (how to avoid issues)
- [x] Playbook documents mitigation strategies (how to fix issues fast)
- [x] Includes checklist for pre-release validation
- [x] Includes troubleshooting flowchart
- [x] Includes rollback procedures
- [ ] Reviewed and approved by team

---

## Tasks

| # | Task | Status | Evidence |
|---|------|--------|----------|
| 1 | Document BUG-007 as case study | DONE | RUNBOOK-001 "Case Study: BUG-007" section |
| 2 | Write detection strategies section | DONE | ELI5 symptoms, L1 diagnostics, L2 investigation |
| 3 | Write prevention strategies section | DONE | L3 prevention checklist, pre-release checklist |
| 4 | Write mitigation strategies section | DONE | L3 resolution patterns, incident response checklist |
| 5 | Create pre-release validation checklist | DONE | "Pre-Release Checklist" section |
| 6 | Create troubleshooting flowchart | DONE | ASCII flowchart in "Troubleshooting Flowchart" |
| 7 | Document rollback procedures | DONE | "Rollback Procedures" section |
| 8 | Review with team and incorporate feedback | PENDING | Awaiting review |
| 9 | Publish to `runbooks/` directory | DONE | `runbooks/RUNBOOK-001-plugin-regression-playbook.md` |

---

## Playbook Outline

### 1. Detection Strategies

**Symptoms to Watch For:**
- SessionStart hook produces no output
- Jerry Framework startup message missing
- Import errors in hook scripts
- `pip` or `uv` dependency errors

**Detection Methods:**
1. Manual testing after plugin update
2. CI integration tests (EN-005)
3. Pre-commit validation (EN-005)
4. User reports

### 2. Prevention Strategies

**Before Merge:**
- [ ] Run pre-commit hooks
- [ ] Verify CI passes
- [ ] Test hook scripts standalone
- [ ] Check PEP 723 metadata present

**Code Review Checklist:**
- [ ] No new pip dependencies in hook scripts
- [ ] All imports are stdlib or PEP 723 declared
- [ ] Exit code is always 0 for hooks
- [ ] Output format matches documented tags

### 3. Mitigation Strategies

**Immediate Response:**
1. Identify failing component
2. Check recent commits for breaking changes
3. Rollback if necessary

**Fix Patterns:**
- Missing dependency → Add to PEP 723 inline metadata
- Import error → Check PYTHONPATH in hook command
- Silent failure → Add error handling with stderr output

### 4. Rollback Procedures

```bash
# Revert to last known good commit
git revert <breaking-commit>

# Or checkout previous version
git checkout <last-good-tag> -- .claude-plugin/
```

---

## Deliverable Location

`runbooks/RUNBOOK-001-plugin-regression-playbook.md`

---

## Acceptance Criteria

1. All 9 tasks completed with evidence
2. Playbook covers all three strategies (detect/prevent/mitigate)
3. Includes actionable checklists
4. Reviewed and approved
5. Published to runbooks directory

---

## Related Artifacts

| Type | Location | Description |
|------|----------|-------------|
| BUG-007 | [../../SE-001/FT-002/bug-007.md](../../SE-001/FT-002/bug-007.md) | Case study |
| ADR e-010 | [../../../decisions/PROJ-005-e-010-adr-uv-session-start.md](../../../decisions/PROJ-005-e-010-adr-uv-session-start.md) | Decision context |

---

## Change Log

| Date | Change | Author |
|------|--------|--------|
| 2026-01-13 | Created WI-001 for playbook documentation | Claude |
| 2026-01-13 | Tasks 1-7, 9 DONE: RUNBOOK-001 created with ELI5/L1/L2/L3 tiers | Claude |
| 2026-01-13 | 6/7 success criteria met; awaiting team review (Task 8) | Claude |
