# EN-002:DEC-001: HARD Rule Budget Implementation Plan

> **Type:** decision
> **Status:** accepted
> **Priority:** high
> **Created:** 2026-02-21T23:45:00Z
> **Parent:** EN-002
> **Owner:** Claude (PROJ-007 orchestrator)
> **Related:** DISC-001, DISC-002, EN-001:TASK-016

---

## Document Sections

| Section | Purpose |
|---------|---------|
| [Summary](#summary) | Decisions captured |
| [Decision Context](#decision-context) | Background and constraints |
| [Decisions](#decisions) | Structured D-NNN entries |
| [Decision Summary](#decision-summary) | Quick reference |
| [Related Artifacts](#related-artifacts) | Traceability |

---

## Summary

Five decisions captured for the HARD rule budget enforcement improvement plan, based on the C4 adversary tournament derivation (0.95 PASS) and discovery findings (DISC-001, DISC-002).

**Decisions Captured:** 5

**Key Outcomes:**
- L2 engine expansion is the highest-priority action (triples L2 coverage)
- HARD rule ceiling changes from unprincipled 35 to derived 25 with two-tier model
- TASK-016 (H-32..H-35) is deferred until consolidation creates headroom
- L5 CI enforcement gate added to prevent future silent ceiling breaches
- Empirical measurement before further optimization

---

## Decision Context

### Background

The C4 adversary tournament on the HARD rule budget upper boundary derivation (2 iterations, scored 0.95 PASS) established that:
1. The current 35-slot ceiling has no principled derivation (DISC-001)
2. The L2 engine only reads `quality-enforcement.md`, leaving 21/31 rules without per-prompt L2 protection (DISC-002)
3. The principled upper boundary is 25 HARD rules with a two-tier enforcement model
4. The current 31 rules already exceed the derived ceiling by 6

### Constraints

- Must not break existing enforcement behavior during transition
- Must create headroom for PROJ-007's H-32..H-35 (4 new rules)
- Must maintain constitutional compliance (P-003, P-020, P-022)
- AE-002 applies: all tasks touch `.context/rules/` (auto-C3 minimum)

### Stakeholders

| Stakeholder | Role | Interest |
|-------------|------|----------|
| Framework users | Consumers | Rules must remain enforceable and not degrade quality |
| Governance authority | Approver | Ceiling change requires explicit authorization (P-020) |

---

## Decisions

### D-001: Expand L2 Engine to Read All Rule Files

**Date:** 2026-02-21
**Participants:** User, Claude (PROJ-007 orchestrator)

#### Question/Context

The L2 engine reads only `quality-enforcement.md` for L2-REINJECT markers. 8 additional markers exist in 8 other auto-loaded files. Should we expand the engine?

#### Options Considered

| Option | Description | Pros | Cons |
|--------|-------------|------|------|
| **A** | Expand engine to glob all auto-loaded rule files | Triples L2 coverage (10→27 H-rules), addresses binding constraint, low effort | L2 budget increases from 415→840 tokens (exceeds 600 declared budget) |
| **B** | Move all L2 markers into quality-enforcement.md | No engine change needed | Bloats a single file, violates separation of concerns, markers lose proximity to their rules |
| **C** | Leave as-is | No change risk | 21/31 rules remain vulnerable to context rot |

#### Decision

**We decided:** Option A — Expand the engine to read all auto-loaded rule files. Update the L2 budget from 600 to 850 tokens in the enforcement architecture documentation.

#### Rationale

This is the highest-value, lowest-effort fix. It addresses the binding constraint (Enforcement Coverage) identified in the C4 derivation. The 250-token budget increase is within the total enforcement budget headroom.

#### Implications

- **Positive:** 17 additional H-rules get per-prompt L2 protection
- **Negative:** L2 budget increases by ~40%; requires ADR-EPIC002-002 update
- **Follow-up required:** Audit all structural L2 markers for quality before enabling

---

### D-002: Consolidate H-25..H-30 and H-07..H-09

**Date:** 2026-02-21
**Participants:** User, Claude (PROJ-007 orchestrator)

#### Question/Context

Current HARD rule count is 31, exceeding the derived ceiling of 25 by 6. How do we reduce the count without losing enforcement?

#### Options Considered

| Option | Description | Pros | Cons |
|--------|-------------|------|------|
| **A** | Consolidate H-25..H-30 (6→2) and H-07..H-09 (3→1) | Saves 7 slots (31→24), creates headroom | Compound rules are harder to reference individually |
| **B** | Demote some H-rules to MEDIUM | Saves slots without consolidation | Loses HARD enforcement for demoted rules |
| **C** | Keep all 31 rules, raise ceiling to 31 | No consolidation effort | Ignores derivation findings, perpetuates enforcement degradation |

#### Decision

**We decided:** Option A — Consolidate H-25..H-30 into 2 compound rules (naming/structure + description/paths/registration) and H-07..H-09 into 1 compound rule (architecture layer isolation). This reduces count by 7 (31→24), creating 1 slot of headroom below the 25 ceiling.

#### Rationale

Consolidation preserves enforcement for ALL existing constraints while reducing the attention budget. These rules are enforced via L1/L2/L4 (not L3 AST gating), so compound rules are fully compatible with their enforcement mechanisms. Rules with L3 AST enforcement (H-05, H-06) are NOT consolidated.

---

### D-003: Defer TASK-016 Until Consolidation Is Complete

**Date:** 2026-02-21
**Participants:** User, Claude (PROJ-007 orchestrator)

#### Question/Context

EN-001:TASK-016 installs H-32..H-35 into quality-enforcement.md. Should we proceed with this before or after consolidation?

#### Options Considered

| Option | Description | Pros | Cons |
|--------|-------------|------|------|
| **A** | Defer TASK-016 until EN-002 consolidation is complete | Ensures H-32..H-35 are added within the principled ceiling | Delays EN-001 completion |
| **B** | Proceed with TASK-016 immediately, consolidate later | EN-001 completes sooner | Temporarily exceeds ceiling (31+4=35), perpetuates enforcement degradation |

#### Decision

**We decided:** Option A — Defer TASK-016 until EN-002 is complete. TASK-016 becomes blocked by EN-002.

#### Rationale

Adding 4 rules to an already-over-ceiling count (31) before consolidation would further degrade enforcement quality for ALL rules. The consolidation must create headroom first.

---

### D-004: Add L5 CI Enforcement Gate for Ceiling

**Date:** 2026-02-21
**Participants:** User, Claude (PROJ-007 orchestrator)

#### Question/Context

The ceiling was silently breached once before (25→30→35). How do we prevent future silent breaches?

#### Options Considered

| Option | Description | Pros | Cons |
|--------|-------------|------|------|
| **A** | Add L5 CI check that counts H-rules and fails if > ceiling | Deterministic, immune to context rot, prevents silent breaches | Requires CI pipeline addition |
| **B** | Rely on L2 re-injection awareness only | No CI change | Vulnerable to context rot — exactly the failure mode that caused the original breach |

#### Decision

**We decided:** Option A — Add an L5 CI enforcement gate that counts HARD rules in `quality-enforcement.md` and fails the build if the count exceeds the ceiling.

#### Rationale

The original ceiling breach happened because enforcement was L1-only (LLM awareness). Deterministic L5 enforcement is immune to context rot and prevents the failure mode that caused the original breach.

---

### D-005: Measure Enforcement Effectiveness Before Further Optimization

**Date:** 2026-02-21
**Participants:** User, Claude (PROJ-007 orchestrator)

#### Question/Context

After implementing the engine fix and consolidation, should we immediately pursue further optimization or measure first?

#### Options Considered

| Option | Description | Pros | Cons |
|--------|-------------|------|------|
| **A** | Measure first, optimize later | Data-driven decisions, avoids premature optimization | Delays potential improvements |
| **B** | Continue optimizing based on derivation analysis | Faster implementation of all recommendations | May optimize things that don't need optimizing |

#### Decision

**We decided:** Option A — After implementing the L2 engine expansion, consolidation, and ceiling update, measure enforcement effectiveness before pursuing further optimization (e.g., Tier A/B formal classification, additional L2 markers for H-04/H-16/H-17/H-18).

#### Rationale

The derivation analysis is theoretical. The engine expansion and consolidation are the highest-confidence improvements. Beyond those, empirical data should drive further investment.

---

## Decision Summary

| ID | Decision | Date | Status |
|----|----------|------|--------|
| D-001 | Expand L2 engine to read all auto-loaded rule files | 2026-02-21 | Accepted |
| D-002 | Consolidate H-25..H-30 (6→2) and H-07..H-09 (3→1) | 2026-02-21 | Accepted |
| D-003 | Defer TASK-016 until EN-002 consolidation complete | 2026-02-21 | Accepted |
| D-004 | Add L5 CI enforcement gate for HARD rule ceiling | 2026-02-21 | Accepted |
| D-005 | Measure enforcement effectiveness before further optimization | 2026-02-21 | Accepted |

---

## Related Artifacts

| Type | Path | Description |
|------|------|-------------|
| Parent | [EN-002](../EN-002.md) | Parent enabler |
| Discovery | [DISC-001](../DISC-001-hard-rule-budget-no-derivation/DISC-001.md) | Ceiling has no derivation |
| Discovery | [DISC-002](../DISC-002-l2-engine-coverage-gap/DISC-002.md) | L2 engine coverage gap |
| Derivation | `orchestration/.../adversary/hard-rule-budget/hard-rule-budget-upper-boundary-derivation-r2.md` | C4 tournament derivation (0.95 PASS) |
| Blocked task | [TASK-016](../../EN-001-install-agent-pattern-deliverables/TASK-016-integrate-hard-rules/TASK-016.md) | H-32..H-35 integration (deferred per D-003) |

---

## Document History

| Date | Author | Change |
|------|--------|--------|
| 2026-02-21 | Claude (PROJ-007 orchestrator) | Created — 5 decisions accepted |

---

## Metadata

```yaml
id: "EN-002:DEC-001"
parent_id: "EN-002"
work_type: DECISION
title: "HARD Rule Budget Implementation Plan"
status: ACCEPTED
priority: HIGH
created_by: "Claude (PROJ-007 orchestrator)"
created_at: "2026-02-21T23:45:00Z"
updated_at: "2026-02-21T23:45:00Z"
decided_at: "2026-02-21T23:45:00Z"
participants: ["User", "Claude (PROJ-007 orchestrator)"]
tags: [governance, enforcement, hard-rules, implementation-plan]
decision_count: 5
superseded_by: null
supersedes: null
```
