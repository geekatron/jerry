# EN-002: Investigate Plugin Loading Failure

> **Enabler ID:** EN-002
> **Feature:** FT-002 Plugin Loading Fix
> **Solution Epic:** SE-001
> **Project:** PROJ-007-jerry-bugs
> **Status:** PENDING
> **Created:** 2026-01-14
> **Last Updated:** 2026-01-14

---

## Objective

Investigate why Jerry plugin does not load or interact when started via `claude --plugin-dir`.

---

## Acceptance Criteria

- [ ] AC-002.1: Root cause identified
- [ ] AC-002.2: Hook execution verified or failure identified
- [ ] AC-002.3: PYTHONPATH handling verified
- [ ] AC-002.4: Corrective actions proposed

---

## Tasks

| ID | Task | Status | Evidence |
|----|------|--------|----------|
| T-002.1 | Review hooks.json configuration | DONE | SessionStart uses uv run |
| T-002.2 | Check session_start.py imports | DONE | Imports from src.infrastructure |
| T-002.3 | Verify PEP 723 metadata | DONE | dependencies = [] (empty) |
| T-002.4 | Test hook execution manually | PENDING | - |
| T-002.5 | Verify PYTHONPATH expansion | PENDING | - |
| T-002.6 | Check uv availability | PENDING | - |

---

## Preliminary Findings

### Hook Configuration

```json
"SessionStart": [{
  "command": "PYTHONPATH=\"${CLAUDE_PLUGIN_ROOT}\" uv run ${CLAUDE_PLUGIN_ROOT}/src/interface/cli/session_start.py"
}]
```

### session_start.py Imports (lines 50-57)

```python
from src.infrastructure.adapters.configuration.layered_config_adapter import (
    LayeredConfigAdapter,
)
from src.infrastructure.adapters.persistence.atomic_file_adapter import (
    AtomicFileAdapter,
)
from src.session_management.application import GetProjectContextQuery
from src.session_management.infrastructure import FilesystemProjectAdapter, OsEnvironmentAdapter
```

### Potential Issues

1. **PEP 723 dependencies empty:** `dependencies = []` means uv run won't install anything, but the script imports from `src.infrastructure`
2. **PYTHONPATH expansion:** The `${CLAUDE_PLUGIN_ROOT}` variable may not expand correctly in all contexts
3. **Module resolution:** The imports assume `src/` is in PYTHONPATH

---

## Related Artifacts

| Type | Location | Description |
|------|----------|-------------|
| Feature Tracker | [FEATURE-WORKTRACKER.md](./FEATURE-WORKTRACKER.md) | Parent FT-002 |
| Bug Doc | [bug-002-plugin-not-loading.md](./bug-002-plugin-not-loading.md) | Bug documentation |
| PROJ-005 | [../../PROJ-005-plugin-bugs/](../../PROJ-005-plugin-bugs/) | Previous fixes |
| Hook Config | `hooks/hooks.json` | Hook definition |
| Session Hook | `src/interface/cli/session_start.py` | Hook implementation |

---

## Change Log

| Date | Change | Author |
|------|--------|--------|
| 2026-01-14 | EN-002 created | Claude |
| 2026-01-14 | Preliminary review completed (T-002.1 to T-002.3) | Claude |
