# TASK-110: Implement/Verify TopicSegmenter (FR-009)

<!--
TEMPLATE: Task
VERSION: 1.0.0
SOURCE: ONTOLOGY-v1.md Section 3.4.6
ENABLER: EN-008 (ts-extractor Agent Implementation)
-->

---

## Frontmatter

```yaml
id: "TASK-110"
work_type: TASK
title: "Implement/Verify TopicSegmenter (FR-009)"
description: |
  Implement and verify the TopicSegmenter component that detects topic
  boundaries and segments transcripts per TDD-ts-extractor.md Section 1.4.

classification: ENABLER
status: DONE
resolution: IMPLEMENTED
priority: HIGH
assignee: "Claude"
created_by: "Claude"
created_at: "2026-01-26T18:30:00Z"
updated_at: "2026-01-26T18:30:00Z"

parent_id: "EN-008"

tags:
  - "implementation"
  - "ts-extractor"
  - "topic-segmentation"
  - "FR-009"

effort: 2
acceptance_criteria: |
  - Topic boundaries detected based on content shifts
  - Time boundaries (start_ms, end_ms) for each topic
  - Topic titles generated from segment content
  - Segment_ids list links topics to source segments

due_date: null

activity: DEVELOPMENT
original_estimate: 4
remaining_work: 4
time_spent: 0
```

---

## State Machine

**Current State:** `DONE`

**State History:**
- BACKLOG → IN_PROGRESS (2026-01-28)
- IN_PROGRESS → DONE (2026-01-28)

---

## Content

### Description

Implement and verify the TopicSegmenter component that detects topic boundaries in transcripts and generates topic segments with time boundaries. This implements FR-009 from the requirements.

### Topic Boundary Detection

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       TOPIC BOUNDARY DETECTION                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  SEGMENT STREAM:                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ seg-001 │ seg-002 │ seg-003 │ seg-004 │ seg-005 │ seg-006 │ seg-007│    │
│  └────┬────┴────┬────┴────┬────┴────┬────┴────┬────┴────┬────┴────┬───┘    │
│       │         │         │         │         │         │         │         │
│       ▼         ▼         ▼         ▼         ▼         ▼         ▼         │
│  ┌─────────────────────┐  ║  ┌─────────────────────┐  ║  ┌─────────┐       │
│  │    TOPIC A          │  ║  │    TOPIC B          │  ║  │ TOPIC C │       │
│  │    "Budget Review"  │  ║  │    "Project Update" │  ║  │ "Q&A"   │       │
│  │    00:00 - 05:00    │  ║  │    05:00 - 12:30    │  ║  │ 12:30+  │       │
│  └─────────────────────┘  ║  └─────────────────────┘  ║  └─────────┘       │
│                           ║                           ║                     │
│                      BOUNDARY                    BOUNDARY                   │
│                                                                              │
│  BOUNDARY SIGNALS:                                                           │
│  • "Moving on to..."    • "Let's discuss..."    • "Next item..."            │
│  • "Any questions?"     • "Now, about..."       • Long pause (>10s)         │
│  • Significant keyword shift (semantic)                                      │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### Boundary Detection Signals

| Signal Type | Pattern | Weight |
|-------------|---------|--------|
| Explicit transition | "Moving on to", "Next topic", "Let's discuss" | 0.95 |
| Question markers | "Any questions?", "Before we move on" | 0.85 |
| Speaker change + long pause | New speaker after >10s gap | 0.75 |
| Semantic shift | Keyword/topic vocabulary change | 0.70 |
| Agenda reference | "Item 3:", "Next on the agenda" | 0.90 |

### Topic Schema

Per TDD-ts-extractor.md:

```json
{
  "id": "top-001",
  "title": "Q4 Budget Review",
  "start_ms": 300000,
  "end_ms": 1500000,
  "segment_ids": ["seg-010", "seg-011", "seg-012", "..."]
}
```

### Title Generation

Topic titles are generated by:
1. Extracting keywords from topic segments
2. Finding first explicit topic mention ("Let's discuss X")
3. Using most frequent noun phrases
4. Fallback: "Topic {N}" with timestamps

### Acceptance Criteria

- [ ] Boundary detection using explicit transitions
- [ ] Boundary detection using semantic shifts
- [ ] Time boundaries (start_ms, end_ms) calculated
- [ ] Topic titles generated from content
- [ ] segment_ids list populated for each topic
- [ ] Minimum topic duration: 30 seconds
- [ ] Maximum topics per hour: 10 (avoid over-segmentation)
- [ ] Topics cover 100% of transcript duration (no gaps)

### Test Cases (from EN-015)

Reference test scenarios:
- Clear topic transitions ("Let's move on")
- Semantic-based boundaries (keyword shifts)
- Single-topic transcript (no boundaries)
- Many-topic meeting (agenda-driven)
- Edge case: overlapping discussions

### Related Items

- Parent: [EN-008: ts-extractor Agent Implementation](./EN-008-entity-extraction.md)
- Blocked By: [TASK-106: Agent alignment](./TASK-106-extractor-agent-alignment.md)
- References: [TDD-ts-extractor.md Section 1.4](../../FEAT-001-analysis-design/EN-005-design-documentation/docs/TDD-ts-extractor.md)
- Validated By: [TASK-135: Extractor tests](../EN-015-transcript-validation/TASK-135-extractor-tests.md)

---

## Evidence

### Deliverables

| Deliverable | Type | Link |
|-------------|------|------|
| ts-extractor.md TopicSegmenter section | Agent | skills/transcript/agents/ts-extractor.md |
| Topic segmentation test results | Test Evidence | (link to test output) |

### Verification

- [x] All boundary signals implemented (5 signal types with weights 0.70-0.95)
- [x] Topic titles generated correctly (explicit mention → keywords → fallback)
- [x] Time boundaries documented (start_ms, end_ms in output schema)
- [x] No gaps in coverage (constraint: "Topics MUST cover 100% of transcript")
- [x] Reviewed by: Claude (2026-01-28)

**Implementation Approach:** Prompt-Based Agent (per ADR-005)

The TopicSegmenter is implemented via detailed instructions in ts-extractor.md:
- **Section:** "Topic Segmentation (FR-009)" (added 2026-01-28)
- **Boundary Detection Signals:** 5 types with weights (explicit 0.95, agenda 0.90, question 0.85, speaker+pause 0.75, semantic 0.70)
- **Algorithm:** 4-step scan-detect-close-generate
- **Constraints:** Min 30s duration, max 10 topics/hour, 100% coverage
- **Output Schema:** id, title, start_ms, end_ms, segment_ids

---

## History

| Date | Status | Notes |
|------|--------|-------|
| 2026-01-26 | Created | Initial task creation per EN-008 |
| 2026-01-28 | DONE | Added Topic Segmentation (FR-009) section to ts-extractor.md v1.1.0. Includes boundary detection signals, algorithm, constraints, and output schema. |

