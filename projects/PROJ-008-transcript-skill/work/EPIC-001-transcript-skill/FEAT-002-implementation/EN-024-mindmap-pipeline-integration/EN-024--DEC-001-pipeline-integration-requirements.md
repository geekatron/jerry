# EN-024:DEC-001: Pipeline Integration Requirements

<!--
TEMPLATE: Decision
VERSION: 1.0.0
SOURCE: worktracker.md (Decision File), ADR/MADR best practices
CREATED: 2026-01-28 (EN-024 Planning)
PURPOSE: Document decisions for mindmap pipeline integration requirements
-->

> **Type:** decision
> **Status:** SUPERSEDED
> **Priority:** high
> **Created:** 2026-01-28T00:00:00Z
> **Superseded:** 2026-01-30T00:00:00Z
> **Superseded By:** [ADR-006: Mindmap Pipeline Integration](../../../../../docs/adrs/ADR-006-mindmap-pipeline-integration.md)
> **Parent:** EN-024
> **Owner:** Claude
> **Related:** EN-009, ADR-002, ADR-006

---

## Summary

> **⚠️ SUPERSEDED:** This decision document has been superseded by [ADR-006: Mindmap Pipeline Integration](../../../../../docs/adrs/ADR-006-mindmap-pipeline-integration.md).
>
> **Key Changes in ADR-006:**
> - D-001 changed from opt-in (`--mindmap`) to **opt-out** (`--no-mindmap`) - mindmaps now ON by default
> - Output directory changed from `07-mindmap/` to `08-mindmap/` per DISC-001
> - State key formalized as `ts_mindmap_output`
> - Validation criteria formalized as MM-001..007, AM-001..005
>
> **For current decisions, refer to ADR-006.**

---

This document captures the **initial** requirements decisions made between the User and Claude for integrating mindmap generation into the transcript skill pipeline. These decisions were formalized and **refined** in ADR-006.

**Decisions Captured:** 6 (see ADR-006 for refined versions)

**Original Key Outcomes (Superseded):**
- ~~Mindmap generation will be opt-in via `--mindmap` flag~~ → **Now opt-out via `--no-mindmap`**
- Format selection supports mermaid, ascii, or both (default) → **Unchanged**
- Pipeline position established: after ts-formatter, before ps-critic → **Unchanged**
- ps-critic will validate mindmaps when enabled → **Formalized as MM-*/AM-* criteria**
- Failure handling defined: partial result with warnings → **Unchanged**

---

## Decision Context

### Background

The EN-009 Mindmap Generator enabler successfully implemented two mindmap agents:
- `ts-mindmap-mermaid` - Generates Mermaid diagram format
- `ts-mindmap-ascii` - Generates ASCII art format

However, these agents were not integrated into the default transcript skill pipeline. This was identified as an omission in the original EN-009 scope. The User requested that we create EN-024 to address this gap.

### Constraints

- Must not break existing transcript processing workflow (backward compatibility)
- Must integrate with existing ps-critic quality review process
- Must follow Jerry Constitution principles (P-002 file persistence, P-003 no recursion)
- Must align with ADR-002 artifact structure (07-mindmap/ directory)

### Stakeholders

| Stakeholder | Role | Interest |
|-------------|------|----------|
| User (Adam) | Product Owner | Feature usability, quality |
| Claude | Implementer | Technical feasibility, architecture |

---

## Decisions

### D-001: Opt-in Mechanism

**Date:** 2026-01-28
**Participants:** User, Claude

#### Question/Context

Claude asked: "Should mindmaps be generated by default for ALL transcripts, or should this be an opt-in feature via a flag (e.g., `--mindmap`)?"

Options presented:
1. Always generate - Adds processing time to every invocation
2. Opt-in flag - Requires parameter parsing changes
3. User preference in config - More complex but flexible

#### Options Considered

| Option | Description | Pros | Cons |
|--------|-------------|------|------|
| **A** | Always generate | Simplest, users always get mindmaps | Adds latency to all runs, may not always be wanted |
| **B** | Opt-in flag | User control, no overhead when not needed | Requires flag parsing |
| **C** | Config preference | Flexible, remember user preference | More complex implementation |

#### Decision

**We decided:** Option B - Opt-in via `--mindmap` flag

#### Rationale

The User explicitly selected "Opt-in flag" because:
1. Not all users want mindmaps for every transcript
2. Avoids unnecessary processing overhead
3. Explicit control is better than implicit behavior
4. Simpler than config-based approach

---

### D-002: Format Selection

**Date:** 2026-01-28
**Participants:** User, Claude

#### Question/Context

Claude asked: "Should the pipeline generate both Mermaid and ASCII mindmaps, or just one?"

Current state: Two agents exist (ts-mindmap-mermaid, ts-mindmap-ascii).

#### Options Considered

| Option | Description | Pros | Cons |
|--------|-------------|------|------|
| **A** | Both always | Complete output coverage | Redundant for some users |
| **B** | Mermaid only (ASCII on request) | Simpler, covers most use cases | Loses accessibility |
| **C** | User-selectable format | Maximum flexibility | More parameters |

#### Decision

**We decided:** User-selectable with "both" as default if not specified

Specifically:
- `--mindmap` alone generates both formats
- `--mindmap-format mermaid` generates only Mermaid
- `--mindmap-format ascii` generates only ASCII
- `--mindmap-format both` explicitly generates both

#### Rationale

User selected this because:
1. Gives users control over output
2. "Both" as default ensures complete coverage
3. Allows optimization when only one format needed
4. Follows principle of sensible defaults with override capability

---

### D-003: Pipeline Position

**Date:** 2026-01-28
**Participants:** User, Claude

#### Question/Context

Claude asked: "Where in the pipeline should mindmap generation occur?"

```
Current Pipeline:
ts-parser -> ts-extractor -> ts-formatter -> ps-critic

Possible Positions:
A) ts-parser -> ts-extractor -> ts-formatter -> ts-mindmap -> ps-critic
B) ts-parser -> ts-extractor -> ts-formatter -> [ts-mindmap || ps-critic] (parallel)
C) ts-parser -> ts-extractor -> ts-formatter -> ps-critic -> ts-mindmap (post-QA)
```

#### Options Considered

| Option | Description | Pros | Cons |
|--------|-------------|------|------|
| **A** | Before ps-critic | Mindmaps get quality reviewed | Sequential delay |
| **B** | Parallel with ps-critic | Faster execution | Mindmaps not reviewed |
| **C** | After ps-critic | Simplest integration | No quality review for mindmaps |

#### Decision

**We decided:** Option A - Mindmap generation before ps-critic so artifacts can be critiqued and reviewed

#### Rationale

User explicitly asked: "Where in the pipeline would be the best place so that the artifact could also be critiqued and reviewed?" - clearly indicating that ps-critic coverage for mindmaps is required.

---

### D-004: ps-critic Coverage

**Date:** 2026-01-28
**Participants:** User, Claude

#### Question/Context

Claude asked: "Should ps-critic validate the mindmap output as part of the quality review?"

This requires:
- Updating ps-critic's evaluation criteria
- Adding mindmap-specific quality checks
- Potentially affecting the >= 0.90 quality threshold

#### Decision

**We decided:** Yes, ps-critic should validate mindmaps when mindmap generation is enabled

#### Rationale

User confirmed: "Yes it should if mindmap was selected"

This ensures:
1. Consistent quality assurance across all outputs
2. Mindmaps are held to same standard as other artifacts
3. Invalid Mermaid syntax or broken links are caught

---

### D-005: Enabler Location

**Date:** 2026-01-28
**Participants:** User, Claude

#### Question/Context

Claude asked: "Should EN-024 (Pipeline Integration) live in FEAT-003 (future enhancements) or FEAT-002 (implementation)?"

Context:
- EN-009 (Mindmap Generator) is in FEAT-002
- The integration was an omission in original scope
- FEAT-003 contains deferred "above and beyond" scope

#### Options Considered

| Option | Description | Pros | Cons |
|--------|-------------|------|------|
| **A** | FEAT-003 | Keeps it separate as enhancement | Disconnected from EN-009 |
| **B** | FEAT-002 | Completes the EN-009 work | More work in FEAT-002 |

#### Decision

**We decided:** EN-024 lives in FEAT-002 since it's integrating existing EN-009 work into the core pipeline

#### Rationale

User clarified: "live in FEAT-002 - since it's integrating existing EN-009 work into the core pipeline. I mean technically EN-009 is complete and we didn't have work in there to integrate into the pipeline, which was an omission."

---

### D-006: Failure Handling

**Date:** 2026-01-28
**Participants:** User, Claude

#### Question/Context

Claude flagged concern: "What happens if mindmap generation fails? Should it block the whole pipeline, or produce a partial result with warnings?"

#### Options Considered

| Option | Description | Pros | Cons |
|--------|-------------|------|------|
| **A** | Block pipeline | Ensures complete output | Loses other valid outputs |
| **B** | Partial result with warnings | Graceful degradation | Incomplete output |
| **C** | Silent failure | User unaware | Poor UX |

#### Decision

**We decided:** Produce a partial result with warnings and instructions on how to regenerate the mindmap

#### Rationale

User specified: "Product a partial result with warnings and instructions on how to be able to just re-generate the mermaid."

This ensures:
1. Users still get the main transcript outputs
2. Clear indication that mindmap failed
3. Actionable recovery path provided
4. No silent failures

---

## Decision Summary

| ID | Decision | Date | Status |
|----|----------|------|--------|
| D-001 | Opt-in via --mindmap flag | 2026-01-28 | DOCUMENTED |
| D-002 | User-selectable format, "both" default | 2026-01-28 | DOCUMENTED |
| D-003 | Pipeline position: before ps-critic | 2026-01-28 | DOCUMENTED |
| D-004 | ps-critic validates mindmaps when enabled | 2026-01-28 | DOCUMENTED |
| D-005 | EN-024 lives in FEAT-002 | 2026-01-28 | DOCUMENTED |
| D-006 | Partial result with warnings on failure | 2026-01-28 | DOCUMENTED |

---

## Related Artifacts

| Type | Path | Description |
|------|------|-------------|
| Parent | [EN-024-mindmap-pipeline-integration.md](./EN-024-mindmap-pipeline-integration.md) | Parent enabler |
| Related | [EN-009-mindmap-generator.md](../EN-009-mindmap-generator/EN-009-mindmap-generator.md) | Mindmap agents implementation |
| Related | [ADR-002-artifact-structure.md](../../../../../docs/adrs/ADR-002-artifact-structure.md) | Defines 07-mindmap/ structure |
| Related | [SKILL.md](../../../../../skills/transcript/SKILL.md) | Skill definition to be updated |

---

## Document History

| Date | Author | Change |
|------|--------|--------|
| 2026-01-28 | Claude | Created decision document capturing 6 decisions from user discussion |
| 2026-01-30 | Claude | **SUPERSEDED by ADR-006**: Decision D-001 changed from opt-in to opt-out behavior. All decisions formalized in ADR-006 with L0/L1/L2 explanations. |

---

## Metadata

```yaml
id: "EN-024:DEC-001"
parent_id: "EN-024"
work_type: DECISION
title: "Pipeline Integration Requirements"
status: SUPERSEDED
priority: high
created_by: "Claude"
created_at: "2026-01-28T00:00:00Z"
updated_at: "2026-01-30T00:00:00Z"
decided_at: "2026-01-28T00:00:00Z"
superseded_at: "2026-01-30T00:00:00Z"
participants: ["User", "Claude"]
tags: ["pipeline", "mindmap", "integration", "requirements", "superseded"]
decision_count: 6
superseded_by: "ADR-006"
supersedes: null
```
