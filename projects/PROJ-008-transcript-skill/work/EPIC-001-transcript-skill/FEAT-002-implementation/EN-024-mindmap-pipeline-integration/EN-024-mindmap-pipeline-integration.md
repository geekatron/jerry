# EN-024: Mindmap Pipeline Integration

<!--
TEMPLATE: Enabler
VERSION: 1.0.0
SOURCE: ONTOLOGY-v1.md Section 3.4.9
CREATED: 2026-01-28 per user request
PURPOSE: Integrate EN-009 mindmap agents into default transcript skill pipeline
RENUMBERED: 2026-01-28 from EN-019 per ID conflict (EN-019 = Large Transcript Dataset Extension)
-->

> **Type:** enabler
> **Status:** done
> **Priority:** high
> **Impact:** high
> **Enabler Type:** architecture
> **Created:** 2026-01-28T00:00:00Z
> **Due:** TBD
> **Completed:** 2026-01-30T00:00:00Z
> **Parent:** FEAT-002
> **Owner:** Claude
> **Effort:** 21

---

## Summary

Integrate the existing mindmap generator agents (ts-mindmap-mermaid, ts-mindmap-ascii) from EN-009 into the default transcript skill pipeline as an opt-in feature. This addresses an omission in the original EN-009 scope where the agents were implemented but not wired into the pipeline.

**Technical Scope:**
- Mindmaps generated **by default** with `--no-mindmap` opt-out flag in SKILL.md invocation
- Add `--mindmap-format` parameter (mermaid, ascii, both) with "both" as default
- Insert mindmap generation step between ts-formatter and ps-critic
- Update ps-critic to validate mindmap output when mindmaps are enabled
- Create ADR-006 to formalize the integration decision
- Update documentation (PLAYBOOK.md, RUNBOOK.md)
- Output to `08-mindmap/` directory (per DISC-001 numbering correction)

---

## Enabler Type Classification

| Type | Description | Examples |
|------|-------------|----------|
| **INFRASTRUCTURE** | Platform, tooling, DevOps enablers | CI/CD pipelines, monitoring setup |
| **EXPLORATION** | Research and proof-of-concept work | Technology spikes, prototypes |
| **ARCHITECTURE** | Architectural runway and design work | Service decomposition, API design |
| **COMPLIANCE** | Security, regulatory, and compliance requirements | GDPR implementation, SOC2 controls |

**This Enabler Type:** ARCHITECTURE (Pipeline design and integration)

---

## Problem Statement

The EN-009 Mindmap Generator enabler successfully implemented two mindmap agents (ts-mindmap-mermaid and ts-mindmap-ascii) with deep linking support. However, these agents are not integrated into the default transcript skill pipeline.

**Current State:**
```
ts-parser -> ts-extractor -> ts-formatter -> ps-critic
```

**Gap:** Users cannot generate mindmaps as part of standard transcript processing without manually invoking the agents after the fact.

**Impact:**
- Mindmaps are a key differentiation feature (per EN-001 competitive analysis)
- Manual invocation breaks the seamless workflow experience
- ps-critic does not validate mindmap quality

---

## Business Value

Integrating mindmaps into the pipeline delivers on the original product vision from competitive analysis:

**From EN-001 Market Analysis:**
- Mind maps are a differentiating feature not common in competitors
- Visual representation aids comprehension of meeting content
- Deep linking provides source verification capability

### Features Unlocked

- Seamless mindmap generation with single `/transcript` command
- User-selectable format (Mermaid, ASCII, or both)
- Quality-assured mindmaps via ps-critic validation
- Complete packet output including visual artifacts

---

## Technical Approach

### Pipeline Integration Design

```
DEFAULT PIPELINE (mindmaps generated by default):

ts-parser -> ts-extractor -> ts-formatter -> ts-mindmap-* -> ps-critic
                                                   |
                                                   v
                                        08-mindmap/mindmap.mmd
                                        08-mindmap/mindmap.ascii.txt

PIPELINE WITH --no-mindmap (opt-out):

ts-parser -> ts-extractor -> ts-formatter -> ps-critic
                                        (mindmaps skipped)
```

### Parameter Design

| Parameter | Type | Default | Values |
|-----------|------|---------|--------|
| `--no-mindmap` | flag | false | (presence disables mindmap generation) |
| `--mindmap-format` | string | "both" | "mermaid", "ascii", "both" |

**Behavior:**
- Mindmaps are generated **by default** with both Mermaid and ASCII formats
- Use `--no-mindmap` to disable mindmap generation
- Use `--mindmap-format` to select specific format (mermaid, ascii, or both)

### State Passing

| Agent | Input | Output |
|-------|-------|--------|
| ts-formatter | extraction-report.json | 8-file packet + ts_formatter_output |
| ts-mindmap-* | ts_formatter_output + packet | 08-mindmap/ files + ts_mindmap_output |
| ps-critic | all files including mindmaps | quality-review.md |

### Architecture Diagram

```
+------------------------------------------------------------------+
|                     TRANSCRIPT SKILL PIPELINE                      |
+------------------------------------------------------------------+
|                                                                    |
|  USER INPUT (mindmaps generated BY DEFAULT)                        |
|  /transcript file.vtt [--mindmap-format both]                      |
|  /transcript file.vtt --no-mindmap   (to disable)                  |
|       |                                                            |
|       v                                                            |
|  +-----------+                                                     |
|  | ts-parser |  (haiku)                                            |
|  +-----------+                                                     |
|       |                                                            |
|       v canonical-transcript.json                                  |
|  +-------------+                                                   |
|  | ts-extractor| (sonnet)                                          |
|  +-------------+                                                   |
|       |                                                            |
|       v extraction-report.json                                     |
|  +-------------+                                                   |
|  | ts-formatter| (sonnet)                                          |
|  +-------------+                                                   |
|       |                                                            |
|       v 8-file packet                                              |
|       |                                                            |
|       +-- [--no-mindmap flag set?] -+                              |
|       |           NO (default)      |                              |
|       v                             | YES (skip mindmaps)          |
|  +-------------------+              |                              |
|  | ts-mindmap-mermaid| (sonnet)     |                              |
|  | ts-mindmap-ascii  | (sonnet)     |                              |
|  +-------------------+              |                              |
|       |                             |                              |
|       v 08-mindmap/ files           |                              |
|       +-----------------------------+                              |
|       |                                                            |
|       v                                                            |
|  +-----------+                                                     |
|  | ps-critic | (sonnet) - validates mindmaps if present            |
|  +-----------+                                                     |
|       |                                                            |
|       v quality-review.md                                          |
|                                                                    |
+------------------------------------------------------------------+
```

---

## Non-Functional Requirements (NFRs) Addressed

| NFR Category | Requirement | Current State | Target State |
|--------------|-------------|---------------|--------------|
| Usability | Single command workflow | Manual post-processing | Integrated pipeline |
| Quality | Mindmap validation | Not validated | ps-critic coverage |
| Flexibility | Format selection | N/A | User-selectable |
| Extensibility | Pipeline modularity | Fixed stages | Conditional stages |

---

## Children (Tasks)

### Task Inventory

| ID | Title | Status | Effort | Owner | Blocked By |
|----|-------|--------|--------|-------|------------|
| [TASK-240](./TASK-240-research-pipeline-state.md) | Research: Current Pipeline State Analysis | DONE | 2 | Claude | - |
| [TASK-241](./TASK-241-analysis-5w2h-ishikawa.md) | Analysis: 5W2H + Ishikawa Integration Analysis | DONE | 3 | Claude | TASK-240 |
| [TASK-242](./TASK-242-adr-006-mindmap-integration.md) | ADR-006: Mindmap Pipeline Integration Decision | DONE | 3 | Claude | TASK-241 |
| [TASK-243](./TASK-243-skill-md-mindmap-flag.md) | Update SKILL.md with --mindmap Flag | DONE | 2 | Claude | TASK-242 |
| [TASK-244](./TASK-244-pipeline-orchestration-update.md) | Update Pipeline Orchestration Flow | DONE | 3 | Claude | TASK-242 |
| [TASK-245](./TASK-245-ps-critic-mindmap-validation.md) | Update ps-critic Mindmap Validation Criteria | DONE | 2 | Claude | TASK-244 |
| [TASK-246](./TASK-246-integration-tests.md) | Integration Tests for Mindmap Pipeline | DONE | 3 | Claude | TASK-244, TASK-245 |
| [TASK-247](./TASK-247-documentation-update.md) | Update PLAYBOOK.md and RUNBOOK.md | DONE | 2 | Claude | TASK-244 |
| [TASK-248](./TASK-248-quality-review.md) | Quality Review (ps-critic) | DONE | 1 | Claude | TASK-246, TASK-247 |

### Decisions

| ID | Title | Status |
|----|-------|--------|
| [DEC-001](./EN-024--DEC-001-pipeline-integration-requirements.md) | Pipeline Integration Requirements | pending |

### Discoveries

| ID | Title | Status |
|----|-------|--------|
| [DISC-001](./EN-024--DISC-001-mindmap-directory-numbering-discrepancy.md) | Mindmap Directory Numbering Discrepancy (07 → 08) | DOCUMENTED |
| [DISC-002](./DISC-002-mermaid-syntax-limitations.md) | Mermaid Mindmap Syntax Limitations (no markdown links) | RESOLVED |

---

## Progress Summary

### Status Overview

```
+------------------------------------------------------------------+
|                   ENABLER PROGRESS TRACKER                        |
+------------------------------------------------------------------+
| Tasks:     [####################] 100% (9/9 completed)           |
| Effort:    [####################] 100% (21/21 points completed)  |
+------------------------------------------------------------------+
| Overall:   [####################] 100%                           |
+------------------------------------------------------------------+
```

### Progress Metrics

| Metric | Value |
|--------|-------|
| **Total Tasks** | 9 |
| **Completed Tasks** | 9 |
| **Total Effort (points)** | 21 |
| **Completed Effort** | 21 |
| **Completion %** | 100% |

---

## Acceptance Criteria

### Definition of Done

- [x] ADR-006 created and accepted for pipeline integration
- [x] SKILL.md updated with --mindmap and --mindmap-format parameters (TASK-243)
- [x] Pipeline orchestration updated with conditional mindmap step (TASK-244)
- [x] ps-critic validation criteria includes mindmap checks (TASK-245: ts-critic-extension.md)
- [x] Integration tests passing for mindmap pipeline (TASK-246: mindmap-pipeline-tests.yaml)
- [x] PLAYBOOK.md and RUNBOOK.md updated (TASK-247)
- [x] Quality review passed (ps-critic >= 0.90) (TASK-248: Score **0.93 PASS**)
- [ ] Human approval at GATE-5 (AWAITING)

### Technical Criteria

| # | Criterion | Verified |
|---|-----------|----------|
| AC-1 | Mindmaps generated **by default** (no flag needed) | [x] |
| AC-2 | `--no-mindmap` flag disables mindmap generation | [x] |
| AC-3 | `--mindmap-format` accepts mermaid, ascii, both | [x] |
| AC-4 | Default format is "both" (Mermaid + ASCII) | [x] |
| AC-5 | Mindmaps generated after ts-formatter | [x] |
| AC-6 | ps-critic validates mindmaps when present | [x] |
| AC-7 | Pipeline works correctly with `--no-mindmap` | [x] |
| AC-8 | Partial result with warnings on mindmap failure | [x] |
| AC-9 | Instructions provided for mindmap regeneration | [x] |
| AC-10 | Output to `08-mindmap/` directory (per DISC-001) | [x] |

---

## Risks and Mitigations

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Pipeline complexity increases | MEDIUM | LOW | Clear conditional logic, comprehensive tests |
| ps-critic scope creep | LOW | MEDIUM | Define specific mindmap criteria only |
| Breaking existing workflow | LOW | HIGH | Extensive regression testing |
| Format selection confusion | LOW | LOW | Clear documentation, sensible defaults |

---

## Dependencies

### Depends On

- [EN-009: Mindmap Generator](../EN-009-mindmap-generator/EN-009-mindmap-generator.md) - Provides ts-mindmap-mermaid and ts-mindmap-ascii agents
- [EN-014: Domain Context Files](../EN-014-domain-context-files/EN-014-domain-context-files.md) - Context domain schemas must be complete before pipeline integration
- [EN-016: ts-formatter](../EN-016-ts-formatter/EN-016-ts-formatter.md) - Provides packet output that mindmaps consume
- [ADR-002: Artifact Structure](../../../../../docs/adrs/ADR-002-artifact-structure.md) - Defines 08-mindmap/ in packet structure
- [ADR-003: Bidirectional Linking](../../../../../docs/adrs/ADR-003-bidirectional-linking.md) - Deep link format for mindmaps

### Enables

- Complete transcript skill pipeline with visual outputs
- Quality-assured mindmap generation
- User-controlled format selection

---

## Related Items

### Hierarchy

- **Parent Feature:** [FEAT-002: Implementation](../FEAT-002-implementation.md)

### Related Items

- **Prerequisite Enabler:** [EN-009: Mindmap Generator](../EN-009-mindmap-generator/EN-009-mindmap-generator.md)
- **Related ADR:** [ADR-002: Artifact Structure](../../../../../docs/adrs/ADR-002-artifact-structure.md)
- **Successor Enabler:** [EN-015: Validation & Test Cases](../EN-015-validation-test-cases/EN-015-validation-test-cases.md) - End-to-end validation includes EN-024 pipeline

---

## History

| Date | Author | Status | Notes |
|------|--------|--------|-------|
| 2026-01-28 | Claude | pending | Enabler created per user request. Addresses omission in EN-009 scope where agents were implemented but not integrated into pipeline. |
| 2026-01-28 | Claude | pending | **RENUMBERED from EN-019 to EN-024** per ID conflict. EN-019 is allocated to "Large Transcript Dataset Extension" in ORCHESTRATION.yaml. Task IDs renumbered from TASK-001..009 to TASK-240..248 per global task allocation. Added EN-014 as dependency. |
| 2026-01-30 | Claude | pending | **OPT-OUT BEHAVIOR**: Changed from `--mindmap` opt-in to `--no-mindmap` opt-out per user requirement. Mindmaps now generated by default. |
| 2026-01-30 | Claude | pending | **DIRECTORY NUMBERING**: Corrected `07-mindmap/` to `08-mindmap/` per DISC-001 discovery. Updated all agent files, research documents, and acceptance criteria. |
| 2026-01-30 | Claude | pending | **TASK-240 COMPLETE**: Pipeline state research completed. 7 integration gaps identified (GAP-001 through GAP-007). Pipeline ordering confirmed: ts-formatter → ts-mindmap-* → ps-critic. |
| 2026-01-30 | Claude | pending | **TASK-241 COMPLETE**: 5W2H + Ishikawa analysis completed. 3 critical risks identified. Pareto analysis identified top 4 root causes. Analysis document created at `analysis/TASK-241-5w2h-ishikawa-analysis.md`. |
| 2026-01-30 | Claude | pending | **TASK-242 COMPLETE**: ADR-006 created via ps-architect agent using /jerry:problem-solving skill. Documents Option A (mindmaps after ts-formatter), opt-out behavior (`--no-mindmap`), graceful degradation, and MM-*/AM-* validation criteria. ADR at `docs/adrs/ADR-006-mindmap-pipeline-integration.md`. |
| 2026-01-30 | Claude | pending | **TASK-243, 244 COMPLETE**: SKILL.md and PLAYBOOK.md pipeline orchestration verified as already including mindmap integration per ADR-006. Phase 3.5 conditional logic documented. Live skill invocation confirmed mindmap generation. |
| 2026-01-30 | Claude | pending | **TASK-245 COMPLETE**: Created `skills/transcript/validation/ts-critic-extension.md` with MM-001..007 (Mermaid) and AM-001..005 (ASCII) validation criteria. Architecture choice: Option B (transcript-specific extension, not modifying shared ps-critic.md). Quality score composition: 85% core / 15% mindmap. |
| 2026-01-30 | Claude | pending | **TASK-246 COMPLETE**: Created `skills/transcript/test_data/validation/mindmap-pipeline-tests.yaml` with TC-001..TC-009 comprehensive integration tests covering default behavior, format selection, opt-out, graceful degradation, and ps-critic integration. |
| 2026-01-30 | Claude | pending | **TASK-247 COMPLETE**: Updated PLAYBOOK.md (v1.0.0→v1.1.0) with Phase 3.5, DP-2.5/DP-3 decision points, time commitment. Updated RUNBOOK.md (v1.0.0→v1.1.0) with R-015/R-016/R-017 mindmap troubleshooting procedures. |
| 2026-01-30 | Claude | **done** | **TASK-248 COMPLETE**: ps-critic quality review executed. **Score: 0.93 PASS** (threshold 0.90). Deliverable scores: ADR-006 (0.95), ts-critic-extension.md (0.96), mindmap-pipeline-tests.yaml (0.93), PLAYBOOK.md (0.92), RUNBOOK.md (0.93). 0 critical issues. Report at `critiques/en024-quality-review.md`. **EN-024 ENABLER COMPLETE. AWAITING GATE-5 HUMAN APPROVAL.** |

---

## System Mapping

| System | Mapping |
|--------|---------|
| **Azure DevOps** | PBI with ValueArea=Architectural |
| **SAFe** | Enabler (Architecture type) |
| **JIRA** | Story with 'enabler' label |
