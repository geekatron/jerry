# TASK-241: 5W2H + Ishikawa Integration Analysis

<!--
TEMPLATE: Analysis
VERSION: 1.0.0
SOURCE: .context/templates/worktracker/TASK.md
TASK: EN-024:TASK-241
-->

---

## Frontmatter

```yaml
id: "EN-024:TASK-241:ANALYSIS"
title: "5W2H + Ishikawa Analysis: Mindmap Pipeline Integration"
version: "1.0.0"
status: "COMPLETE"
created_at: "2026-01-30T00:00:00Z"
completed_at: "2026-01-30T00:00:00Z"
author: "Claude"
parent_task: "EN-024:TASK-241"
frameworks_applied:
  - 5W2H
  - Ishikawa (Fishbone)
  - Pareto (80/20)
  - Risk Assessment
```

---

## Executive Summary

This analysis applies structured problem-solving frameworks to the mindmap pipeline integration challenge for the transcript skill (EN-024). The analysis identifies that the integration is technically straightforward but requires careful attention to state passing, failure handling, and quality validation.

**Key Findings:**
1. **Integration Point**: ts-formatter → ts-mindmap-* → ps-critic (confirmed by TASK-240 research)
2. **Default Behavior**: Mindmaps generated by default with `--no-mindmap` opt-out (per user requirement)
3. **Critical Risks**: Mindmap failure blocking pipeline (mitigated by graceful degradation)
4. **Complexity**: LOW-MEDIUM - Well-defined agents, clear interfaces

---

## 1. 5W2H Analysis

### 1.1 WHO - Stakeholders and Users

| Stakeholder | Role | Impact | Concerns |
|-------------|------|--------|----------|
| **End Users** | Transcript consumers | HIGH | Seamless mindmap generation, format choice |
| **Developers** | Pipeline maintainers | MEDIUM | Integration complexity, testability |
| **ts-formatter** | Upstream agent | LOW | Output consumed by mindmap agents |
| **ts-mindmap-mermaid** | Worker agent | HIGH | Correct input, anchor access |
| **ts-mindmap-ascii** | Worker agent | HIGH | Correct input, width constraints |
| **ps-critic** | Quality reviewer | MEDIUM | Validation criteria for mindmaps |

**Key Insight**: The primary beneficiary is the end user who gets visual mindmaps automatically without additional invocations.

### 1.2 WHAT - Scope Definition

| Aspect | Description |
|--------|-------------|
| **Core Deliverable** | Integrate ts-mindmap-* agents into default pipeline |
| **Parameter Changes** | Add `--no-mindmap` (opt-out) and `--mindmap-format` to SKILL.md |
| **State Changes** | Add `ts_mindmap_output` state key for ps-critic consumption |
| **Output Changes** | Add `08-mindmap/` directory to packet structure |
| **Validation Changes** | ps-critic to include mindmap quality criteria |

**What is NOT included:**
- New mindmap agent development (already complete in EN-009)
- Format converter functionality
- Real-time mindmap rendering

### 1.3 WHEN - Timing in Pipeline

```
PIPELINE EXECUTION ORDER (with mindmaps by default):

T+0s     T+30s        T+2-5min      T+1-2min       T+1min        T+30s
  │         │            │             │              │             │
  ▼         ▼            ▼             ▼              ▼             ▼
INPUT → ts-parser → ts-extractor → ts-formatter → ts-mindmap-* → ps-critic
                                        │              │
                                        ▼              ▼
                              8-file packet    08-mindmap/ files
                                                (both formats)

DECISION POINTS:
- After ts-formatter: Check --no-mindmap flag
- After ts-mindmap-*: Check success/failure status
```

**Timing Analysis:**
| Phase | Duration | Cumulative |
|-------|----------|------------|
| ts-parser | ~30s | 0:30 |
| ts-extractor | ~2-5min | 3:00-5:30 |
| ts-formatter | ~1-2min | 4:00-7:30 |
| **ts-mindmap-*** | **~1min** | **5:00-8:30** |
| ps-critic | ~30s | 5:30-9:00 |

**Impact**: Mindmap generation adds ~1 minute to total pipeline time (acceptable overhead).

### 1.4 WHERE - Integration Points

```
INTEGRATION POINT MAP
=====================

SKILL.md (Orchestrator)
    │
    ├─── [Parameter Addition]
    │    └── --no-mindmap, --mindmap-format parameters
    │
    ├─── [Pipeline Modification]
    │    └── Insert ts-mindmap-* after ts-formatter
    │
    └─── [State Schema Addition]
         └── ts_mindmap_output key definition

ts-formatter (Upstream)
    │
    └─── [No changes required]
         └── Existing ts_formatter_output compatible

ts-mindmap-mermaid (New Integration)
    │
    ├─── [Input Requirements]
    │    ├── extraction_report_path (from ts_extractor_output)
    │    └── packet_path (from ts_formatter_output)
    │
    └─── [Output]
         └── 08-mindmap/mindmap.mmd

ts-mindmap-ascii (New Integration)
    │
    ├─── [Input Requirements]
    │    ├── extraction_report_path (from ts_extractor_output)
    │    └── packet_path (from ts_formatter_output)
    │
    └─── [Output]
         └── 08-mindmap/mindmap.ascii.txt

ps-critic (Downstream)
    │
    └─── [Validation Addition]
         └── MM-* and AM-* criteria for mindmap quality
```

### 1.5 WHY - Justification

| Justification | Evidence | Source |
|---------------|----------|--------|
| **Competitive Differentiation** | Mindmaps not common in competing tools | EN-001 Market Analysis |
| **User Experience** | Single command workflow preferred | EN-003 Requirements |
| **Quality Assurance** | Mindmaps should meet quality standards | EN-006 ps-critic spec |
| **Product Completeness** | EN-009 agents implemented but not integrated | EN-024 Problem Statement |

**Why NOT Manual Invocation:**
- Breaks seamless workflow experience
- Users may forget to generate mindmaps
- ps-critic cannot validate quality
- Inconsistent packet output

### 1.6 HOW - Technical Approach

```
INTEGRATION ALGORITHM
=====================

1. USER INVOKES: /transcript file.vtt [options]

2. SKILL.MD ORCHESTRATOR PARSES OPTIONS:
   - no_mindmap = parse("--no-mindmap") → boolean
   - mindmap_format = parse("--mindmap-format") → "mermaid"|"ascii"|"both" (default: "both")

3. EXECUTE STANDARD PIPELINE:
   - ts-parser → canonical-transcript.json
   - ts-extractor → extraction-report.json
   - ts-formatter → transcript-{id}/ (8 files)

4. CONDITIONAL MINDMAP GENERATION:
   IF NOT no_mindmap THEN
       IF mindmap_format IN ["mermaid", "both"] THEN
           INVOKE ts-mindmap-mermaid
               INPUT: extraction_report_path, packet_path, packet_id, meeting_title
               OUTPUT: 08-mindmap/mindmap.mmd
       END IF
       IF mindmap_format IN ["ascii", "both"] THEN
           INVOKE ts-mindmap-ascii
               INPUT: extraction_report_path, packet_path, packet_id, meeting_title
               OUTPUT: 08-mindmap/mindmap.ascii.txt
       END IF
   END IF

5. HANDLE MINDMAP RESULTS:
   - SUCCESS: Set ts_mindmap_output.overall_status = "complete"
   - FAILURE: Set ts_mindmap_output.overall_status = "failed"
              Add warning to ps-critic input
              Continue pipeline (graceful degradation)

6. EXECUTE PS-CRITIC:
   - Include mindmap files in validation scope (if present)
   - Apply MM-*/AM-* criteria (if mindmaps enabled)
   - Report mindmap quality in quality-review.md
```

### 1.7 HOW MUCH - Effort and Complexity

| Aspect | Estimate | Rationale |
|--------|----------|-----------|
| **Total Effort** | 21 story points | Across 9 tasks |
| **Critical Path** | TASK-240 → TASK-241 → TASK-242 → TASK-243/244 | Sequential dependencies |
| **Implementation Risk** | LOW | Agents already built, clear interfaces |
| **Integration Risk** | MEDIUM | State passing, error handling |
| **Testing Effort** | 3 points | TASK-246 integration tests |
| **Documentation Effort** | 2 points | TASK-247 PLAYBOOK/RUNBOOK |

**Complexity Assessment:**
```
LOW COMPLEXITY:
├── Agent invocation (existing pattern)
├── Parameter parsing (existing infrastructure)
└── Output file creation (08-mindmap/ directory)

MEDIUM COMPLEXITY:
├── State passing between agents
├── Conditional execution logic
└── ps-critic validation expansion

HIGH COMPLEXITY:
└── (None identified - well-scoped problem)
```

---

## 2. Ishikawa (Fishbone) Analysis

### 2.1 Problem Statement

**Effect**: Mindmap Pipeline Integration Failure

What could cause the mindmap integration to fail or produce poor results?

### 2.2 Ishikawa Diagram

```
                                    ┌─────────────────────────────────────┐
                                    │  MINDMAP PIPELINE INTEGRATION FAILURE │
                                    └──────────────────┬──────────────────┘
                                                       │
    ┌──────────────────────────────────────────────────┼──────────────────────────────────────────────────┐
    │                                                  │                                                  │
    │   METHODS                        MATERIALS       │      MACHINES                    MANPOWER        │
    │   ───────                        ─────────       │      ────────                    ────────        │
    │                                                  │                                                  │
    │   ┌─ Pipeline ordering           ┌─ Extraction   │      ┌─ Agent model             ┌─ Prompt        │
    │   │  wrong                       │  report       │      │  selection               │  engineering   │
    │   │                              │  malformed    │      │  (sonnet)                │  gaps          │
    │   ├─ State passing               │               │      │                          │                │
    │   │  incomplete                  ├─ Packet       │      ├─ Context                 ├─ Agent         │
    │   │                              │  path         │      │  window                  │  definition    │
    │   ├─ Conditional                 │  invalid      │      │  limits                  │  incomplete    │
    │   │  logic errors                │               │      │                          │                │
    │   │                              ├─ Anchor       │      ├─ Tool                    ├─ Invocation    │
    │   └─ Opt-out flag                │  registry     │      │  availability            │  protocol      │
    │      not parsed                  │  missing      │      │  (Read/Write/Glob)       │  violations    │
    │                                  │               │      │                          │                │
────┴──────────────────────────────────┴───────────────┴──────┴──────────────────────────┴────────────────┴────
    │                                                  │                                                  │
    │   MEASUREMENT                    ENVIRONMENT     │                                                  │
    │   ───────────                    ───────────     │                                                  │
    │                                                  │                                                  │
    │   ┌─ ps-critic criteria          ┌─ Error        │                                                  │
    │   │  undefined                   │  handling     │                                                  │
    │   │                              │  incomplete   │                                                  │
    │   ├─ Quality threshold           │               │                                                  │
    │   │  too strict                  ├─ Timeout      │                                                  │
    │   │                              │  during       │                                                  │
    │   ├─ Deep link                   │  generation   │                                                  │
    │   │  validation                  │               │                                                  │
    │   │  missing                     ├─ Filesystem   │                                                  │
    │   │                              │  permissions  │                                                  │
    │   └─ Anchor format               │               │                                                  │
    │      mismatch                    └─ Concurrent   │                                                  │
    │                                     execution    │                                                  │
    │                                     conflicts    │                                                  │
    │                                                  │                                                  │
    └──────────────────────────────────────────────────┴──────────────────────────────────────────────────┘
```

### 2.3 Root Cause Categories

#### 2.3.1 METHODS (Process/Procedure)

| Root Cause | Likelihood | Impact | Mitigation |
|------------|------------|--------|------------|
| Pipeline ordering wrong | LOW | HIGH | TASK-240 research confirms correct order |
| State passing incomplete | MEDIUM | HIGH | Define ts_mindmap_output schema explicitly |
| Conditional logic errors | MEDIUM | MEDIUM | Unit tests for --no-mindmap flag |
| Opt-out flag not parsed | LOW | MEDIUM | Integration tests (TASK-246) |

#### 2.3.2 MATERIALS (Input Data)

| Root Cause | Likelihood | Impact | Mitigation |
|------------|------------|--------|------------|
| Extraction report malformed | LOW | HIGH | Contract tests (TASK-112A exists) |
| Packet path invalid | LOW | HIGH | Validate path exists before invocation |
| Anchor registry missing | LOW | MEDIUM | Check _anchors.json presence |

#### 2.3.3 MACHINES (Tools/Technology)

| Root Cause | Likelihood | Impact | Mitigation |
|------------|------------|--------|------------|
| Model selection (sonnet) | LOW | MEDIUM | Documented in agent definitions |
| Context window limits | LOW | MEDIUM | Mindmaps work on extraction summary |
| Tool availability | LOW | LOW | Standard tools (Read/Write/Glob) |

#### 2.3.4 MANPOWER (People/Skills)

| Root Cause | Likelihood | Impact | Mitigation |
|------------|------------|--------|------------|
| Prompt engineering gaps | LOW | MEDIUM | EN-009 agents already validated |
| Agent definition incomplete | LOW | HIGH | Agents created and reviewed in EN-009 |
| Invocation protocol violations | MEDIUM | HIGH | Document invocation context clearly |

#### 2.3.5 MEASUREMENT (Quality/Metrics)

| Root Cause | Likelihood | Impact | Mitigation |
|------------|------------|--------|------------|
| ps-critic criteria undefined | HIGH | MEDIUM | TASK-245 defines MM-*/AM-* criteria |
| Quality threshold too strict | LOW | LOW | Start with 0.85, adjust if needed |
| Deep link validation missing | MEDIUM | MEDIUM | Add to ps-critic validation |
| Anchor format mismatch | LOW | HIGH | ADR-003 defines anchor format |

#### 2.3.6 ENVIRONMENT (External Factors)

| Root Cause | Likelihood | Impact | Mitigation |
|------------|------------|--------|------------|
| Error handling incomplete | MEDIUM | HIGH | Graceful degradation design |
| Timeout during generation | LOW | MEDIUM | Reasonable timeouts, warning on failure |
| Filesystem permissions | LOW | LOW | Same as existing packet creation |
| Concurrent execution conflicts | LOW | LOW | Sequential execution design |

---

## 3. Pareto Analysis (80/20)

### 3.1 Risk Prioritization

Based on Likelihood × Impact scoring:

| Rank | Root Cause | Score | Category | Priority |
|------|------------|-------|----------|----------|
| 1 | ps-critic criteria undefined | HIGH×MEDIUM=6 | Measurement | **CRITICAL** |
| 2 | State passing incomplete | MEDIUM×HIGH=6 | Methods | **CRITICAL** |
| 3 | Error handling incomplete | MEDIUM×HIGH=6 | Environment | **CRITICAL** |
| 4 | Invocation protocol violations | MEDIUM×HIGH=6 | Manpower | **HIGH** |
| 5 | Deep link validation missing | MEDIUM×MEDIUM=4 | Measurement | MEDIUM |
| 6 | Conditional logic errors | MEDIUM×MEDIUM=4 | Methods | MEDIUM |

### 3.2 Pareto Principle Application

**80% of integration failures will come from 20% of root causes:**

```
TOP 4 ROOT CAUSES (Critical Priority)
=====================================

1. ps-critic criteria undefined
   → Resolution: TASK-245 (Update ps-critic Mindmap Validation Criteria)

2. State passing incomplete
   → Resolution: TASK-244 (Update Pipeline Orchestration Flow)

3. Error handling incomplete
   → Resolution: ADR-006 graceful degradation design (TASK-242)

4. Invocation protocol violations
   → Resolution: TASK-243 (Update SKILL.md with invocation examples)
```

### 3.3 Effort vs. Impact Matrix

```
                    HIGH IMPACT
                         │
                         │
    ┌────────────────────┼────────────────────┐
    │   QUICK WINS       │   MAJOR PROJECTS   │
    │                    │                    │
    │ • ps-critic        │ • Integration      │
    │   criteria         │   tests (TASK-246) │
LOW │   (TASK-245)       │                    │ HIGH
EFFORT                   │                    │ EFFORT
    │                    │                    │
    ├────────────────────┼────────────────────┤
    │   FILL-INS         │   THANKLESS TASKS  │
    │                    │                    │
    │ • Documentation    │ • (None identified)│
    │   updates          │                    │
    │   (TASK-247)       │                    │
    │                    │                    │
    └────────────────────┼────────────────────┘
                         │
                    LOW IMPACT
```

---

## 4. Risk Assessment Summary

### 4.1 Risk Register

| ID | Risk | Likelihood | Impact | Severity | Mitigation | Owner |
|----|------|------------|--------|----------|------------|-------|
| R-001 | Mindmap failure blocks pipeline | LOW | HIGH | MEDIUM | Graceful degradation | ADR-006 |
| R-002 | State passing breaks | MEDIUM | HIGH | HIGH | Explicit schema | TASK-244 |
| R-003 | ps-critic validation gaps | HIGH | MEDIUM | HIGH | Define criteria | TASK-245 |
| R-004 | Integration test coverage | MEDIUM | MEDIUM | MEDIUM | Comprehensive tests | TASK-246 |
| R-005 | Documentation gaps | LOW | LOW | LOW | Update docs | TASK-247 |

### 4.2 Mitigation Actions

| Risk ID | Mitigation Action | Task | Status |
|---------|-------------------|------|--------|
| R-001 | Design graceful degradation in ADR-006 | TASK-242 | PENDING |
| R-002 | Define ts_mindmap_output schema | TASK-244 | PENDING |
| R-003 | Create MM-*/AM-* validation criteria | TASK-245 | PENDING |
| R-004 | Create integration test suite | TASK-246 | PENDING |
| R-005 | Update PLAYBOOK.md and RUNBOOK.md | TASK-247 | PENDING |

---

## 5. Recommendations for ADR-006

Based on this analysis, ADR-006 (TASK-242) should address:

### 5.1 Decision Required

1. **Pipeline Ordering**: Confirm ts-formatter → ts-mindmap-* → ps-critic
2. **Default Behavior**: Mindmaps ON by default with `--no-mindmap` opt-out
3. **Format Default**: Both Mermaid and ASCII formats by default
4. **Failure Handling**: Graceful degradation (continue with warning)
5. **Output Directory**: `08-mindmap/` per DISC-001

### 5.2 Architectural Constraints

1. **P-003 Compliance**: Single-level nesting (orchestrator → workers)
2. **State Immutability**: State keys are append-only
3. **File Persistence**: All outputs persisted (P-002)

### 5.3 Quality Criteria

1. **MM-001**: Valid Mermaid syntax
2. **MM-002**: Root node present
3. **MM-003**: Deep links use correct anchor format
4. **AM-001**: 80-character width constraint
5. **AM-002**: Legend present
6. **AM-003**: Valid box-drawing characters

---

## 6. Document History

| Date | Author | Change |
|------|--------|--------|
| 2026-01-30 | Claude | Initial analysis complete |

---

## 7. References

### 7.1 Source Documents

- [TASK-240 Research](../research/TASK-240-pipeline-state-research.md) - Pipeline state analysis
- [DISC-001](../EN-024--DISC-001-mindmap-directory-numbering-discrepancy.md) - Directory numbering discovery
- [EN-024](../EN-024-mindmap-pipeline-integration.md) - Parent enabler
- [ts-mindmap-mermaid](../../../../../skills/transcript/agents/ts-mindmap-mermaid.md) - Mermaid agent
- [ts-mindmap-ascii](../../../../../skills/transcript/agents/ts-mindmap-ascii.md) - ASCII agent

### 7.2 Problem-Solving Frameworks

- 5W2H: Who, What, When, Where, Why, How, How Much
- Ishikawa (Fishbone): Root cause categorization
- Pareto (80/20): Risk prioritization
- FMEA: Failure Mode and Effects Analysis (risk scoring)

---

*Analysis Complete: EN-024:TASK-241*
*Frameworks Applied: 5W2H, Ishikawa, Pareto, Risk Assessment*
*Quality Verification: All root causes categorized and mitigated*
*Next Task: TASK-242 ADR-006 Creation*
