# FEAT-002 Orchestration State (SSOT)
# Machine-readable execution state for FEAT-002 Implementation
# Created: 2026-01-26 per DISC-001 restructuring

workflow:
  id: "feat-002-implementation-20260126-001"
  name: "FEAT-002: Transcript Skill Implementation"
  feature_id: "FEAT-002"
  status: ACTIVE  # PLANNING | ACTIVE | PAUSED | COMPLETE | FAILED

metadata:
  created_at: "2026-01-26T17:30:00Z"
  updated_at: "2026-01-28T16:00:00Z"
  prerequisite: "FEAT-001 Complete (All 4 Gates Passed)"
  alignment_analysis: "DISC-001"
  folder_structure_precedence: "DISC-003"

# Enabler definitions with restructured task allocations
enablers:
  EN-007:
    title: "ts-parser Agent Implementation"
    status: gate-5-passed
    priority: high
    gate: GATE-5
    tasks:
      start: TASK-101
      end: TASK-105
      additional: [TASK-105A, TASK-106, TASK-107]  # Contract tests, encoding fallback
    dependencies: []
    implements:
      - TDD-ts-parser.md
    deliverables:
      - skills/transcript/agents/ts-parser.md
    quality_reviews:
      ps_critic:
        path: EN-007-vtt-parser/critiques/en007-gate5-iter1-critique.md
        score: 0.89
        status: PASS
      nse_qa:
        path: EN-007-vtt-parser/qa/proj008-en007-implementation-qa.md
        score: 0.87
        status: PASS
    approval:
      human_approval: true
      approved_at: "2026-01-28T08:00:00Z"

  EN-008:
    title: "ts-extractor Agent Implementation"
    status: gate-5-passed
    priority: high
    gate: GATE-5
    tasks:
      start: TASK-106
      end: TASK-112
      additional: [TASK-112A, TASK-112B]  # Contract tests, integration tests
    dependencies:
      - EN-007
    implements:
      - TDD-ts-extractor.md
      - PAT-001 (Tiered Extraction)
      - PAT-003 (Speaker Detection)
      - PAT-004 (Citation Required)
    deliverables:
      - skills/transcript/agents/ts-extractor.md
    quality_reviews:
      ps_critic:
        path: EN-008-entity-extraction/critiques/en008-gate5-iter1-critique.md
        score: 0.91
        status: PASS
      nse_qa:
        path: EN-008-entity-extraction/qa/proj008-en008-implementation-qa.md
        score: 0.88
        status: PASS
    approval:
      human_approval: true
      approved_at: "2026-01-28T15:00:00Z"

  EN-009:
    title: "Mind Map Generator (Mermaid + ASCII)"
    status: pending
    priority: high
    gate: GATE-5
    tasks:
      start: TASK-001
      end: TASK-004
      note: "Enabler-scoped numbering per DEC-003"
    dependencies:
      - EN-016
    deliverables:
      - 07-mindmap/mindmap.mmd
      - 07-mindmap/mindmap.ascii.txt
    note: "Original EN-009 - retained per BUG-001. Task files created per DEC-003:AI-004."

  EN-010:
    title: "Artifact Packaging & Deep Linking"
    status: DEPRECATED
    absorbed_into: EN-016
    rationale: "ts-formatter handles all packaging per ADR-002 and TDD-ts-formatter.md"
    tasks:
      migrated_to: EN-016

  EN-011:
    title: "Worktracker Integration"
    status: pending
    priority: medium
    gate: GATE-6
    tasks:
      # Uses existing task allocation
      legacy: true
    dependencies:
      - EN-016
    deliverables:
      - 08-workitems/suggested-tasks.md

  EN-016:
    title: "ts-formatter Agent Implementation"
    status: in_progress
    priority: high
    gate: GATE-5
    tasks:
      start: TASK-113
      end: TASK-119
      additional: [TASK-119A, TASK-119B, TASK-119C]  # Contract, integration, E2E tests
      complete: [TASK-113, TASK-114, TASK-115, TASK-116, TASK-117, TASK-118, TASK-119A, TASK-119B]
      pending: [TASK-119, TASK-119C]
    dependencies:
      - EN-008
    implements:
      - TDD-ts-formatter.md
      - ADR-002 (8-file packet)
      - ADR-003 (Bidirectional linking)
      - ADR-004 (Semantic splitting)
    absorbs:
      - EN-010  # Artifact Packaging (deprecated)
    deliverables:
      - skills/transcript/agents/ts-formatter.md
      - test_data/validation/contract-tests.yaml (ts-formatter section)
      - test_data/validation/integration-tests.yaml (extractor-formatter section)
    note: "Renumbered from EN-009 per BUG-001 (ID conflict with Mind Map Generator)"

  EN-012:
    title: "Skill CLI Interface"
    status: MOVED_TO_FEAT_003
    priority: low
    gate: GATE-7
    note: "MOVED TO FEAT-003 per DISC-002 (Above and Beyond scope)"
    tasks:
      migrated_to: FEAT-003
    dependencies:
      - EN-011
    moved_by: DISC-002

  EN-013:
    title: "Context Injection Implementation"
    status: pending
    priority: medium
    gate: GATE-5
    tasks:
      start: TASK-120
      end: TASK-125
    dependencies:
      - EN-006  # Design from FEAT-001
    implements:
      - SPEC-context-injection.md Section 3
      - DEC-002 (YAML-only)
    deliverables:
      - skills/transcript/SKILL.md (context_injection section)
      - skills/transcript/agents/ts-*.md (context sections)

  EN-014:
    title: "Domain Context Files"
    status: pending
    priority: medium
    gate: GATE-6
    tasks:
      start: TASK-126
      end: TASK-130
    dependencies:
      - EN-013
    implements:
      - SPEC-context-injection.md Section 3.3
    deliverables:
      - skills/transcript/contexts/general.yaml
      - skills/transcript/contexts/transcript.yaml
      - skills/transcript/contexts/meeting.yaml
      - skills/transcript/contexts/schemas/domain-schema.json

  EN-015:
    title: "Validation & Test Cases"
    status: pending
    priority: high
    gate: GATE-6
    tasks:
      start: TASK-131
      end: TASK-137
    dependencies:
      - EN-007
      - EN-008
      - EN-009  # Mind Map Generator
      - EN-016  # ts-formatter
      - EN-014
    deliverables:
      - test_data/transcripts/golden/
      - test_data/transcripts/edge_cases/
      - test_data/validation/parser-tests.yaml
      - test_data/validation/extractor-tests.yaml
      - test_data/validation/formatter-tests.yaml

# Gate definitions
gates:
  GATE-5:
    name: "Core Implementation Review"
    status: pending
    enablers:
      - EN-007
      - EN-008
      - EN-009  # Mind Map Generator
      - EN-013
      - EN-016  # ts-formatter
    approval_required: true
    criteria:
      - "ts-parser processes VTT/SRT/plain text"
      - "ts-extractor extracts all entity types"
      - "ts-formatter creates 8-file packet"
      - "Mind Map Generator creates Mermaid + ASCII"
      - "Context injection working"

  GATE-6:
    name: "Functionality Review"
    status: pending
    enablers:
      - EN-011
      - EN-014
      - EN-015
    approval_required: true
    criteria:
      - "Worktracker integration functional"
      - "Domain context files valid"
      - "All validation tests passing"

  GATE-7:
    name: "CLI Final Review"
    status: MOVED_TO_FEAT_003
    enablers:
      - EN-012
    approval_required: false  # Moved to FEAT-003
    note: "MOVED TO FEAT-003 per DISC-002 (Above and Beyond scope)"
    criteria:
      - "CLI interface functional"
      - "End-to-end workflow complete"

# Execution queue
execution_queue:
  current_group: 2  # Context & Formatting (Group 1 complete)
  groups:
    - id: 1
      name: "Core Agents"
      mode: SEQUENTIAL
      enablers:
        - EN-007
        - EN-008
      gate: GATE-5

    - id: 2
      name: "Context & Formatting"
      mode: PARALLEL
      status: in_progress  # Started 2026-01-28
      execution_order: [EN-016, EN-013]  # Sequential within parallel group per user approval
      enablers:
        - EN-016   # ts-formatter (first - higher effort, establishes output structure)
        - EN-013   # Context Injection (second - lower effort, references patterns)
      gate: GATE-5
      note: "Option A execution: EN-016 first → EN-013. EN-009 moved to Group 3 per DEC-003."

    - id: 3
      name: "Mind Map Generation"
      mode: SEQUENTIAL
      enablers:
        - EN-009   # Mind Map Generator (depends on EN-016)
      gate: GATE-5
      note: "NEW group per DEC-003 - EN-009 must wait for EN-016"

    - id: 4
      name: "Integration & Validation"
      mode: PARALLEL
      enablers:
        - EN-011
        - EN-014
        - EN-015
      gate: GATE-6
      note: "Renumbered from Group 3 per DEC-003"

    # Group 4 (CLI) moved to FEAT-003 per DISC-002
    # - id: 4
    #   name: "CLI"
    #   mode: SEQUENTIAL
    #   enablers:
    #     - EN-012
    #   gate: GATE-7

# Task allocation summary
task_allocation:
  EN-007: [TASK-101, TASK-102, TASK-103, TASK-104, TASK-105, TASK-105A, TASK-106, TASK-107]
  EN-008: [TASK-106, TASK-107, TASK-108, TASK-109, TASK-110, TASK-111, TASK-112, TASK-112A, TASK-112B]
  EN-009: [TASK-001, TASK-002, TASK-003, TASK-004]  # Mind Map Generator - enabler-scoped numbering per DEC-003
  EN-013: [TASK-120, TASK-121, TASK-122, TASK-123, TASK-124, TASK-125]
  EN-014: [TASK-126, TASK-127, TASK-128, TASK-129, TASK-130]
  EN-015: [TASK-131, TASK-132, TASK-133, TASK-134, TASK-135, TASK-136, TASK-137, TASK-138]  # Added TASK-138 per DEC-003:D-005
  EN-016: [TASK-113, TASK-114, TASK-115, TASK-116, TASK-117, TASK-118, TASK-119, TASK-119A, TASK-119B, TASK-119C]  # ts-formatter (renumbered per BUG-001), with test tasks

# Metrics
metrics:
  enablers_total: 8  # Excluding deprecated EN-010 and moved EN-012; includes EN-016 per BUG-001
  enablers_complete: 2  # EN-007, EN-008 passed GATE-5
  enablers_in_progress: 1  # EN-016 (8/10 tasks complete)
  enablers_gate_ready: 0  # No enablers currently awaiting human approval
  enablers_moved: 1  # EN-012 → FEAT-003
  tasks_total: 52  # Updated: EN-016 now has 10 tasks (TASK-119A/B/C added)
  tasks_complete: 25  # EN-007 (8) + EN-008 (9) + EN-016 (8: TASK-113..118, 119A, 119B)
  gates_passed: 0  # GATE-5 not yet fully passed (EN-009, EN-013, EN-016 still pending)
  gates_total: 2  # GATE-5, GATE-6 (GATE-7 moved to FEAT-003)
  completion_percentage: 48  # 25/52 tasks complete

# Checkpoint tracking
checkpoints:
  latest_id: null
  entries: []

# History
history:
  - timestamp: "2026-01-26T17:30:00Z"
    event: "Orchestration created"
    details: "Per DISC-001 restructuring. EN-010 deprecated, EN-014/EN-015 added."
  - timestamp: "2026-01-26T22:30:00Z"
    event: "BUG-001 resolved"
    details: "EN-009 ID conflict resolved. ts-formatter renumbered to EN-016. EN-009 retained for Mind Map Generator (TASK-046..049). DISC-002 created for EN-011/EN-012 future scope analysis."
  - timestamp: "2026-01-26T23:30:00Z"
    event: "DISC-002 executed"
    details: "EN-012 (CLI) moved to FEAT-003 per user approval. GATE-7 removed. Enablers: 9→8. Gates: 3→2. Tasks remain allocated but moved to FEAT-003 scope."
  - timestamp: "2026-01-28T08:00:00Z"
    event: "EN-007 GATE-5 passed"
    details: "ts-parser implementation complete. ps-critic (0.89) and nse-qa (0.87) reviews passed. Human approval received."
  - timestamp: "2026-01-28T12:00:00Z"
    event: "EN-008 quality reviews complete"
    details: "ps-critic (0.91) and nse-qa (0.88) reviews passed. Ready for GATE-5 human approval."
  - timestamp: "2026-01-28T12:45:00Z"
    event: "DISC-003 created and remediation applied"
    details: "Quality artifact folder structure precedence documented. Files moved to critiques/ and qa/ subdirectories per skill definitions. ORCHESTRATION.yaml updated to ACTIVE status."
  - timestamp: "2026-01-28T14:00:00Z"
    event: "DEC-003 execution - Group renumbering and EN-009 task files"
    details: "Per DEC-003: (1) Group 2 now EN-013+EN-016 only (parallel). (2) NEW Group 3 for EN-009 (sequential after EN-016). (3) Old Group 3 renumbered to Group 4. (4) EN-009 task IDs changed to enabler-scoped TASK-001..004. (5) TASK-138 added to EN-015 for EN-008 deferred findings."
  - timestamp: "2026-01-28T15:00:00Z"
    event: "EN-008 GATE-5 passed"
    details: "ts-extractor implementation complete. Quality reviews: ps-critic (0.91 PASS), nse-qa (0.88 PASS). Human approval received. Group 1 (Core Agents) complete. Ready for Group 2 (EN-016 + EN-013)."
  - timestamp: "2026-01-28T16:00:00Z"
    event: "Group 2 started - Context & Formatting"
    details: "Execution strategy: Option A (EN-016 first → EN-013). User approved sequential execution within parallel group. EN-016 (ts-formatter) higher effort/priority, establishes output structure. EN-013 (Context Injection) follows, can reference established patterns."
  - timestamp: "2026-01-28T18:30:00Z"
    event: "EN-016 core tasks complete (8/10)"
    details: "Completed: TASK-113 (alignment), TASK-114..118 (core components verified - PacketGenerator, TokenCounter, FileSplitter, AnchorRegistry, BacklinkInjector), TASK-119A (9 formatter contracts CON-FMT-001..009), TASK-119B (6 integration tests INT-EF-001..006). Pending: TASK-119 (validation execution), TASK-119C (E2E tests - blocked by TASK-137, TASK-131A)."
