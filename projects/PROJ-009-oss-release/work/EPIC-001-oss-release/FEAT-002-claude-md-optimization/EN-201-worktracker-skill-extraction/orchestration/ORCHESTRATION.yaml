# ORCHESTRATION.yaml - EN-201 Worktracker Skill Extraction
# Machine-readable orchestration state for DISC-002 adversarial review workflow
# Document ID: EN-201-ORCH-STATE
# Version: 2.0
# Protocol: DISC-002 Adversarial Review
# Prior Art: FEAT-001/orchestration/oss-release-20260131-001/quality-gates/
# Last Updated: 2026-02-01T13:30:00Z

schema_version: "2.0.0"

# =============================================================================
# WORKFLOW METADATA
# =============================================================================
workflow:
  id: "en201-extraction-20260201-001"
  name: "EN-201 Worktracker Content Extraction with DISC-002 Adversarial Review"
  project_id: "PROJ-009-oss-release"
  enabler_id: "EN-201"
  version: "2.0"
  created_at: "2026-02-01T12:00:00Z"
  updated_at: "2026-02-01T13:30:00Z"
  status: "ACTIVE"

  id_source: "auto"
  id_format: "enabler-purpose-YYYYMMDD-NNN"

  # DISC-002 Adversarial Review Protocol
  protocol:
    id: "DISC-002"
    name: "Adversarial Review Protocol"
    prior_art: "FEAT-001/orchestration/oss-release-20260131-001/quality-gates/"
    mandatory_findings: 3  # Minimum adversarial findings per review
    versioned_files: true  # *-review.md → *-review-v2.md on iteration

    # Adversarial Mode Characteristics
    adversarial_mode:
      enabled: true
      characteristics:
        - id: 1
          name: "RED_TEAM_FRAMING"
          description: "Assume problems exist, actively seek weaknesses"
          enforcement: "Required in prompt"
        - id: 2
          name: "MANDATORY_FINDINGS"
          description: "Must identify ≥3 issues regardless of quality"
          enforcement: "Hard requirement"
        - id: 3
          name: "CHECKLIST_ENFORCEMENT"
          description: "Evidence required for PASS, not assumptions"
          enforcement: "Verification required"
        - id: 4
          name: "DEVILS_ADVOCATE"
          description: "What could go wrong? for every claim"
          enforcement: "Explicit section in output"
        - id: 5
          name: "COUNTER_EXAMPLES"
          description: "Identify failure scenarios even for good work"
          enforcement: "Required output section"
        - id: 6
          name: "NO_RUBBER_STAMPS"
          description: "Perfect scores (0.95+) require explicit justification"
          enforcement: "Justified exceptions only"

    # Finding type requirements
    finding_types:
      - type: "BLIND_SPOT"
        description: "Areas not covered by artifact"
        minimum_required: 1
      - type: "WEAK_ASSUMPTION"
        description: "Unstated assumptions that could fail"
        minimum_required: 1
      - type: "MISSING_EVIDENCE"
        description: "Claims without supporting evidence"
        minimum_required: 0
      - type: "CONTRADICTION"
        description: "Internal or cross-artifact conflicts"
        minimum_required: 0

  patterns:
    - FAN_OUT_FAN_IN
    - GENERATOR_CRITIC
    - BARRIER_SYNC
    - SEQUENTIAL
    - DISC_002_ADVERSARIAL  # DISC-002 specific pattern

  # Quality gate configuration (per DEC-OSS-001)
  quality_gate:
    threshold: 0.92
    max_iterations: 3
    escalation: "human"
    improvement_threshold: 0.05  # Min improvement to continue iterating
    dual_review: true  # Both ps-critic AND nse-qa at gates

  constraints:
    max_agent_nesting: 1
    file_persistence: true
    user_authority: true
    max_concurrent_tasks: 4
    checkpoint_frequency: "PHASE"

# =============================================================================
# PATH CONFIGURATION (DISC-002 Structure)
# =============================================================================
paths:
  base: "EN-201-worktracker-skill-extraction/orchestration/"
  quality_gates: "{base}quality-gates/"
  qg_1: "{base}quality-gates/qg-1/"
  qg_2: "{base}quality-gates/qg-2/"
  escalations: "{base}escalations/"
  output: "skills/worktracker/rules/"

# =============================================================================
# EXECUTION MODEL (Explicit Per-Task and QG Loops)
# =============================================================================
execution_model:
  description: |
    Each task runs its own adversarial self-feedback loop IN PARALLEL.
    Quality Gates (QG-1, QG-2) have SYNCHRONIZED dual-agent loops.
    File-based feedback: reviewers write findings to files, generators read and remediate.

  # Per-Task Adversarial Loop Pattern
  per_task_loop:
    pattern: "GENERATOR_CRITIC"
    agents: ["ps-critic"]
    execution: "PARALLEL"  # All 4 tasks run their loops concurrently
    flow:
      - step: "GENERATE"
        action: "Extract content from CLAUDE.md to target file"
        output: "{task.target_file}"
      - step: "CRITIQUE"
        agent: "ps-critic"
        action: "Adversarial review with DISC-002 protocol"
        output: "quality-gates/task-reviews/{task.id}/ps-critic-review-v{iteration}.md"
        mode: "ADVERSARIAL"
      - step: "EVALUATE"
        condition: "score >= 0.92"
        on_pass: "ACCEPT"
        on_fail: "CHECK_ITERATION"
      - step: "CHECK_ITERATION"
        condition: "iteration < 3"
        on_true: "REMEDIATE"
        on_false: "ESCALATE"
      - step: "REMEDIATE"
        action: "Read REM-* items from critique, revise artifact"
        input: "quality-gates/task-reviews/{task.id}/ps-critic-review-v{iteration}.md"
        output: "{task.target_file}"  # Overwrite with improved version
        increment: "iteration += 1"
        next: "CRITIQUE"
      - step: "ESCALATE"
        action: "Create escalation artifact for human review"
        output: "escalations/{task.id}-escalation.md"
      - step: "ACCEPT"
        action: "Mark task accepted, proceed to convergence"
        set: "task.accepted = true"

  # Quality Gate Synchronized Dual-Agent Loop Pattern
  quality_gate_loop:
    pattern: "SYNCHRONIZED_DUAL_REVIEW"
    agents: ["ps-critic", "nse-qa"]
    execution: "PARALLEL"  # Both agents review simultaneously
    synchronization: "SYNCHRONIZED"  # If either fails, both re-review after remediation
    flow:
      - step: "DUAL_REVIEW"
        parallel_actions:
          - agent: "ps-critic"
            action: "Adversarial quality review of all artifacts"
            output: "quality-gates/{qg.id}/ps-critic-review-v{iteration}.md"
            mode: "ADVERSARIAL"
          - agent: "nse-qa"
            action: "NASA SE compliance audit of all artifacts"
            output: "quality-gates/{qg.id}/nse-qa-audit-v{iteration}.md"
            mode: "ADVERSARIAL"
      - step: "EVALUATE_BOTH"
        condition: "ps_critic.score >= 0.92 AND nse_qa.score >= 0.92"
        on_pass: "ACCEPT_GATE"
        on_fail: "CHECK_ITERATION"
      - step: "CHECK_ITERATION"
        condition: "iteration < 3"
        on_true: "SYNTHESIZE_REMEDIATION"
        on_false: "ESCALATE"
      - step: "SYNTHESIZE_REMEDIATION"
        action: "Merge REM-* from ps-critic and NCR-* from nse-qa into unified remediation plan"
        inputs:
          - "quality-gates/{qg.id}/ps-critic-review-v{iteration}.md"
          - "quality-gates/{qg.id}/nse-qa-audit-v{iteration}.md"
        output: "quality-gates/{qg.id}/remediation-synthesis-v{iteration}.md"
        next: "APPLY_REMEDIATION"
      - step: "APPLY_REMEDIATION"
        action: "Update source artifacts based on synthesized remediation"
        increment: "iteration += 1"
        next: "DUAL_REVIEW"
      - step: "ESCALATE"
        action: "Create escalation artifact for human review"
        output: "escalations/{qg.id}-escalation.md"
      - step: "ACCEPT_GATE"
        action: "Mark gate passed, unblock next phase"
        set: "qg.passed = true"

  # File-Based Feedback Protocol
  feedback_protocol:
    description: "Structured remediation items passed via files for high-quality upstream feedback"

    # ps-critic output structure
    ps_critic_output:
      file_pattern: "ps-critic-review-v{N}.md"
      sections:
        - "Executive Summary (score, verdict, gap)"
        - "Per-Criterion Scores (C/A/CL/AC/T table)"
        - "Adversarial Findings (min 3, with severity)"
        - "Remediation Items (REM-001, REM-002, etc.)"
        - "Quality Gate Verdict (ASCII box)"
      remediation_format:
        id_pattern: "REM-{NNN}"
        fields:
          - "severity: CRITICAL | HIGH | MEDIUM | LOW"
          - "finding_type: BLIND_SPOT | WEAK_ASSUMPTION | MISSING_EVIDENCE | CONTRADICTION"
          - "affected_artifact: path to artifact"
          - "affected_section: specific section/line"
          - "evidence: quote or reference from artifact"
          - "required_action: specific fix instruction"
          - "expected_improvement: estimated score delta"

    # nse-qa output structure
    nse_qa_output:
      file_pattern: "nse-qa-audit-v{N}.md"
      sections:
        - "Executive Summary (compliance %, verdict)"
        - "Per-Criterion Scores (TR/RT/VE/RI/DQ table)"
        - "NPR 7123.1D Compliance Matrix"
        - "Non-Conformances (NCR-001, NCR-002, etc.)"
        - "Certification Statement"
      non_conformance_format:
        id_pattern: "NCR-{NNN}"
        fields:
          - "severity: CRITICAL | HIGH | MEDIUM | LOW"
          - "criterion: TR | RT | VE | RI | DQ"
          - "affected_artifact: path to artifact"
          - "finding: description of non-conformance"
          - "evidence: reference to artifact"
          - "remediation: required corrective action"

    # Remediation synthesis structure
    synthesis_output:
      file_pattern: "remediation-synthesis-v{N}.md"
      sections:
        - "Merged Findings (REM + NCR prioritized by severity)"
        - "Artifact-by-Artifact Fix Plan"
        - "Estimated Effort per Fix"
        - "Expected Score Improvement"

# =============================================================================
# PHASE DEFINITIONS
# =============================================================================
phases:
  phase_1:
    id: 1
    name: "Content Extraction"
    description: "Parallel extraction with per-task adversarial loops"
    execution_mode: "PARALLEL"
    loop_pattern: "per_task_loop"  # Reference to execution_model
    status: "IN_PROGRESS"
    started_at: "2026-02-01T14:00:00Z"
    completed_at: null

    tasks:
      - id: "TASK-002"
        name: "Create worktracker-entity-hierarchy.md"
        description: "Extract entity hierarchy content (~80 lines)"
        source_sections:
          - "## 1: Entity Hierarchy"
          - "### 1.1 Complete Hierarchy Tree"
          - "### 1.2 Hierarchy Levels"
          - "## 2: Entity Classification and Properties"
        target_file: "skills/worktracker/rules/worktracker-entity-hierarchy.md"
        expected_loc: 80
        status: "ACCEPTED"
        iteration: 1
        max_iterations: 3
        quality_scores: [0.936]
        current_score: 0.936
        accepted: true
        review_artifacts:
          - "quality-gates/task-reviews/TASK-002/ps-critic-review-v1.md"

      - id: "TASK-003"
        name: "Create worktracker-system-mappings.md"
        description: "Extract system mappings content (~120 lines)"
        source_sections:
          - "## 3: System Mapping Summary"
          - "## 4. System Mappings"
          - "### 4.1. Entity Mapping by System"
        target_file: "skills/worktracker/rules/worktracker-system-mappings.md"
        expected_loc: 120
        status: "ACCEPTED"
        iteration: 1
        max_iterations: 3
        quality_scores: [0.92]
        current_score: 0.92
        accepted: true
        review_artifacts:
          - "quality-gates/task-reviews/TASK-003/ps-critic-review-v1.md"

      - id: "TASK-004"
        name: "Create worktracker-behavior-rules.md"
        description: "Extract behavior rules content (~60 lines)"
        source_sections:
          - "## Work tracker (worktracker) Behavior"
        target_file: "skills/worktracker/rules/worktracker-behavior-rules.md"
        expected_loc: 60
        status: "IN_PROGRESS"
        iteration: 0
        max_iterations: 3
        quality_scores: []
        current_score: null
        accepted: false
        review_artifacts:
          - "quality-gates/task-reviews/TASK-004/ps-critic-review-v1.md"

      - id: "TASK-005"
        name: "Create worktracker-directory-structure.md"
        description: "Extract directory structure content (~111 lines)"
        source_sections:
          - "## Work tracker (worktracker) Directory Structure"
        target_file: "skills/worktracker/rules/worktracker-directory-structure.md"
        expected_loc: 111
        status: "IN_PROGRESS"
        iteration: 0
        max_iterations: 3
        quality_scores: []
        current_score: null
        accepted: false
        review_artifacts:
          - "quality-gates/task-reviews/TASK-005/ps-critic-review-v1.md"

  # QG-1: Quality Gate after Phase 1 extraction
  qg_1:
    id: "QG-1"
    name: "Extraction Quality Gate"
    description: "Synchronized dual-agent adversarial review of all 4 extraction artifacts"
    loop_pattern: "quality_gate_loop"  # Reference to execution_model
    agents: ["ps-critic", "nse-qa"]
    execution_mode: "PARALLEL"  # Both agents review simultaneously
    synchronization: "SYNCHRONIZED"  # Both must pass; if either fails, both re-review
    status: "BLOCKED"
    blocked_by: "phase_1"
    iteration: 0
    max_iterations: 3
    artifacts_to_review:
      - "skills/worktracker/rules/worktracker-entity-hierarchy.md"
      - "skills/worktracker/rules/worktracker-system-mappings.md"
      - "skills/worktracker/rules/worktracker-behavior-rules.md"
      - "skills/worktracker/rules/worktracker-directory-structure.md"
    review_outputs:
      ps_critic: "quality-gates/qg-1/ps-critic-review-v{iteration}.md"
      nse_qa: "quality-gates/qg-1/nse-qa-audit-v{iteration}.md"
      synthesis: "quality-gates/qg-1/remediation-synthesis-v{iteration}.md"
    scores:
      ps_critic: null
      nse_qa: null
    passed: false

  phase_2:
    id: 2
    name: "Integration Review"
    description: "Batch integration validation with adversarial loop"
    execution_mode: "SEQUENTIAL"
    loop_pattern: "quality_gate_loop"
    status: "BLOCKED"
    blocked_by: "qg_1"
    started_at: null
    completed_at: null

    # Integration review is essentially QG-2
    integration_review:
      id: "nse-qa-integration"
      name: "Integration Quality Audit"
      description: "Validate all 4 rule files for completeness, consistency, no duplication"
      status: "BLOCKED"
      iteration: 0
      max_iterations: 3
      compliance_scores: []
      current_score: null
      accepted: false
      checks:
        - "INT-001: Complete Migration (371 lines)"
        - "INT-002: No Information Loss"
        - "INT-003: Consistent Formatting"
        - "INT-004: Cross-References Valid"
        - "INT-005: Template Compliance"
        - "INT-006: No Duplication"
      output: "quality-gates/qg-2/integration-qa-report-v{iteration}.md"

  # QG-2: Quality Gate after Phase 2 integration
  qg_2:
    id: "QG-2"
    name: "Integration Quality Gate"
    description: "Synchronized dual-agent review of integration completeness"
    loop_pattern: "quality_gate_loop"
    agents: ["ps-critic", "nse-qa"]
    execution_mode: "PARALLEL"
    synchronization: "SYNCHRONIZED"
    status: "BLOCKED"
    blocked_by: "phase_2"
    iteration: 0
    max_iterations: 3
    artifacts_to_review:
      - "skills/worktracker/rules/worktracker-entity-hierarchy.md"
      - "skills/worktracker/rules/worktracker-system-mappings.md"
      - "skills/worktracker/rules/worktracker-behavior-rules.md"
      - "skills/worktracker/rules/worktracker-directory-structure.md"
    review_outputs:
      ps_critic: "quality-gates/qg-2/ps-critic-review-v{iteration}.md"
      nse_qa: "quality-gates/qg-2/nse-qa-audit-v{iteration}.md"
      synthesis: "quality-gates/qg-2/remediation-synthesis-v{iteration}.md"
    scores:
      ps_critic: null
      nse_qa: null
    passed: false

  phase_3:
    id: 3
    name: "Navigation & Validation"
    description: "Update SKILL.md and validate skill loading"
    execution_mode: "SEQUENTIAL"
    loop_pattern: "per_task_loop"
    status: "BLOCKED"
    blocked_by: "qg_2"
    started_at: null
    completed_at: null

    tasks:
      - id: "TASK-006"
        name: "Update SKILL.md navigation"
        description: "Add navigation pointers to all rule files"
        target_file: "skills/worktracker/SKILL.md"
        status: "BLOCKED"
        iteration: 0
        max_iterations: 3
        quality_scores: []
        current_score: null
        accepted: false
        review_artifacts:
          - "quality-gates/task-reviews/TASK-006/ps-critic-review-v1.md"

      - id: "TASK-007"
        name: "Validate skill loading"
        description: "Test /worktracker skill invocation loads all content"
        depends_on: "TASK-006"
        status: "BLOCKED"
        iteration: 0
        max_iterations: 3
        quality_scores: []
        current_score: null
        accepted: false
        review_artifacts:
          - "quality-gates/task-reviews/TASK-007/ps-critic-review-v1.md"

# =============================================================================
# CONVERGENCE POINTS (formerly SYNC BARRIERS)
# =============================================================================
convergence_points:
  - id: "convergence-1"
    name: "Phase 1 Tasks → QG-1"
    description: "All 4 per-task loops must complete (accepted) before QG-1 begins"
    status: "PENDING"
    conditions:
      - "TASK-002.accepted == true"
      - "TASK-003.accepted == true"
      - "TASK-004.accepted == true"
      - "TASK-005.accepted == true"
    unblocks: "qg_1"

  - id: "convergence-2"
    name: "QG-1 → Phase 2"
    description: "QG-1 must pass before Phase 2 integration review"
    status: "PENDING"
    conditions:
      - "qg_1.passed == true"
    unblocks: "phase_2"

  - id: "convergence-3"
    name: "Phase 2 → QG-2"
    description: "Integration review must complete before QG-2"
    status: "PENDING"
    conditions:
      - "phase_2.integration_review.accepted == true"
    unblocks: "qg_2"

  - id: "convergence-4"
    name: "QG-2 → Phase 3"
    description: "QG-2 must pass before Phase 3 navigation/validation"
    status: "PENDING"
    conditions:
      - "qg_2.passed == true"
    unblocks: "phase_3"

# =============================================================================
# EVALUATION CRITERIA (DISC-002 Protocol)
# Based on FEAT-001 research phase implementation
# =============================================================================
evaluation_criteria:
  # ps-critic criteria (Quality Evaluator)
  # Prior art: qg-0/ps-critic-review.md
  ps_critic:
    - code: "C"
      name: "completeness"
      weight: 0.30
      description: "All source content extracted without omissions"
      scoring_rubric:
        excellent: "100% of source content present (0.95+)"
        good: "95-99% content present (0.90-0.94)"
        acceptable: "90-94% content present (0.85-0.89)"
        needs_work: "80-89% content present (0.80-0.84)"
        poor: "Less than 80% content present (<0.80)"

    - code: "A"
      name: "accuracy"
      weight: 0.25
      description: "Content matches source exactly without drift"
      scoring_rubric:
        excellent: "Zero content modifications"
        good: "Minor formatting changes only"
        acceptable: "Small clarifications added"
        needs_work: "Some content reworded"
        poor: "Significant content drift"

    - code: "CL"
      name: "clarity"
      weight: 0.20
      description: "Clear and understandable content"
      scoring_rubric:
        excellent: "Crystal clear, well-organized"
        good: "Clear with minor ambiguities"
        acceptable: "Generally understandable"
        needs_work: "Some confusing sections"
        poor: "Difficult to understand"

    - code: "AC"
      name: "actionability"
      weight: 0.15
      description: "Content enables action, not just information"
      scoring_rubric:
        excellent: "Directly usable for implementation"
        good: "Clear guidance with minor gaps"
        acceptable: "Generally actionable"
        needs_work: "Requires interpretation"
        poor: "Too vague to act on"

    - code: "T"
      name: "traceability"
      weight: 0.10
      description: "Cross-references to source material"
      scoring_rubric:
        excellent: "All sections trace to CLAUDE.md"
        good: "Most sections traced"
        acceptable: "Key sections traced"
        needs_work: "Some sections lack tracing"
        poor: "No traceability"

  # nse-qa criteria (NASA SE Compliance)
  # Prior art: qg-0/nse-qa-audit.md
  nse_qa:
    - code: "TR"
      name: "technical_rigor"
      weight: 0.20
      description: "Systematic methodology, structured approach"
      scoring_rubric:
        excellent: "Follows NASA SE patterns"
        good: "Mostly systematic"
        acceptable: "Generally structured"
        needs_work: "Ad-hoc approach"
        poor: "No methodology"

    - code: "RT"
      name: "requirements_traceability"
      weight: 0.20
      description: "Explicit linkages to source requirements"
      scoring_rubric:
        excellent: "Every section traces to CLAUDE.md"
        good: "Most sections traced"
        acceptable: "Key sections traced"
        needs_work: "Some sections lack tracing"
        poor: "No traceability"

    - code: "VE"
      name: "verification_evidence"
      weight: 0.20
      description: "Evidence sufficient to support conclusions"
      scoring_rubric:
        excellent: "Line counts, diffs, file comparisons"
        good: "Most claims verified"
        acceptable: "Key claims verified"
        needs_work: "Limited verification"
        poor: "No verification evidence"

    - code: "RI"
      name: "risk_identification"
      weight: 0.20
      description: "Risks identified and assessed"
      scoring_rubric:
        excellent: "All risks with severity ratings"
        good: "Most risks identified"
        acceptable: "Key risks identified"
        needs_work: "Limited risk coverage"
        poor: "No risk identification"

    - code: "DQ"
      name: "documentation_quality"
      weight: 0.20
      description: "Format supports technical review"
      scoring_rubric:
        excellent: "NPR 7123.1D compliant"
        good: "Mostly structured"
        acceptable: "Generally readable"
        needs_work: "Formatting issues"
        poor: "Poorly structured"

  # DISC-002 Mandatory Findings
  adversarial_findings:
    minimum_required: 3
    types:
      - name: "blind_spots"
        description: "Areas not covered by artifact"
        minimum: 1
      - name: "weak_assumptions"
        description: "Unstated assumptions that could fail"
        minimum: 1
      - name: "missing_evidence"
        description: "Claims without supporting evidence"
        minimum: 0
      - name: "contradictions"
        description: "Internal or cross-artifact conflicts"
        minimum: 0

  # Integration-level checks
  integration_level:
    - id: "INT-001"
      name: "Complete Migration"
      description: "All 371 lines from CLAUDE.md accounted for"
    - id: "INT-002"
      name: "No Information Loss"
      description: "Diff shows no missing content"
    - id: "INT-003"
      name: "Consistent Formatting"
      description: "Same style across all 4 files"
    - id: "INT-004"
      name: "Cross-References Valid"
      description: "All internal links work"
    - id: "INT-005"
      name: "Template Compliance"
      description: "Each file follows rules template"
    - id: "INT-006"
      name: "No Duplication"
      description: "Content not duplicated across files"

# =============================================================================
# AGENT CONFIGURATION
# =============================================================================
agents:
  ps_critic:
    id: "ps-critic"
    family: "ps"
    role: "Task-level quality evaluator"
    model: "sonnet"
    cognitive_mode: "convergent"
    output_location: "{paths.critiques}"
    circuit_breaker:
      max_iterations: 3
      improvement_threshold: 0.05
      acceptance_threshold: 0.92

  nse_qa:
    id: "nse-qa"
    family: "nse"
    role: "Integration quality auditor"
    model: "sonnet"
    cognitive_mode: "convergent"
    output_location: "{paths.qa}"
    circuit_breaker:
      max_iterations: 3
      improvement_threshold: 5  # percentage
      acceptance_threshold: 92  # percentage

# =============================================================================
# EXECUTION QUEUE (Explicit Flow with Loops)
# =============================================================================
execution_queue:
  current_group: 1
  groups:
    - id: 1
      name: "Phase 1: Parallel Extraction with Per-Task Loops"
      execution_mode: "PARALLEL"
      status: "IN_PROGRESS"
      description: |
        Each task runs its own adversarial loop concurrently:
        TASK-002 ──► [Generate → ps-critic → Revise]* ──► ≥0.92
        TASK-003 ──► [Generate → ps-critic → Revise]* ──► ≥0.92
        TASK-004 ──► [Generate → ps-critic → Revise]* ──► ≥0.92
        TASK-005 ──► [Generate → ps-critic → Revise]* ──► ≥0.92
        * Loop until score ≥0.92 or 3 iterations (then escalate)
      tasks:
        - id: "TASK-002"
          loop: "per_task_loop"
          agent: "ps-critic"
        - id: "TASK-003"
          loop: "per_task_loop"
          agent: "ps-critic"
        - id: "TASK-004"
          loop: "per_task_loop"
          agent: "ps-critic"
        - id: "TASK-005"
          loop: "per_task_loop"
          agent: "ps-critic"

    - id: 2
      name: "Convergence 1: All Tasks → QG-1"
      execution_mode: "BARRIER"
      status: "BLOCKED"
      blocked_by: "group-1"
      description: "Wait for all 4 task loops to complete (accepted)"
      conditions:
        - "TASK-002.accepted"
        - "TASK-003.accepted"
        - "TASK-004.accepted"
        - "TASK-005.accepted"
      actions:
        - "create_checkpoint: phase-1-complete"

    - id: 3
      name: "QG-1: Synchronized Dual-Agent Adversarial Review"
      execution_mode: "SYNCHRONIZED_LOOP"
      status: "BLOCKED"
      blocked_by: "group-2"
      description: |
        Both agents review in parallel, synchronized iteration:
        ┌─────────────────────────────────────────────────────────┐
        │  ps-critic ──► review ──┐                               │
        │                         ├──► BOTH ≥0.92? ──► PASS       │
        │  nse-qa ────► audit ────┘         │                     │
        │                                   ▼ NO                  │
        │                         synthesize remediation          │
        │                                   │                     │
        │                         apply fixes to artifacts        │
        │                                   │                     │
        │                         iteration < 3? ──► LOOP         │
        │                                   │ NO                  │
        │                                   ▼                     │
        │                              ESCALATE                   │
        └─────────────────────────────────────────────────────────┘
      agents:
        - id: "ps-critic"
          output: "quality-gates/qg-1/ps-critic-review-v{iteration}.md"
        - id: "nse-qa"
          output: "quality-gates/qg-1/nse-qa-audit-v{iteration}.md"
      synthesis_output: "quality-gates/qg-1/remediation-synthesis-v{iteration}.md"
      threshold: 0.92
      max_iterations: 3

    - id: 4
      name: "Convergence 2: QG-1 → Phase 2"
      execution_mode: "BARRIER"
      status: "BLOCKED"
      blocked_by: "group-3"
      conditions:
        - "qg_1.passed"
      actions:
        - "create_checkpoint: qg-1-complete"

    - id: 5
      name: "Phase 2: Integration Review"
      execution_mode: "SEQUENTIAL"
      status: "BLOCKED"
      blocked_by: "group-4"
      description: "nse-qa validates integration completeness (INT-001 through INT-006)"
      agents:
        - id: "nse-qa"
          mode: "integration"
          output: "quality-gates/qg-2/integration-qa-report-v{iteration}.md"

    - id: 6
      name: "QG-2: Synchronized Dual-Agent Integration Gate"
      execution_mode: "SYNCHRONIZED_LOOP"
      status: "BLOCKED"
      blocked_by: "group-5"
      description: "Final quality gate before navigation/validation"
      agents:
        - id: "ps-critic"
          output: "quality-gates/qg-2/ps-critic-review-v{iteration}.md"
        - id: "nse-qa"
          output: "quality-gates/qg-2/nse-qa-audit-v{iteration}.md"
      synthesis_output: "quality-gates/qg-2/remediation-synthesis-v{iteration}.md"
      threshold: 0.92
      max_iterations: 3

    - id: 7
      name: "Convergence 3: QG-2 → Phase 3"
      execution_mode: "BARRIER"
      status: "BLOCKED"
      blocked_by: "group-6"
      conditions:
        - "qg_2.passed"
      actions:
        - "create_checkpoint: qg-2-complete"

    - id: 8
      name: "Phase 3: Navigation & Validation with Per-Task Loops"
      execution_mode: "SEQUENTIAL"
      status: "BLOCKED"
      blocked_by: "group-7"
      description: |
        TASK-006 ──► [Generate → ps-critic → Revise]* ──► ≥0.92
        TASK-007 ──► [Generate → ps-critic → Revise]* ──► ≥0.92
      tasks:
        - id: "TASK-006"
          loop: "per_task_loop"
          agent: "ps-critic"
        - id: "TASK-007"
          loop: "per_task_loop"
          agent: "ps-critic"
          depends_on: "TASK-006"

# =============================================================================
# CHECKPOINTS
# =============================================================================
checkpoints:
  latest_id: null
  entries: []

# =============================================================================
# METRICS
# =============================================================================
metrics:
  execution:
    tasks_complete: 1
    tasks_total: 7
    tasks_percent: 14
    phases_complete: 0
    phases_total: 3
    phases_percent: 0
    barriers_complete: 0
    barriers_total: 2
    barriers_percent: 0
    total_iterations: 0
    human_escalations: 0

  quality:
    phase_1_avg_score: null
    phase_2_compliance: null
    total_loc_extracted: 0
    target_loc: 371

  timing:
    workflow_started: "2026-02-01T12:00:00Z"
    last_activity: "2026-02-01T14:00:00Z"
    estimated_completion: null

# =============================================================================
# BLOCKERS AND ISSUES
# =============================================================================
blockers:
  active: []

issues:
  resolved: []

escalations:
  active: []
  resolved: []

# =============================================================================
# NEXT ACTIONS
# =============================================================================
next_actions:
  immediate:
    - action: "Execute TASK-002 through TASK-005 in parallel"
      tasks: ["TASK-002", "TASK-003", "TASK-004", "TASK-005"]
      execution_mode: "PARALLEL"
      description: "Generate content, evaluate with ps-critic, iterate until ≥0.92"

  subsequent:
    - action: "Pass Barrier 1 when all Phase 1 tasks accepted"
      depends_on: "All Phase 1 tasks ≥ 0.92"
    - action: "Execute nse-qa integration review"
      depends_on: "Barrier 1 complete"
    - action: "Execute TASK-006 and TASK-007"
      depends_on: "Barrier 2 complete"

# =============================================================================
# RESUMPTION CONTEXT
# =============================================================================
resumption:
  last_checkpoint: null
  current_state: "Phase 1 IN PROGRESS. TASK-002-005 executing in parallel with adversarial loops."
  next_step: "Await task completion, then execute QG-1 synchronized dual-agent review"

  files_to_read:
    - "ORCHESTRATION_PLAN.md"
    - "ORCHESTRATION.yaml"
    - "ORCHESTRATION_WORKTRACKER.md"

  cross_session_portable: true
  ephemeral_references: false
